<!-- Standalone Generated By Octo (octo-ide.com) -->
<script>data={"program":"###########################################\n#\n#  Into the GarlicScape\n#\n#  A roguelike game engine example for Octo\n#\n#  'Come, brave adventurer; don your woolen\n#   armor and descend into the GarlicScape\n#   in search of aliums. But beware- many\n#   a moth or roach stands in your way!\n#   Take solace in the Llamas. They will\n#   heal your wounds, and ensure that you\n#   have the strength to make it to\n#   the fabled Alium Chalice of Yarnham.'\n#\n#  Move with ASWD or arrows,\n#  and dismiss static screens with E or space.\n#\n#  This program uses XO-Chip instructions,\n#  and expects to be run at around 500-1000\n#  cycles/frame. The plane 2 and blend\n#  colors should be identical to make\n#  the player sprite opaque. Additionally,\n#  the buzzer color should probably be set\n#  to match the background.\n#\n###########################################\n\n# reserved as temporaries: v0, v1, v3, vd, ve, vf\n# still free (never touched) as globals: v8, v9, vA\n\n:alias timer  vB # global continuous 0-8 animation counter\n:alias input  vC # global buffered input key\n\n# global game information that doesn't need to be in a register:\n\n: game-transition 0                # defer certain actions until the top-level main loop\n: current-map     0                # index of a prebuilt level (if any)\n: player-health   0                # how many times can you get damaged before you die?\n: player-score    0                # they call me gato / i have metal joints /\n\n:const SCORE_GOAL               15 # beat me up / and earn 15 silver points\n:const TRANSITION_GOTO_MAP       1 # travel to a different level/area\n:const TRANSITION_DAMAGE_PLAYER  2 # injure the player at the end of animation...\n:const TRANSITION_HEAL_PLAYER    3 # heal the player fully at the end of animation...\n:const TRANSITION_ADD_SCORE      4 # increment the player's score at the end of animation...\n\n# everything that isn't a static tile on the map, including the player, is a mob.\n# mobs live in a global buffer here and share a common structure:\n\n# type - id of the type of mob (see MOB_TYPE_XXX)\n# x    - horizontal position in tiles\n# y    - vertical position in tiles\n# face - direction the mob is facing; either FACE_LEFT or FACE_RIGHT\n\n:const MOB_COUNT 5 # how many mobs are allowed to spawn at once?\n: mob-buffer\n\t0 0 0 0\n\t0 0 0 0\n\t0 0 0 0\n\t0 0 0 0\n\t0 0 0 0\n\n# following from the above definitions, we have a calling\n# convention used across many routines in this codebase:\n:alias mob-index v2\n:alias mob-type  v4\n:alias mob-x     v5\n:alias mob-y     v6\n:alias mob-face  v7\n\n: mob-get\n\ti := mob-buffer\n\ti += mob-index\n\ti += mob-index\n\ti += mob-index\n\ti += mob-index\n;\n: save-mob-regs mob-get save mob-type - mob-face ;\n: load-mob-regs mob-get load mob-type - mob-face ;\n\n# note that these line up with indices to mob-sprite-table:\n:const MOB_TYPE_PLAYER 0\n:const MOB_TYPE_LLAMA  1\n:const MOB_TYPE_MOTH   2\n:const MOB_TYPE_ROACH  3\n:const MOB_TYPE_NONE  -1\n\n# auxiliary/optional mob information, mostly used for\n# animating mobs when they take a turn:\n: mob-pow-table   0 0 0 0 0 # if 1, animate a flash over the mob indicating damage\n: mob-hug-table   0 0 0 0 0 # if 1, float a heart from mob\n: mob-dead-table  0 0 0 0 0 # if 1, destroy mob (after pow, cancels move)\n: mob-roach-dir   0 0 0 0 0 # direction of a roach (0-3)\n: mob-move-table  0 0 0 0 0 # direction to step (see deltas)\n:const BUMP_OFFSET  4       #   OR direction + BUMP_OFFSET to bump in that direction and return\n:const MOVE_NONE   -1       #   OR -1 for no move\n\n# mob sprites have 4-frame animations, and are 7x7 pixels.\n# the first 28 bytes are a right-facing animation,\n# followed by a left-facing animation:\n:const FACE_RIGHT 0\n:calc  FACE_LEFT  { 7 * 4 }\n\n# the macros 'sprite-begin' and 'sprite-end'\n# encapsulate the process of building the mirrored copy\n# of each frame of an animated sprite:\n:macro sprite-begin {\n\t:calc sprite-base { HERE }\n}\n:macro mirror-row {\n\t:calc t { @ sprite-base }\n\t:byte { (   2 & t >> 6 ) | (  4 & t >> 4 ) | (  8 & t >> 2 ) | ( 16 & t ) |\n\t        ( 128 & t << 6 ) | ( 64 & t << 4 ) | ( 32 & t << 2 ) }\n\t:calc sprite-base { 1 + sprite-base }\n}\n:macro mirror-frame {\n\tmirror-row\n\tmirror-row\n\tmirror-row\n\tmirror-row\n\tmirror-row\n\tmirror-row\n\tmirror-row\n}\n:macro sprite-end {\n\tmirror-frame\n\tmirror-frame\n\tmirror-frame\n\tmirror-frame\n}\n\n# helpers for working with XO-Chip high RAM.\n# the 'to-data' macro indicates that the ensuing data\n# should be assembled into high RAM (which must be indexed\n# with the i := long NNNN instruction),\n# and the 'to-code' macro swaps back to assembling in low RAM.\n# using these macros allows you to declare data before using it,\n# while keeping data out of precious low RAM:\n:calc CODE_POS { 0x200  }\n:calc DATA_POS { 0x1000 }\n:macro to-code { :calc DATA_POS { HERE }  :org { CODE_POS } }\n:macro to-data { :calc CODE_POS { HERE }  :org { DATA_POS } }\n\n# helpers for multiple memory indirection/pointers:\n# unpack16 places a computed 16-bit address in v registers,\n# pointer writes a computed 16-bit address into memory as a literal,\n# and indirect creates an i := long NNNN instruction with a label\n# halfway through, ready to be overwritten with a new 16-bit value:\n:macro unpack16 ADDR {\n\t:calc hi { 0xFF & ADDR >> 8 }  v0 := hi\n\t:calc lo { 0xFF & ADDR      }  v1 := lo\n}\n:macro pointer ADDR {\n\t:byte { 0xFF & ADDR >> 8 }\n\t:byte { 0xFF & ADDR      }\n}\n:macro indirect LABEL {\n\t0xF0 0x00 : LABEL 0x00 0x00 # i := long NNNN\n}\n\n# misc:\n:macro NOOP {\n\t# sometimes no-ops are desirable for breakpoints,\n\t# or to pad out a dispatch table.\n\tvf := vf\n}\n:macro set-times-7 DEST SRC {\n\t# dest/src MUST be distinct!\n\tDEST := SRC  # y\n\tDEST += DEST # y*2\n\tDEST += SRC  # y*3\n\tDEST += DEST # y*6\n\tDEST += SRC  # y*7\n}\n:macro swap A B {\n\tvf := A\n\tA := B\n\tB := vf\n}\n: wait\n\tloop\n\t\tvf := delay\n\t\tif vf != 0 then\n\tagain\n\tvf := 3\n\tdelay := vf\n;\n: buffer-input\n\tif input != -1 then return\n\t:macro buffer-test SCAN KEY {\n\t\tvf := SCAN\n\t\tif vf key then input := KEY\n\t}\n\tbuffer-test OCTO_KEY_A 0\n\tbuffer-test OCTO_KEY_D 1\n\tbuffer-test OCTO_KEY_W 2\n\tbuffer-test OCTO_KEY_S 3\n;\n: wait-for-space\n\tvf := OCTO_KEY_E\n\tloop if vf  key then again\n\tloop if vf -key then again\n\tloop if vf  key then again\n;\n\n###########################################\n#\n#  Sound Effects\n#\n###########################################\n\nto-data\n\n: sound-step   0x02 0x21 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n: sound-bump   0x02 0x21 0x00 0x08 0x66 0x00 0xD8 0x01 0xB0 0x20 0x10 0x10 0x00 0x00 0x00 0x00\n: sound-pickup 0xFC 0x0F 0xC0 0xFC 0x0F 0xC0 0xF8 0x1F 0x81 0xF8 0x1F 0x81 0xF0 0x3F 0x03 0xF0\n: sound-heal   0xE3 0x8E 0x38 0xE3 0x8E 0x38 0xC7 0x1C 0x71 0xC7 0x1C 0x71 0xCE 0x38 0xE3 0x8E\n: sound-hurt   0xA5 0xDF 0x71 0xDC 0x50 0x1D 0x38 0x97 0x5A 0x7D 0xDF 0xB5 0xE5 0xF4 0x97 0xD5\n\nto-code\n\n# this is the simplest way to use the XO-Chip audio pattern buffer:\n# brief, percussive patterns played in a set-and-forget manner.\n# see Octo's Audio Editor in the toolbox to preview and edit these sounds.\n\n: play-sound\n\taudio\n\tvf := 1\n\tbuzzer := vf\n;\n\n:macro sfx SOUND {\n\ti := long SOUND\n\tplay-sound\n}\n\n###########################################\n#\n#  Title Screen / Game Over\n#\n###########################################\n\nto-data\n\n# These screens were prepared using EZ-Pack:\n# http://beyondloom.com/tools/ezpack.html\n# starting with a 128x64 pixel black-and-white image,\n# use default settings aside from changing\n# \"Sprite Size\" to 0 for 16x16 sprites in each chunk.\n\n: title-data\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x0F 0xFE 0x1F 0xFE 0x1F 0xF6\n\t0x1C 0x1A 0x1C 0x1C 0x1C 0x0E 0x1C 0x02 0x1C 0x00 0x1C 0x00 0x1C 0xFE 0x1D 0x1E\n\t0x1D 0x4E 0x1C 0x8E 0x1C 0x0E 0x1C 0x0E 0x1C 0x0E 0x1F 0xFE 0x1F 0xFE 0x0F 0xFC\n\t0x00 0x00 0x00 0x00 0x00 0x7F 0x00 0x80 0x00 0xC0 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x3F 0xC7 0x7F 0xE7 0x7F 0xE7\n\t0x70 0xE7 0x70 0xE7 0x70 0xE7 0x70 0xE7 0x70 0xE7 0x70 0xE7 0x7F 0xE7 0x7F 0xE7\n\t0x7F 0xE7 0x70 0xE7 0x70 0xE7 0x70 0xE7 0x70 0xE7 0x70 0xE7 0x70 0xE7 0xF9 0xF7\n\t0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x01 0x80 0x01 0x00 0x00 0xFF 0x00 0x00 0x00 0x00 0xFC 0x7E 0xFE 0x79 0xFE 0x72\n\t0x0E 0x70 0x0E 0x70 0x0E 0x70 0x0E 0x70 0x0E 0x70 0x1E 0x70 0xFC 0x70 0xF8 0x70\n\t0xFC 0x70 0x1E 0x70 0x0E 0x70 0x0E 0x70 0x0E 0x70 0x0E 0x7F 0x0E 0x7F 0x9F 0x7F\n\t0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xA5 0xDE 0xB4 0x92 0xAC 0x92\n\t0xA4 0x92 0xA4 0x92 0xA4 0x9E 0x00 0x00 0x00 0x00 0x1F 0x3F 0x0E 0x7F 0x0E 0x7F\n\t0x0E 0x70 0x0E 0x72 0x0E 0x71 0x0E 0x70 0x0E 0x70 0x0E 0x70 0x0E 0x70 0x0E 0x70\n\t0x0E 0x70 0x0E 0x71 0x8E 0x72 0x4E 0x70 0xCE 0x70 0xCE 0x7F 0xCE 0x7F 0xDF 0x3F\n\t0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x3A 0x5E 0x12 0x50 0x13 0xD8\n\t0x12 0x50 0x12 0x50 0x12 0x5F 0x00 0x00 0x00 0x00 0xC7 0xF8 0xEF 0xFD 0xEF 0xFD\n\t0xEE 0x1D 0xEE 0x1D 0xEE 0x1D 0x0E 0x5D 0x0E 0x3D 0x0E 0x01 0x0F 0xF9 0x0F 0xFD\n\t0x07 0xFD 0xE0 0x1D 0xE7 0xDD 0xEE 0x5D 0xEE 0x9D 0xEE 0x1D 0xEF 0xFD 0xC7 0xF8\n\t0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x01 0x80 0x00 0x80 0xFF 0x00 0x00 0x00 0x00 0x00 0xFF 0x0F 0xFF 0x9F 0xFF 0x9F\n\t0xC3 0x9C 0xCB 0x9C 0xC7 0x9C 0xC0 0x1C 0xC0 0x1C 0xC0 0x1C 0xC0 0x1F 0xC0 0x1F\n\t0xC0 0x1F 0xC7 0x9C 0xCB 0x9C 0xC3 0x9C 0xC3 0x9C 0xFF 0x9C 0xFF 0x9C 0xFF 0x3E\n\t0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xF0 0xFF 0xF9 0xFF 0xF9 0xFF\n\t0x39 0xE7 0x39 0xC3 0x39 0xC3 0x39 0xCB 0x39 0xD3 0x39 0xD3 0xF9 0xDF 0xF9 0xDF\n\t0xF9 0xCF 0x39 0xC0 0x39 0xC0 0x39 0xC0 0x39 0xC0 0x39 0xC0 0x39 0xC0 0x7D 0xE0\n\t0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x3F 0xF8 0x9F 0xF8 0x9F 0xD8\n\t0x9C 0x68 0x9C 0x30 0x9C 0x18 0x9C 0x08 0x9C 0xC0 0x9C 0x40 0x9F 0xC0 0x9F 0xC0\n\t0x1F 0xC0 0x1C 0x40 0x1C 0x10 0x1C 0x08 0x1C 0x18 0x1F 0xF8 0x1F 0xF8 0x3F 0xF8\n\t0x00 0x00 0x00 0x00 0xFE 0x00 0x01 0x00 0x03 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: game-over-data\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xC0 0x00 0x80 0x00 0xFF 0x20 0x00 0x3F 0xFF\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x3F 0xFF 0x20 0x00 0x00 0xFF 0x00 0x80 0x00 0xC0 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0xFF 0xFF\n\t0x00 0x00 0x03 0xF3 0x00 0xC0 0x00 0x61 0x00 0x33 0x00 0x1E 0x00 0x0C 0x00 0x0C\n\t0x00 0x0C 0x00 0x0C 0x00 0x0C 0x00 0x0C 0x00 0x0C 0x00 0x0C 0x00 0x3F 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0xFF 0xFF\n\t0x00 0x00 0xF1 0xC7 0xC3 0x61 0x86 0x31 0x06 0x31 0x0C 0x19 0x0C 0x19 0x0C 0x19\n\t0x0C 0x19 0x0C 0x19 0x0C 0x19 0x06 0x30 0x06 0x30 0x03 0x60 0x01 0xC0 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0xFF 0xFF\n\t0x00 0x00 0xE7 0xE0 0x81 0x80 0x81 0x80 0x81 0x80 0x81 0x80 0x81 0x80 0x81 0x80\n\t0x81 0x80 0x81 0x80 0x81 0x80 0xC3 0x00 0xC3 0x00 0x66 0x00 0x3C 0x00 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0xFF 0xFF\n\t0x00 0x00 0x3F 0x87 0x0C 0x61 0x0C 0x31 0x0C 0x31 0x0C 0x19 0x0C 0x19 0x0C 0x19\n\t0x0C 0x19 0x0C 0x19 0x0C 0x19 0x0C 0x31 0x0C 0x31 0x0C 0x61 0x3F 0x87 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0xFF 0xFF\n\t0x00 0x00 0xEF 0xF9 0x83 0x18 0x83 0x0C 0x83 0x04 0x83 0x00 0x83 0x10 0x83 0xF0\n\t0x83 0x10 0x83 0x00 0x83 0x00 0x83 0x04 0x83 0x0C 0x83 0x18 0xEF 0xF9 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0xFF 0xFF\n\t0x00 0x00 0xFC 0x00 0x63 0x00 0x61 0x80 0x61 0x80 0x60 0xC0 0x60 0xC0 0x60 0xC0\n\t0x60 0xC0 0x60 0xC0 0x60 0xC0 0x61 0x80 0x61 0x80 0x63 0x00 0xFC 0x00 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x03 0x00 0x01 0x00 0xFF 0x00 0x00 0x04 0xFF 0xFC\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0xFF 0xFC 0x00 0x04 0xFF 0x00 0x01 0x00 0x03 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: you-win-data\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x1A 0x00 0x50 0x00 0x1F 0xFF 0x40 0x00\n\t0x7F 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x7F 0xFF 0x40 0x00\n\t0x1F 0xFF 0x50 0x00 0x1A 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0x00 0x0D 0x00 0x13 0x00 0x08 0x00 0x04\n\t0x00 0x02 0x00 0x02 0x00 0x01 0x00 0x01 0x00 0x01 0x00 0x02 0x00 0x02 0x00 0x04\n\t0x00 0x19 0x00 0x23 0x00 0x47 0x00 0x9E 0x01 0x3D 0x02 0x79 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0x7D 0xF7 0x10 0x43 0x10 0x43 0x18 0xC3 0x08 0x83 0x0D 0x83\n\t0x0D 0x83 0x0D 0x83 0x07 0x03 0x07 0x03 0x0F 0x87 0x00 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x45 0x9F 0x4B 0xBF 0x8F 0xBF 0x9F 0xBF 0x9F 0xDF 0x9F 0xDF 0x9F 0xDF\n\t0x97 0xEF 0x9F 0xFF 0x8B 0xFB 0x4F 0xFF 0x26 0xFF 0x23 0x3F 0x11 0x8F 0x0C 0x60\n\t0x02 0x00 0x01 0x80 0x00 0x7F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0xC6 0x00 0xAA 0x00 0x92 0x00 0x12 0x00 0x02 0x00 0x49 0x00 0x29 0x00 0x2D 0x00\n\t0x54 0x80 0x16 0xC0 0x1A 0x38 0x2B 0x07 0x35 0xC0 0x57 0x70 0x57 0xFF 0xDF 0xFD\n\t0xBF 0xFF 0x7F 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0x87 0x9F 0x18 0xD3 0x18 0x43 0x30 0x03 0x30 0x03 0x30 0x03\n\t0x30 0x03 0x30 0x03 0x18 0x43 0x18 0xC3 0x87 0x87 0x00 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0xFF 0xDF 0xFF 0xDF 0xFF 0xEF 0xFF 0xEF 0xFF 0xEF 0xFF 0xF7 0xFF 0xFB\n\t0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0x7E 0xFF 0x9F 0x3F 0xC0 0x07 0x00 0x00\n\t0x01 0xC0 0x06 0x49 0xF8 0xAC 0x00 0xA6 0x00 0x5B 0x00 0x04 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0xC0 0x00 0x3F 0xC0 0x00 0x38 0xC0 0x06 0xFF 0xC1\n\t0xBF 0xF0 0xEF 0xFC 0xF3 0xFF 0xFC 0xFF 0xFE 0x7E 0xFF 0x3F 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0xE3 0x87 0x2C 0x63 0x0C 0x63 0x18 0x33 0x18 0x33 0x18 0x33\n\t0x18 0x33 0x18 0x33 0x0C 0x63 0x0C 0x63 0x83 0x87 0x00 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF\n\t0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFE 0xFF 0xFC 0xFF 0xC0 0x00 0x00\n\t0x00 0x02 0x22 0x53 0xAD 0x4D 0xD7 0x6A 0xB6 0x95 0x4B 0x08 0x04 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x80 0x00\n\t0x40 0x00 0x20 0x00 0x10 0x00 0x88 0x00 0xC4 0x00 0x62 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0xF9 0xCE 0x0C 0x84 0x0C 0x48 0x0C 0x48 0xF8 0x30 0x30 0x30\n\t0x18 0x30 0x18 0x30 0x0C 0x30 0x0C 0x30 0x9E 0x78 0x00 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x99 0xF2 0xDC 0xF9 0xDC 0xF9 0xDC 0xFA 0xB8 0xEA 0xB9 0xF4 0x71 0xC0\n\t0xE1 0x81 0xC0 0x02 0x80 0x1C 0x1F 0xE0 0x30 0x00 0x28 0x00 0x10 0x00 0xC8 0x00\n\t0x70 0x00 0x28 0x00 0xD0 0x00 0x40 0x00 0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF 0x00 0x00\n\t0xFF 0xFF 0x40 0x00 0x20 0x00 0x20 0x00 0x20 0x00 0x20 0x00 0x40 0x00 0x40 0x00\n\t0x80 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x58 0x00 0x0A 0xFF 0xF8 0x00 0x02\n\t0xFF 0xFE 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFE 0x00 0x02\n\t0xFF 0xF8 0x00 0x0A 0x00 0x58 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\n: chalice-data\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x01 0x00 0x02 0x00 0x06 0x00 0x07 0x00 0x07\n\t0x00 0x03 0x00 0x03 0x00 0x02 0x00 0x10 0x00 0x09 0x00 0x0D 0x00 0x16 0x00 0x6A\n\t0x01 0x6D 0x02 0x6E 0x02 0x75 0x03 0x7F 0x02 0xC7 0x01 0x38 0x00 0x80 0x00 0x70\n\t0x00 0x0F 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x03 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x18 0x00 0x60 0x00 0xE0 0x00 0x60 0x03 0xF0 0x01 0xF8 0x01 0x7E 0x01 0xFF 0x23\n\t0xC1 0x27 0x3E 0xEE 0x71 0xC9 0xEF 0xC3 0xDF 0xDF 0xDF 0xBE 0xDF 0xBD 0xFF 0xA3\n\t0xBF 0x9F 0x9F 0xBF 0xAF 0xBF 0xB3 0xBE 0x18 0x8E 0xD4 0x31 0x23 0x8E 0x00 0x00\n\t0xF0 0x00 0x5F 0xFF 0x34 0x01 0x0C 0xA9 0x0A 0xFA 0x0A 0xAA 0x0A 0x22 0x0A 0xFA\n\t0x0E 0x23 0x0A 0xFA 0x0A 0xFA 0x0A 0x22 0x0A 0xFA 0x0E 0xAB 0x0A 0x22 0x09 0xFC\n\t0x12 0x22 0x14 0xF9 0x34 0x21 0xC8 0xA8 0x90 0xA8 0xF0 0xF8 0x0E 0x23 0x01 0xFC\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x80 0x00 0xC0 0x00 0xE0 0x80 0xE3 0x00\n\t0xF5 0x00 0xEB 0x80 0x5B 0xC0 0x5B 0xC0 0x35 0xE0 0xB5 0xF0 0xB6 0x70 0xBB 0xB0\n\t0xBD 0xD4 0x1E 0xDA 0x2F 0xFA 0x60 0xF6 0xC7 0x1A 0x58 0xE4 0x20 0x08 0x00 0x70\n\t0x7F 0x80 0xD0 0x00 0x60 0x00 0x80 0x00 0x80 0x00 0x80 0x00 0x80 0x00 0x80 0x00\n\t0x80 0x00 0x80 0x00 0x80 0x00 0x80 0x00 0x80 0x00 0x80 0x00 0x80 0x00 0x80 0x00\n\t0x40 0x00 0x40 0x00 0x60 0x00 0x98 0x00 0x4E 0x00 0x78 0x00 0x80 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\t0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00\n\nto-code\n\n: screen-blit\n\tv0 := 0\n\tv1 := 0\n\tv2 := 16\n\tv3 := 32\n\tv4 := 48\n\tloop\n\t\tsprite v0 v1 0  i += v3\n\t\tsprite v0 v2 0  i += v3\n\t\tsprite v0 v3 0  i += v3\n\t\tsprite v0 v4 0  i += v3\n\t\tv0 += 16\n\t\tif v0 != 128 then\n\tagain\n;\n\n:macro title-screen     { i := long title-data     screen-blit }\n:macro game-over-screen { i := long game-over-data screen-blit }\n:macro you-win-screen   { i := long you-win-data   screen-blit }\n:macro chalice-screen   { i := long chalice-data   screen-blit }\n\n###########################################\n#\n#  HUD\n#\n###########################################\n\n:const MAX_HEALTH 3\n:const HEALTH_METER_X 1\n:const HEALTH_METER_Y 1\n\n: health-draw\n\tplane 1\n\tv0 := HEALTH_METER_X\n\tv1 := HEALTH_METER_Y\n\ti := player-health\n\tload v2 - v2\n\ti := long smallheart\n\tloop\n\t\twhile v2 != 0\n\t\tsprite v0 v1 5\n\t\tv1 += 6\n\t\tv2 += -1\n\tagain\n;\n\n:const SCORE_METER_X 123\n:const SCORE_METER_Y   1\n\n: score-digits 0 0 0\n: score-draw\n\ti := player-score\n\tload v0\n\ti := score-digits\n\tbcd v0\n\tload v2\n\ti := hex v0\n\tv3 := SCORE_METER_X\n\tv0 := SCORE_METER_Y\n\tsprite v3 v0 5\n\tv0 += 6\n\ti := hex v1\n\tsprite v3 v0 5\n\tv0 += 6\n\ti := hex v2\n\tsprite v3 v0 5\n;\n\n: health-decrement\n\ti := player-health\n\tload v2 - v2\n\tif v2 == 0 then return\n\tv2 += -1\n\tsave v2 - v2\n\n\tv0 := HEALTH_METER_X\n\tv1 := v2\n\tv1 += v1 # * 2\n\tv1 += v2 # * 3\n\tv1 += v1 # * 6\n\tv1 += HEALTH_METER_Y\n\tplane 2\n\ti := long smallheart\n\tv2 := 4\n\tloop\n\t\tsprite v0 v1 5\n\t\twait\n\t\tv2 += -1\n\t\tif v2 != 0 then\n\tagain\n\tplane 1\n\tsprite v0 v1 5\n;\n\n: score-increment\n\tplane 1\n\tscore-draw\n\ti := player-score\n\tload v2 - v2\n\tv2 += 1\n\tsave v2 - v2\n\tplane 2\n\tve := 4\n\tloop\n\t\tscore-draw\n\t\twait\n\t\tve += -1\n\t\tif ve != 0 then\n\tagain\n\tplane 1\n\tscore-draw\n;\n\n: health-reset\n\ti := player-health\n\tvf := MAX_HEALTH\n\tsave vf - vf\n;\n: score-reset\n\ti := player-score\n\tvf := 0\n\tsave vf - vf\n;\n\n###########################################\n#\n#  The Game Board\n#\n###########################################\n\nto-data\n\n# tiles are 7x7, but last row/col is always empty.\n# tiles are drawn in color, and stored as premultiplied offsets\n# into the tile sprites. this makes drawing them much more efficient.\n# this encoding currently limits maps to 21 distinct tiles.\n\n# this macro provides shorthands for building maps as well\n# as longer named constants for game logic for each tile/mob spawn\n:const TILE_SIZE 12\n:macro tile-def NAME SYMBOL {\n\t:calc  NAME   { TILE_SIZE * CALLS }\n\t:macro SYMBOL { :byte NAME }\n}\n:macro mob-def NAME SYMBOL {\n\t:calc  NAME   { - 1 + CALLS }\n\t:macro SYMBOL { :byte NAME }\n}\n: tiles\n\t0x00 0x00 0x00 0x00 0x00 0x00  0x00 0x00 0x00 0x00 0x00 0x00  tile-def TILE_NOTHING     N\n\t0x00 0x00 0x00 0x00 0x10 0x00  0x00 0x00 0x00 0x00 0x00 0x00  tile-def TILE_FLOOR       .\n\t0xFC 0x04 0xBC 0x10 0xFC 0xB4  0x00 0x00 0x00 0x00 0x00 0x00  tile-def TILE_WALL        W\n\t0x00 0x00 0x00 0x00 0x00 0x00  0x78 0xFC 0x74 0xF4 0x7C 0xFC  tile-def TILE_DOOR        D\n\t0x00 0x00 0x00 0x00 0x00 0x00  0xFC 0x84 0xC4 0xD4 0xD4 0xFC  tile-def TILE_STAIRS_DOWN s\n\t0xC0 0xD0 0x14 0xC4 0xF0 0xFC  0x00 0x00 0x00 0x00 0x00 0x00  tile-def TILE_STAIRS_UP   S\n\t0x00 0x00 0x00 0x00 0x00 0x00  0x38 0x50 0xA8 0xB4 0xB4 0x68  tile-def TILE_GARLIC      g\n\nmob-def TILE_PLAYER  P\nmob-def TILE_LLAMA   L\nmob-def TILE_MOTH    m\nmob-def TILE_ROACH_L d\nmob-def TILE_ROACH_R b\nmob-def TILE_ROACH_U ^\nmob-def TILE_ROACH_D v\n\n:const BOARD_WIDTH  16\n:const BOARD_HEIGHT  9\n:calc  BOARD_SIZE   { BOARD_WIDTH * BOARD_HEIGHT }\n:calc  BOARD_END    { -1 + BOARD_SIZE }\n\n: board # 16x9 on SCHIP rez, row-major\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\n# levels are copied to the 'board' buffer before\n# drawing/gameplay, so that the board may be\n# modified in-place and later restored.\n\n: level-0 # the title screen\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t0 0 0 0 W W W W W W W W 0 0 0 0\n\t0 0 0 0 W P . . . . s W 0 0 0 0\n\t0 0 0 0 W W W W W W W W 0 0 0 0\n: level-1 # introduction\n\t0 0 0 g g 0 0 0 0 . 0 0 g 0 g 0\n\t0 0 g 0 0 g 0 . 0 0 0 g g 0 0 0\n\t0 m 0 0 0 0 0 0 0 0 0 0 0 0 0 0\n\t. 0 0 W W W W W W W W W W 0 . 0\n\t0 . 0 W P . . . . . . s W v 0 0\n\t0 0 0 W W W W W W W W W W 0 0 0\n\t0 g 0 0 0 0 . g g 0 0 0 0 . g g\n\t0 . g g 0 0 0 0 0 0 m 0 0 g g g\n\t0 0 g g 0 . 0 0 0 0 0 g 0 0 g g\n: level-2 # unused/test level.\n\t0 0 0 0 0 0 0 0 0 0 0 0 0 W W W\n\t0 0 0 0 W W W W W W W 0 0 W s W\n\tW W W W W m . . . . W W W W . W\n\tW . . . W . . W . . . . . W . W\n\tW . P . W . . . . . . . . . . W\n\tW . S . . . . W W W W . m W W W\n\tW L . . W . . W 0 0 W W W W 0 0\n\tW W W W W g g W 0 0 0 0 0 0 0 0\n\t0 0 0 0 W W W W 0 0 0 0 0 0 0 0\n: level-3 # conclusion\n\t0 0 g 0 . 0 0 g g 0 W 0 0 0 0 0\n\t0 . 0 g W W W W W W W 0 0 0 0 0\n\tg 0 g g W . . . . . . 0 0 0 0 0\n\t0 W W W W . W . . . 0 0 0 0 0 0\n\t0 W S P . . . . . . . 0 0 0 0 0\n\t0 W W W W . W . . . 0 0 0 0 0 0\n\t0 0 g g W . . . . . . 0 0 0 0 0\n\t0 . 0 g W W W W W . . . . g . 0\n\t0 0 g 0 0 . g g W W W W W W 0 0\n\n: map-table\n\tpointer level-0\n\tpointer level-1\n\tpointer level-2\n\tpointer level-3\n\nto-code\n\n# how far to the right do we start drawing the game board?\n# this leaves some space at the edges for a HUD...\n:const HORIZ_OFFSET 8\n:const VERT_OFFSET  1\n\n: unpack-mob\n\t# reserve slot 0 for the player,\n\t# so that we can use the slot index to easily\n\t# identify/access the player elsewhere:\n\tif mob-type == MOB_TYPE_PLAYER begin\n\t\tvd := mob-index\n\t\tmob-index := 0\n\t\tmob-face := 0\n\t\tsave-mob-regs\n\t\tmob-index := vd\n\telse\n\t\tif mob-index != MOB_COUNT begin\n\t\t\tmob-face := random 1\n\t\t\tif mob-face != 0 then mob-face := FACE_LEFT\n\t\t\tsave-mob-regs\n\t\t\tmob-index += 1\n\t\tend\n\tend\n\tv1 := TILE_FLOOR\n;\n\n# by unpacking in a separate pass from drawing,\n# we take more time overall, but do a better job\n# of hiding the copy from users- the copy can\n# take place entirely during a blank screen:\n: board-unpack\n\ti := current-map\n\tload v0\n\ti := long map-table\n\ti += v0\n\ti += v0\n\tload v1\n: board-unpack-raw\n\ti := board-unpack-source\n\tsave v0 - v1\n\n\t# clear mob slots\n\tmob-index := 0\n\tmob-type := MOB_TYPE_NONE\n\tloop\n\t\tsave-mob-regs\n\t\tmob-index += 1\n\t\tif mob-index != MOB_COUNT then\n\tagain\n\n\tv0        := 0 # tile offset\n\tmob-index := 1 # mob index for unpacking\n\tmob-x     := 0 # tile x\n\tmob-y     := 0 # tile y\n\n\tloop\n\t\tindirect board-unpack-source\n\t\ti += v0\n\t\tload v1 - v1\n\t\t:macro unpack-mob-tile TILE {\n\t\t\tif v1 == TILE begin\n\t\t\t\t:calc type { CALLS }\n\t\t\t\tmob-type := type\n\t\t\t\tunpack-mob\n\t\t\tend\n\t\t}\n\t\tunpack-mob-tile TILE_PLAYER \n\t\tunpack-mob-tile TILE_LLAMA\n\t\tunpack-mob-tile TILE_MOTH\n\n\t\t# roaches are special, because they always\n\t\t# begin facing some direction:\n\t\t:macro unpack-roach-tile TILE DIR {\n\t\t\tif v1 == TILE begin\n\t\t\t\ti := mob-roach-dir\n\t\t\t\ti += mob-index\n\t\t\t\tvf := DIR\n\t\t\t\tsave vf - vf\n\t\t\t\tmob-type := MOB_TYPE_ROACH\n\t\t\t\tunpack-mob\n\t\t\tend\n\t\t}\n\t\tunpack-roach-tile TILE_ROACH_L 0\n\t\tunpack-roach-tile TILE_ROACH_R 1\n\t\tunpack-roach-tile TILE_ROACH_U 2\n\t\tunpack-roach-tile TILE_ROACH_D 3\n\n\t\ti := long board\n\t\ti += v0\n\t\tsave v1 - v1\n\n\t\tv0 += 1\n\t\tmob-x += 1\n\t\tif mob-x == BOARD_WIDTH  then mob-y += 1\n\t\tif mob-x == BOARD_WIDTH  then mob-x := 0\n\t\tif mob-y != BOARD_HEIGHT then\n\tagain\n;\n: board-draw\n\tplane 3\n\tv2 := VERT_OFFSET # y\n\tv3 := 0 # tile index\n\tloop\n\t\tv1 := HORIZ_OFFSET # v1 is x\n\t\t:calc LAST_COLUMN { HORIZ_OFFSET + BOARD_WIDTH * 7 }\n\t\tloop\n\t\t\ti := long board\n\t\t\ti += v3\n\t\t\tload v0\n\t\t\ti := long tiles\n\t\t\ti += v0\n\t\t\tsprite v1 v2 6\n\t\t\tv3 += 1\n\t\t\tv1 += 7\n\t\t\tif v1 != LAST_COLUMN then\n\t\tagain\n\t\tv2 += 7\n\t\tif v2 != 64 then\n\tagain\n\n\tplane 2\n\tmob-index := 0\n\tloop\n\t\tload-mob-regs\n\t\tif mob-type != MOB_TYPE_NONE then mob-draw\n\t\tmob-index += 1\n\t\tif mob-index != MOB_COUNT then\n\tagain\n\n\ti := current-map\n\tload v0\n\tif v0 == 0 begin\n\t\tplane 1\n\t\ttitle-screen\n\t\treturn\n\tend\n\tif v0 == 2 begin\n\t\t# level 2 is the randomly-generated \"gameplay\"\n\t\t# part of the game, so only draw the HUD there:\n\t\thealth-draw\n\t\tscore-draw\n\t\treturn\n\tend\n\tif v0 == 3 begin\n\t\tplane 1\n\t\tchalice-screen\n\tend\n;\n\n# convert an x/y position into the address of a tile\n: board-addr\n\ti  := long board\n\ti  += mob-x\n\tvd := mob-y # y * 1\n\tvd += vd    # y * 2\n\tvd += vd    # y * 4\n\tvd += vd    # y * 8\n\tvd += vd    # y * 16\n\ti  += vd\n;\n\n# if tile at x/y position is passable, return 0 in vf\n: board-check\n\tboard-addr\n\tload vd - vd\n\tvf := TILE_WALL\n\tvd -= vf\n\tif mob-x == -1           then vf := -1\n\tif mob-x == BOARD_WIDTH  then vf := -1\n\tif mob-y == -1           then vf := -1\n\tif mob-y == BOARD_HEIGHT then vf := -1\n;\n\n# if a mob is at x/y position, return its index in vf (-1 means none found)\n# this routine is written in a somewhat contorted manner to make it usable\n# from within mob planning routines without destroying active mob state:\n: mob-check\n\tvf := 0\n\tloop\n\t\tif vf != mob-index begin # source mob != target mob\n\t\t\ti := mob-buffer\n\t\t\ti += vf\n\t\t\ti += vf\n\t\t\ti += vf\n\t\t\ti += vf\n\t\t\tload vd - vd\n\t\t\tif vd != MOB_TYPE_NONE begin\n\t\t\t\tvd := 1\n\t\t\t\ti += vd\n\t\t\t\tload vd - vd\n\t\t\t\tif vd == mob-x begin\n\t\t\t\t\tvd := 1\n\t\t\t\t\ti += vd\n\t\t\t\t\tload vd - vd\n\t\t\t\t\tif vd == mob-y then return\n\t\t\t\tend\n\t\t\tend\n\t\tend\n\t\tvf += 1\n\t\tif vf != MOB_COUNT then\n\tagain\n\tvf := -1\n;\n\n# draw one tile at x/y position, using a tile index in vd\n: board-draw-tile\n\tset-times-7 v0 mob-x\n\tset-times-7 v1 mob-y\n\tv0 += HORIZ_OFFSET\n\tv1 += VERT_OFFSET\n\ti  := long tiles\n\ti  += vd\n\tsprite v0 v1 6\n;\n# a more useful interface for the above subroutine;\n# erase, modify, and redraw a board tile.\n:macro replace-tile REPLACEMENT {\n\tboard-addr\n\tload vd - vd\n\tplane 3\n\tboard-draw-tile\n\tboard-addr\n\tvd := REPLACEMENT\n\tsave vd - vd\n\tboard-draw-tile\n\tplane 2\n}\n\n###########################################\n#\n#  Random Level Generation\n#\n###########################################\n\n:const CENTER_X         8\n:const CENTER_Y         5\n:const DRUNKARD_STEPS 120\n:const MOB_GOAL         6 # (actual instances will be lower)\n\nto-data\n\n: random-deltas\n\t-1  0 # left\n\t-1  0 # left\n\t 1  0 # right\n\t 1  0 # right\n\t 0 -1 # up\n\t 0  1 # down\n\t 0  0 # n/a\n\t 0  0 # n/a\n\n: random-mobs\n\t:byte TILE_ROACH_D\n\t:byte TILE_ROACH_U\n\t:byte TILE_ROACH_L\n\t:byte TILE_MOTH\n\t:byte TILE_MOTH\n\t:byte TILE_MOTH\n\t:byte TILE_MOTH\n\t:byte TILE_LLAMA\n\nto-code\n\n: gen-pick-tile\n\tloop\n\t\tv0 := random 0xFF\n\t\tif v0 > BOARD_END then\n\tagain\n;\n: gen-place-tile # v1: tile, v3: valid target tile\n\tgen-pick-tile\n\ti := long board\n\ti += v0\n\tload vf - vf\n\tif vf == v3 then save v1 - v1\n;\n: gen-level\n\t# zero the board buffer\n\tv0 := 0\n\tv1 := 0\n\tv2 := 1\n\ti  := long board\n\tloop\n\t\tsave v1 - v1\n\t\ti += v2\n\t\tv0 += 1\n\t\tif v0 != BOARD_SIZE then\n\tagain\n\n\t# perform a drunkard's walk to lay down\n\t# a random pattern of contiguous floor tiles:\n\tmob-x := CENTER_X\n\tmob-y := CENTER_Y\n\tv2 := 0\n\tloop\n\t\t# random direction, biased horizontal\n\t\ti  := long random-deltas\n\t\tvf := random 0b1110\n\t\ti  += vf\n\t\tload v1\n\t\t# random step count 1-4,\n\t\t# to bias toward creating longer hallway-like structures\n\t\tv3 := random 0b11\n\t\tv3 += 1\n\t\tloop\n\t\t\tmob-x += v0\n\t\t\tmob-y += v1\n\t\t\tif mob-x == -1           then mob-x -= v0\n\t\t\tif mob-x == BOARD_WIDTH  then mob-x -= v0\n\t\t\tif mob-y == -1           then mob-y -= v1\n\t\t\tif mob-y == BOARD_HEIGHT then mob-y -= v1\n\t\t\tboard-addr\n\t\t\tvf := TILE_FLOOR\n\t\t\tsave vf - vf\n\n\t\t\tv3 += -1\n\t\t\tif v3 != 0 then\n\t\tagain\n\t\tv2 += 1\n\t\tif v2 != DRUNKARD_STEPS then\n\tagain\n\n\t# all empty tiles adjacent to floor tiles become wall tiles:\n\tmob-x := 0\n\tmob-y := 0\n\tloop\n\t\tboard-addr\n\t\tload vf - vf\n\t\tif vf == TILE_NOTHING begin\n\t\t\tve := 0\n\t\t\t:macro try-wall-adjacent SRC EDGE DELTA {\n\t\t\t\tif SRC != EDGE begin\n\t\t\t\t\tSRC += DELTA\n\t\t\t\t\tboard-addr\n\t\t\t\t\tload vf - vf\n\t\t\t\t\tif vf == TILE_FLOOR then ve := 1\n\t\t\t\t\t:calc negdelta { - DELTA }\n\t\t\t\t\tSRC += negdelta\n\t\t\t\tend\n\t\t\t}\n\t\t\ttry-wall-adjacent mob-x -1 -1\n\t\t\ttry-wall-adjacent mob-x 15  1\n\t\t\ttry-wall-adjacent mob-y -1 -1\n\t\t\ttry-wall-adjacent mob-y  8  1\n\t\t\tif ve != 0 begin\n\t\t\t\tboard-addr\n\t\t\t\tvf := TILE_WALL\n\t\t\t\tsave vf - vf\n\t\t\tend\n\t\tend\n\t\tmob-x += 1\n\t\tif mob-x == BOARD_WIDTH then mob-y += 1\n\t\tif mob-x == BOARD_WIDTH then mob-x := 0\n\t\tif mob-y != BOARD_HEIGHT then\n\tagain\n\n\t# first floor (raw) becomes player spawn:\n\ti  := long board\n\tvf := 1\n\tloop\n\t\tload v0 - v0\n\t\twhile v0 != TILE_FLOOR\n\t\ti += vf\n\tagain\n\tvf := TILE_PLAYER\n\tsave vf - vf\n\n\t# last floor (raw) becomes stairs down:\n\tvf := BOARD_END\n\tloop\n\t\ti := long board\n\t\ti += vf\n\t\tload v0 - v0\n\t\twhile v0 != TILE_FLOOR\n\t\tvf += -1\n\tagain\n\tvf := TILE_STAIRS_DOWN\n\tsave vf - vf\n\n\t# try until we succeed to place an alium:\n\tloop\n\t\tgen-pick-tile\n\t\ti := long board\n\t\ti += v0\n\t\tload vf - vf\n\t\tif vf != TILE_FLOOR then\n\tagain\n\tvf := TILE_GARLIC\n\tsave vf - vf\n\t# optionally, place a second alium:\n\tv1 := TILE_GARLIC\n\tv3 := TILE_FLOOR\n\tgen-place-tile\n\n\t# try a few times to place moths/roaches/llamas,\n\t# but it's OK if a given placement fails:\n\tv2 := 0\n\tloop\n\t\ti  := long random-mobs\n\t\tvf := random 0b111\n\t\ti  += vf\n\t\tload v1 - v1\n\n\t\t# llamas are impassable and indestructible, so if we deposit them\n\t\t# on a floor tile, there's a small chance we could block the path\n\t\t# to the exit tile. wall tiles on the other hand are by definition\n\t\t# adjacent to floor (and thus reachable), and replacing one will\n\t\t# leave access to the exit intact:\n\t\tv3 := TILE_FLOOR\n\t\tif v1 == TILE_LLAMA then v3 := TILE_WALL\n\t\tgen-place-tile\n\t\tv2 += 1\n\t\tif v2 != MOB_GOAL then\n\tagain\n;\n\n###########################################\n#\n#  Items\n#\n###########################################\n\n:macro bump-tile {\n\t# ve has the direction the source mob is moving\n\t# v2 has the source mob index (usually 0, the player)\n\t# v5-v7 have the source mob data,\n\t# except mob-x/mob-y are temporarily on the target tile.\n\t# all other non-global registers may be modified freely.\n\n\tboard-addr\n\tload v0\n\tif v0 == TILE_GARLIC begin\n\t\treplace-tile TILE_FLOOR\n\t\ti := game-transition\n\t\tv0 := TRANSITION_ADD_SCORE\n\t\tsave v0 - v0\n\t\tjump bump-tile-end\n\tend\n\tif v0 == TILE_STAIRS_DOWN begin\n\t\ti := current-map\n\t\tload v0 - v0\n\t\tif v0 == 2 begin\n\t\t\ti := player-score\n\t\t\tload v0 - v0\n\t\t\tif v0 >= SCORE_GOAL begin\n\t\t\t\ti := current-map\n\t\t\t\tv0 := 3\n\t\t\t\tsave v0 - v0\n\t\t\tend\n\t\telse\n\t\t\tv0 += 1\n\t\t\tsave v0 - v0\n\t\tend\n\t\ti := game-transition\n\t\tv0 := TRANSITION_GOTO_MAP\n\t\tsave v0 - v0\n\t\tjump bump-tile-end\n\tend\n\t: bump-tile-end\n}\n\n###########################################\n#\n#  Mob Interaction\n#\n###########################################\n\n:macro bump-mob {\n\t# ve has the direction the source mob is moving\n\t# vf has the target mob index\n\t# v2 has the source mob index (usually 0, the player)\n\t# v5-v7 have the source mob data,\n\t# except mob-x/mob-y are temporarily on the target tile.\n\t# all other non-global registers may be modified freely.\n\n\tv0 := mob-index # stash this temporarily\n\tmob-index := vf\n\tload-mob-regs # retrieve target\n\n\tif mob-type == MOB_TYPE_MOTH begin\n\t\t# obliterate moths on contact\n\t\tv1 := 1\n\t\ti  := mob-pow-table\n\t\ti  += mob-index\n\t\tsave v1 - v1\n\t\ti  := mob-dead-table\n\t\ti  += mob-index\n\t\tsave v1 - v1\n\tend\n\tif mob-type == MOB_TYPE_LLAMA begin\n\t\t# llamas fully heal the player\n\t\ti  := mob-hug-table\n\t\ti  += mob-index\n\t\tv1 := 1\n\t\tsave v1 - v1\n\t\ti  := game-transition\n\t\tvf := TRANSITION_HEAL_PLAYER\n\t\tsave vf - vf\n\tend\n\n\tmob-index := v0\n}\n\n###########################################\n#\n#  Mob Planning\n#\n###########################################\n\n: deltas\n\t-1  0 # 0  left\n\t 1  0 # 1  right\n\t 0 -1 # 2  up\n\t 0  1 # 3  down\n\n# reposition a mob based on a direction in ve\n: mob-move-dir\n\ti := deltas\n\ti += ve\n\ti += ve\n\tload v0 - v1\n\tmob-x += v0\n\tmob-y += v1\n;\n\n# before animation for a turn begins, each mob\n# plans its actions (independently) and sets up\n# auxiliary tables with its decisions.\n:macro mobs-plan {\n\t# compute a movement plan, and any side-effects, for every active mob.\n\tmob-index := 0\n\tloop\n\t\tload-mob-regs\n\t\tif mob-type != MOB_TYPE_NONE then mob-planner-dispatch\n\t\ti := mob-move-table\n\t\ti += mob-index\n\t\tsave v0\n\t\tmob-index += 1\n\t\tif mob-index != MOB_COUNT then\n\tagain\n\n\t# anything that is dead has its movement plan canceled:\n\tmob-index := 0\n\tloop\n\t\tload-mob-regs\n\t\tif mob-type != MOB_TYPE_NONE begin\n\t\t\ti := mob-dead-table\n\t\t\ti += mob-index\n\t\t\tload v0\n\t\t\tif v0 != 0 begin\n\t\t\t\ti := mob-move-table\n\t\t\t\ti += mob-index\n\t\t\t\tv0 := MOVE_NONE\n\t\t\t\tsave v0\n\t\t\tend\n\t\tend\n\t\tmob-index += 1\n\t\tif mob-index != MOB_COUNT then\n\tagain\t\n}\n\n# the 'mob-planner' routines are all expected\n# to leave mob-index intact and return the direction\n# they wish to move (or -1) in v0.\n# they are free to destroy the mob status registers:\n: mob-planner-dispatch\n\tv0 := mob-type\n\tv0 += v0 # jump table entries are 2 bytes wide\n\tjump0 mob-planners\n\t: mob-planners\n\t\tjump mob-planner-player\n\t\tjump mob-planner-llama\n\t\tjump mob-planner-moth\n\t\tjump mob-planner-roach\n\n: mob-planner-llama\n\t# llamas just sit there;\n\t# no planning necessary.\n\tv0 := -1\n;\n\n: mob-planner-player\n\tve := 0 # direction\n\tloop\n\t\tif input == ve begin\n\t\t\tinput := -1\n\t\t\tmob-move-dir\n\t\t\tmob-check\n\t\t\tif vf != -1 begin\n\t\t\t\tbump-mob\n\t\t\t\tv0 := ve\n\t\t\t\tv0 += BUMP_OFFSET\n\t\t\t\treturn\n\t\t\tend\n\t\t\tboard-check\n\t\t\tif vf != 0 begin\n\t\t\t\tbump-tile\n\t\t\t\tv0 := ve\n\t\t\t\tv0 += BUMP_OFFSET\n\t\t\t\treturn\n\t\t\tend\n\t\t\t# move unimpeded in a direction:\n\t\t\tv0 := ve\n\t\t\treturn\n\t\tend\n\t\tve += 1\n\t\tif ve != 4 then\n\tagain\n\t# this should not happen:\n\t:breakpoint unknown-player-input\n\tNOOP\n\n: mob-planner-moth\n\tve := random 0b11 # { 0, 1, 2, 3 }\n\tmob-move-dir\n\t# note: moths are small, so they don't bother\n\t# to check collision with other mobs.\n\t# larger mobs might want to via mob-check!\n\tboard-check\n\tv0 := ve\n\tif vf != 0 then v0 := -1\n;\n\nto-data\n: roach-turns\n\t# each entry is { turn RIGHT, STRAIGHT, turn LEFT, REVERSE }\n\t# you could easily create left-followers or other patterns\n\t# by altering this lookup table:\n\t2 0 3 1 # 0 facing left\n\t3 1 2 0 # 1 facing right\n\t1 2 0 3 # 2 facing up\n\t0 3 1 2 # 3 facing down\nto-code\n\n: mob-planner-roach\n\t# roaches attempt to follow the wall to their right:\n\tv3 := 0\n\tloop\n\t\ti := mob-roach-dir\n\t\ti += mob-index\n\t\tload ve - ve\n\t\ti  := long roach-turns\n\t\tve += ve # *2\n\t\tve += ve # *4\n\t\ti  += ve\n\t\ti  += v3\n\t\tload ve - ve # direction to try moving...\n\t\tmob-move-dir\n\t\tboard-check\n\t\twhile vf != 0\n\t\tmob-x -= v0\n\t\tmob-y -= v1\n\t\tv3 += 1\n\t\tif v3 != 4 then\n\tagain\n\ti := mob-roach-dir\n\ti += mob-index\n\tsave ve - ve\n\tv0 := ve\n;\n\n###########################################\n#\n#  Mob Animation\n#\n###########################################\n\nto-data\n: player-sprites\n\tsprite-begin\n\t\t0x00 0x28 0x38 0x68 0x74 0xBC 0x28\n\t\t0x28 0x38 0x68 0x74 0x7C 0x78 0x30\n\t\t0x00 0x28 0x38 0x68 0x74 0x7C 0x28\n\t\t0x28 0x38 0x28 0x74 0x7C 0x78 0x18\n\tsprite-end\n: llama-sprites\n\tsprite-begin\n\t\t0x68 0xD0 0xF0 0x32 0x3E 0x3E 0x24\n\t\t0x60 0xD8 0xF0 0x32 0x3E 0x3E 0x24\n\t\t0x00 0x60 0xD8 0xF2 0x3E 0x3E 0x14\n\t\t0x60 0xD8 0xF0 0x32 0x3E 0x3E 0x24\n\tsprite-end\n: moth-sprites\n\tsprite-begin\n\t\t0x00 0x00 0x50 0x20 0x00 0x00 0x00\n\t\t0x00 0x00 0x00 0x30 0x00 0x00 0x00\n\t\t0x00 0x14 0x08 0x00 0x00 0x00 0x00\n\t\t0x00 0x00 0x00 0x10 0x00 0x00 0x00\n\tsprite-end\n: roach-sprites\n\tsprite-begin\n\t\t0x00 0x0A 0x0E 0xFA 0xFE 0x7C 0x54\n\t\t0x0A 0x0E 0x0A 0x3E 0xFC 0xFC 0x34\n\t\t0x00 0x0A 0x0E 0xFA 0xFE 0x7C 0x54\n\t\t0x00 0x80 0xEA 0xFE 0x7A 0x7E 0x68\n\tsprite-end\n\n: mob-sprite-table\n\tpointer player-sprites\n\tpointer llama-sprites\n\tpointer moth-sprites\n\tpointer roach-sprites\n\n# for each direction 0-3, and bump 4-7,\n# four frames of x/y offsets from the mob's starting position:\n: mob-animation-offsets\n\t-1  0  -3  0  -5  0  -7  0 # walk left\n\t 1  0   3  0   5  0   7  0 # walk right\n\t 0 -1   0 -3   0 -5   0 -7 # walk up\n\t 0  1   0  3   0  5   0  7 # walk down\n\n\t-1  0  -2  0  -1  0   0  0 # bump left\n\t 1  0   2  0   1  0   0  0 # bump right\n\t 0 -1   0 -2   0 -1   0  0 # bump up\n\t 0  1   0  2   0  1   0  0 # bump down\n\n: heart # for hugs\n\t0x6C 0xFE 0xFE 0x7C 0x38 0x10\n: smallheart # for HUD\n\t0x50 0xE8 0xF8 0x70 0x20\n: pow-sprites # attack animation\n\t0x00 0x10 0x70 0x38 0x20 0x00 0x00\n\t0x12 0x78 0xD8 0x7C 0x78 0x24 0x80\n\t0x12 0x78 0xD8 0x7C 0x78 0x24 0x80\n\t0x00 0x10 0x70 0x38 0x20 0x00 0x00\n\nto-code\n\n: mob-draw\n\ti := long mob-sprite-table\n\ti += mob-type\n\ti += mob-type\n\tload v0 - v1\n\ti := mob-sprite-source\n\tsave v0 - v1\n\tindirect mob-sprite-source\n\n\ti += mob-face\n\tv1 := timer\n\tv1 += mob-index # stagger mob animations\n\tv1 += mob-index # *2\n\tvf := 0b111 # modulo 8\n\tv1 &= vf\n\tv1 >>= v1\n\tset-times-7 v0 v1\n\ti += v0\n\n\tset-times-7 v0 mob-x\n\tset-times-7 v1 mob-y\n\tv0 += HORIZ_OFFSET\n\tv1 += VERT_OFFSET\n\tsprite v0 v1 7\n;\n\n# when mobs aren't taking a turn, just play an idle animation\n:macro mobs-idle {\n\tvd := timer\n\tvd += 1\n\tif vd == 8 then vd := 0\n\tmob-index := 0\n\tloop\n\t\tload-mob-regs\n\t\tif mob-type != MOB_TYPE_NONE begin\n\t\t\tmob-draw\n\t\t\tswap timer vd\n\t\t\tmob-draw\n\t\t\tswap timer vd\n\t\tend\n\t\tmob-index += 1\n\t\tif mob-index != MOB_COUNT then\n\tagain\n\ttimer := vd\n}\n\n# drawing mobs is more complex during turn-taking,\n# so we have an entirely separate drawing routine:\n: mob-draw-with-anim\n\ti := mob-move-table\n\ti += mob-index\n\tload v3 - v3\n\tif v3 != MOVE_NONE begin\n\t\tif v3 == 0 then mob-face := FACE_LEFT\n\t\tif v3 == 4 then mob-face := FACE_LEFT\n\t\tif v3 == 1 then mob-face := FACE_RIGHT\n\t\tif v3 == 5 then mob-face := FACE_RIGHT\n\tend\n\n\ti := long mob-sprite-table\n\ti += mob-type\n\ti += mob-type\n\tload v0 - v1\n\ti := animated-mob-sprite-source\n\tsave v0 - v1\n\n\tset-times-7 v0 mob-x\n\tset-times-7 v1 mob-y\n\tv0 += HORIZ_OFFSET\n\tv1 += VERT_OFFSET\n\n\ti  := long mob-animation-offsets\n\tv3 += v3\n\ti  += v3 # *2\n\ti  += v3 # *4\n\ti  += v3 # *6\n\ti  += v3 # *8\n\ti  += timer\n\ti  += timer\n\tload v3 - v3\n\tv0 += v3\n\tv3 := 1\n\ti  += v3\n\tload v3 - v3\n\tv1 += v3\n\n\tindirect animated-mob-sprite-source\n\ti  += mob-face\n\tsprite v0 v1 7\n;\n\n:macro mobs-animate {\n\t# erase normal sprites\n\tmob-index := 0\n\tloop\n\t\tload-mob-regs\n\t\tif mob-type != MOB_TYPE_NONE then mob-draw\n\t\tmob-index += 1\n\t\tif mob-index != MOB_COUNT then\n\tagain\n\n\t# animate\n\ttimer := 0\n\tloop\n\t\tmob-index := 0\n\t\tloop\n\t\t\tload-mob-regs\n\t\t\tif mob-type != MOB_TYPE_NONE begin\n\t\t\t\t# main tween\n\t\t\t\tif timer != 0 begin\n\t\t\t\t\ttimer += -1\n\t\t\t\t\tmob-draw-with-anim\n\t\t\t\t\ttimer += 1\n\t\t\t\tend\n\t\t\t\tmob-draw-with-anim\n\n\t\t\t\t# hit animation\n\t\t\t\ti := mob-pow-table\n\t\t\t\ti += mob-index\n\t\t\t\tload v3 - v3\n\t\t\t\tif v3 != 0 begin\n\t\t\t\t\ti := long pow-sprites\n\t\t\t\t\ti += timer\n\t\t\t\t\ti += timer\n\t\t\t\t\ti += timer\n\t\t\t\t\ti += timer\n\t\t\t\t\ti += timer\n\t\t\t\t\ti += timer\n\t\t\t\t\ti += timer\n\t\t\t\t\tsprite v0 v1 7\n\t\t\t\tend\n\n\t\t\t\t# hug animation\n\t\t\t\ti := mob-hug-table\n\t\t\t\ti += mob-index\n\t\t\t\tload v3 - v3\n\t\t\t\tif v3 != 0 begin\n\t\t\t\t\tv1 += -6\n\t\t\t\t\tv1 -= timer\n\t\t\t\t\tv1 -= timer\n\t\t\t\t\ti := long heart\n\t\t\t\t\tif timer != 0 then sprite v0 v1 6\n\t\t\t\t\tv1 += -2\n\t\t\t\t\tif timer != 3 then sprite v0 v1 6\n\t\t\t\tend\n\n\t\t\tend\n\t\t\tmob-index += 1\n\t\t\tif mob-index != MOB_COUNT then\n\t\tagain\n\t\twait\n\n\t\t# not buffering on the first few frames\n\t\t# provides a small natural debounce:\n\t\tif timer == 3 then buffer-input\n\n\t\ttimer += 1\n\t\tif timer != 4 then\n\tagain\n\n\t# erase animated sprites\n\t# note: this ensures that we clean up any inconsistencies\n\t# between mob-draw and mob-draw-with-anim;\n\t# otherwise we might leave behind junk pixels.\n\t# as an exercise for the tinkerer, try removing this pass!\n\ttimer += -1\n\tplane 2\n\tmob-index := 0\n\tloop\n\t\tload-mob-regs\n\t\tif mob-type != MOB_TYPE_NONE then mob-draw-with-anim\n\t\tmob-index += 1\n\t\tif mob-index != MOB_COUNT then\n\tagain\n\ttimer := 0\n\n\t# finalize changes\n\tmob-index := 0\n\tloop\n\t\tload-mob-regs\n\t\tif mob-type != MOB_TYPE_NONE begin\n\n\t\t\t# update positions, facing\n\t\t\ti := mob-move-table\n\t\t\ti += mob-index\n\t\t\tload ve - ve\n\t\t\tif ve != MOVE_NONE begin\n\t\t\t\tv0 := MOVE_NONE\n\t\t\t\tsave ve - ve\n\t\t\t\tif ve == 0 then mob-face := FACE_LEFT\n\t\t\t\tif ve == 4 then mob-face := FACE_LEFT\n\t\t\t\tif ve == 1 then mob-face := FACE_RIGHT\n\t\t\t\tif ve == 5 then mob-face := FACE_RIGHT\n\t\t\t\tif ve < BUMP_OFFSET then mob-move-dir\n\n\t\t\t\tif mob-index == 0 begin\n\t\t\t\t\tif ve < BUMP_OFFSET begin\n\t\t\t\t\t\tsfx sound-step\n\t\t\t\t\telse\n\t\t\t\t\t\tsfx sound-bump\n\t\t\t\t\tend\n\t\t\t\tend\n\t\t\tend\n\n\t\t\t# clear pow\n\t\t\ti := mob-pow-table\n\t\t\ti += mob-index\n\t\t\tv0 := 0\n\t\t\tsave v0\n\n\t\t\t# clear hug\n\t\t\ti := mob-hug-table\n\t\t\ti += mob-index\n\t\t\tv0 := 0\n\t\t\tsave v0\n\n\t\t\t# kill dead mobs\n\t\t\ti := mob-dead-table\n\t\t\ti += mob-index\n\t\t\tload v0 - v0\n\t\t\tif v0 != 0 begin\n\t\t\t\tv0 := 0\n\t\t\t\tsave v0 - v0\n\t\t\t\t#mob-draw\n\t\t\t\tmob-type := MOB_TYPE_NONE\n\t\t\telse\n\t\t\t\tmob-draw\n\t\t\tend\n\n\t\t\t# if mobs overlap player, they inflict damage:\n\t\t\tif mob-index != 0 begin\n\t\t\t\tmob-check\n\t\t\t\tif vf == 0 begin\n\t\t\t\t\ti := game-transition\n\t\t\t\t\tvf := TRANSITION_DAMAGE_PLAYER\n\t\t\t\t\tsave vf - vf\n\t\t\t\tend\n\t\t\tend\n\n\t\t\tsave-mob-regs\n\t\tend\n\t\tmob-index += 1\n\t\tif mob-index != MOB_COUNT then\n\tagain\n}\n\n###########################################\n#\n#  Transition Events\n#\n###########################################\n\n# note: it is materially important that these are inlined as part\n# of the game's main loop. some transitions could end the game (or better, or worse)\n# and need to re-initialize the game. if this occurs with any subroutine calls\n# pending on the stack, we'll leave their return address behind, leading\n# to a game that crashes after a few plays.\n# this is also a large part of the motivation of having a deferred transition\n# mechanism instead of allowing mobs/items/etc to directly end the game under their own power.\n\n:macro transitions {\n\ti := game-transition\n\tload v0\n\tif v0 == TRANSITION_GOTO_MAP begin\n\t\tplane 3\n\t\tclear\n\t\ttimer := 0\n\t\ti := current-map\n\t\tload vf - vf\n\t\tif vf != 2 begin\n\t\t\tboard-unpack\n\t\telse\n\t\t\tgen-level\n\t\t\tunpack16 board\n\t\t\tboard-unpack-raw\n\t\tend\n\t\tboard-draw\n\t\ti := game-transition\n\t\tv0 := 0\n\t\tsave v0\n\tend\n\tif v0 == TRANSITION_HEAL_PLAYER begin\n\t\tsfx sound-heal\n\t\thealth-draw\n\t\thealth-reset\n\t\thealth-draw\n\t\ti := game-transition\n\t\tv0 := 0\n\t\tsave v0\n\tend\n\tif v0 == TRANSITION_DAMAGE_PLAYER begin\n\t\tsfx sound-hurt\n\t\thealth-decrement\n\t\ti := game-transition\n\t\tv0 := 0\n\t\tsave v0\n\t\ti := player-health\n\t\tload v0 - v0\n\t\tif v0 == 0 begin\n\t\t\tplane 3\n\t\t\tclear\n\t\t\tplane 1\n\t\t\tgame-over-screen\n\t\t\twait-for-space\n\t\t\tjump main\n\t\tend\n\t\tv0 := 0\n\tend\n\tif v0 == TRANSITION_ADD_SCORE begin\n\t\tsfx sound-pickup\n\t\ti := game-transition\n\t\tv0 := 0\n\t\tsave v0\n\t\ti := player-score\n\t\tload v0 - v0\n\t\tif v0 >= SCORE_GOAL begin\n\t\t\ti := current-map\n\t\t\tload vf - vf\n\t\t\tif vf == 3 begin\n\t\t\t\t# you collected the final alium!\n\t\t\t\tplane 3\n\t\t\t\tclear\n\t\t\t\tplane 1\n\t\t\t\tyou-win-screen\n\t\t\t\twait-for-space\n\t\t\t\tjump main\n\t\t\telse\n\t\t\t\tscore-increment\n\t\t\tend\n\t\telse\n\t\t\tscore-increment\n\t\tend\n\t\tv0 := 0\n\tend\n}\n\n:macro debug-keys {\n\tvf := OCTO_KEY_1  if vf key begin\n\t\ti := game-transition\n\t\tvf := TRANSITION_DAMAGE_PLAYER\n\t\tsave vf - vf\n\tend\n\tvf := OCTO_KEY_2  if vf key begin\n\t\ti := game-transition\n\t\tvf := TRANSITION_ADD_SCORE\n\t\tsave vf - vf\n\tend\n}\n\n###########################################\n#\n#  Main Loop\n#\n###########################################\n\n: main\n\thires\n\n\tplane 3\n\tclear\n\ti  := current-map\n\tvf := 0\n\tsave vf - vf\n\tinput := -1\n\ttimer := 0\n\thealth-reset\n\tscore-reset\n\tboard-unpack\n\tboard-draw\n\n\tloop\n\t\ttransitions\n\n\t\tplane 2\n\t\tif input != -1 begin\n\t\t\tmobs-plan\n\t\t\tmobs-animate\n\t\telse\n\t\t\tmobs-idle\n\t\tend\n\n\t\t# note: remove these before shipping the game, probably:\n\t\tdebug-keys\n\n\t\tloop\n\t\t\tbuffer-input\n\t\t\tvf := delay\n\t\t\tif vf != 0 then\n\t\tagain\n\t\tvf := 5\n\t\tdelay := vf\n\tagain\n","options":{"tickrate":1000,"fillColor":"lightcyan","fillColor2":"aquamarine","blendColor":"aquamarine","backgroundColor":"#001000","buzzColor":"#333333","quietColor":"#000000","shiftQuirks":false,"loadStoreQuirks":false,"vfOrderQuirks":false,"clipQuirks":false,"vBlankQuirks":false,"jumpQuirks":false,"screenRotation":0,"maxSize":65024,"touchInputMode":"swipe","logicQuirks":false,"fontStyle":"octo","displayScale":"6"},"rom":[23,226,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,162,6,242,30,242,30,242,30,242,30,0,238,34,26,84,114,0,238,34,26,84,115,0,238,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,7,63,0,18,75,111,3,255,21,0,238,60,255,0,238,111,7,239,161,108,0,111,9,239,161,108,1,111,5,239,161,108,2,111,8,239,161,108,3,0,238,111,6,239,161,18,119,239,158,18,123,239,161,18,127,0,238,240,2,111,1,255,24,0,238,96,0,97,0,98,16,99,32,100,48,208,16,243,30,208,32,243,30,208,48,243,30,208,64,243,30,112,16,48,128,18,151,0,238,241,1,96,1,97,1,162,4,82,35,240,0,36,210,66,0,18,201,208,21,113,6,114,255,18,189,0,238,0,0,0,162,5,240,101,162,203,240,51,242,101,240,41,99,123,96,1,211,5,112,6,241,41,211,5,112,6,242,41,211,5,0,238,162,4,82,35,66,0,0,238,114,255,82,34,96,1,129,32,129,20,129,36,129,20,113,1,242,1,240,0,36,210,98,4,208,21,34,75,114,255,50,0,19,14,241,1,208,21,0,238,241,1,34,206,162,5,82,35,114,1,82,34,242,1,110,4,34,206,34,75,126,255,62,0,19,46,241,1,34,206,0,238,162,4,111,3,95,242,0,238,162,5,111,0,95,242,0,238,52,0,19,94,141,32,98,0,103,0,34,38,130,208,19,108,66,5,19,108,199,1,55,0,103,28,34,38,114,1,97,12,0,238,162,3,240,101,240,0,35,116,240,30,240,30,241,101,163,152,80,18,98,0,100,255,34,38,114,1,50,5,19,134,96,0,98,1,101,0,102,0,240,0,0,0,240,30,81,19,49,255,19,166,100,0,35,78,49,254,19,174,100,1,35,78,49,253,19,182,100,2,35,78,49,252,19,198,162,65,242,30,111,0,95,242,100,3,35,78,49,251,19,214,162,65,242,30,111,1,95,242,100,3,35,78,49,250,19,230,162,65,242,30,111,2,95,242,100,3,35,78,49,249,19,246,162,65,242,30,111,3,95,242,100,3,35,78,240,0,32,164,240,30,81,18,112,1,117,1,69,16,118,1,69,16,101,0,54,9,19,150,0,238,243,1,98,1,99,0,97,8,240,0,32,164,243,30,240,101,240,0,32,80,240,30,209,38,115,1,113,7,49,120,20,24,114,7,50,64,20,22,242,1,98,0,34,44,52,255,39,50,114,1,50,5,20,58,162,3,240,101,48,0,20,88,241,1,240,0,16,80,34,141,0,238,48,2,20,98,34,175,34,206,0,238,48,3,20,110,241,1,240,0,28,80,34,141,0,238,240,0,32,164,245,30,141,96,141,212,141,212,141,212,141,212,253,30,0,238,36,112,93,211,111,24,141,245,69,255,111,255,69,16,111,255,70,255,111,255,70,9,111,255,0,238,111,0,159,32,20,200,162,6,255,30,255,30,255,30,255,30,93,211,77,255,20,200,109,1,253,30,93,211,93,80,20,200,109,1,253,30,93,211,157,96,0,238,127,1,63,5,20,160,111,255,0,238,128,80,128,4,128,84,128,4,128,84,129,96,129,20,129,100,129,20,129,100,112,8,113,1,240,0,32,80,253,30,208,22,0,238,192,255,111,143,143,5,79,0,20,244,0,238,36,244,240,0,32,164,240,30,95,243,159,48,81,18,0,238,96,0,97,0,98,1,240,0,32,164,81,18,242,30,112,1,48,144,21,26,101,8,102,5,98,0,240,0,35,124,207,14,255,30,241,101,195,3,115,1,133,4,134,20,69,255,133,5,69,16,133,5,70,255,134,21,70,9,134,21,36,112,111,12,95,242,115,255,51,0,21,56,114,1,50,120,21,42,101,0,102,0,36,112,95,243,63,0,21,182,110,0,69,255,21,124,117,255,36,112,95,243,79,12,110,1,117,1,69,15,21,140,117,1,36,112,95,243,79,12,110,1,117,255,70,255,21,156,118,255,36,112,95,243,79,12,110,1,118,1,70,8,21,172,118,1,36,112,95,243,79,12,110,1,118,255,78,0,21,182,36,112,111,24,95,242,117,1,69,16,118,1,69,16,101,0,54,9,21,98,240,0,32,164,111,1,80,3,64,12,21,212,255,30,21,202,111,255,95,242,111,143,240,0,32,164,255,30,80,3,64,12,21,234,127,255,21,218,111,48,95,242,36,244,240,0,32,164,240,30,95,243,63,12,21,238,111,72,95,242,97,72,99,12,37,0,98,0,240,0,35,140,207,7,255,30,81,19,99,12,65,254,99,24,37,0,114,1,50,6,22,8,0,238,255,0,1,0,0,255,0,1,166,34,254,30,254,30,80,19,133,4,134,20,0,238,128,64,128,4,182,62,22,74,22,70,22,242,23,0,96,255,0,238,110,0,92,224,22,234,108,255,38,42,36,158,79,255,22,140,128,32,130,240,34,44,52,2,22,114,97,1,162,50,242,30,81,18,162,60,242,30,81,18,52,1,22,132,162,55,242,30,97,1,81,18,162,2,111,3,95,242,130,0,128,224,112,4,0,238,36,132,79,0,22,230,36,112,240,101,48,72,22,180,36,112,93,211,243,1,36,210,36,112,109,12,93,210,36,210,242,1,162,2,96,4,80,2,22,224,48,48,22,224,162,3,80,3,48,2,22,212,162,5,80,3,111,15,143,7,79,0,22,210,162,3,96,3,80,2,22,216,112,1,80,2,162,2,96,1,80,2,22,224,128,224,112,4,0,238,128,224,0,238,126,1,62,4,22,76,143,240,206,3,38,42,36,132,128,224,63,0,96,255,0,238,99,0,162,65,242,30,94,227,240,0,35,148,142,228,142,228,254,30,243,30,94,227,38,42,36,132,79,0,23,40,133,5,134,21,115,1,51,4,23,2,162,65,242,30,94,226,128,224,0,238,240,0,36,132,244,30,244,30,80,19,167,66,80,18,240,0,0,0,247,30,129,176,129,36,129,36,111,7,129,242,129,22,128,16,128,4,128,20,128,4,128,20,240,30,128,80,128,4,128,84,128,4,128,84,129,96,129,20,129,100,129,20,129,100,112,8,113,1,208,23,0,238,162,70,242,30,83,51,67,255,23,148,67,0,103,28,67,4,103,28,67,1,103,0,67,5,103,0,240,0,36,132,244,30,244,30,80,19,167,218,80,18,128,80,128,4,128,84,128,4,128,84,129,96,129,20,129,100,129,20,129,100,112,8,113,1,240,0,36,140,131,52,243,30,243,30,243,30,243,30,251,30,251,30,83,51,128,52,99,1,243,30,83,51,129,52,240,0,0,0,247,30,208,23,0,238,0,255,243,1,0,224,162,3,111,0,95,242,108,255,107,0,35,62,35,70,35,112,36,16,162,2,240,101,48,1,24,36,243,1,0,224,107,0,162,3,95,243,79,2,24,20,35,112,24,28,37,16,96,32,97,164,35,126,36,16,162,2,96,0,240,85,48,3,24,58,240,0,16,48,34,133,34,175,35,62,34,175,162,2,96,0,240,85,48,2,24,102,240,0,16,64,34,133,34,238,162,2,96,0,240,85,162,4,80,3,48,0,24,100,243,1,0,224,241,1,240,0,20,80,34,141,34,117,23,226,96,0,48,4,24,164,240,0,16,32,34,133,162,2,96,0,240,85,162,5,80,3,111,15,143,7,79,0,24,160,162,3,95,243,63,3,24,156,243,1,0,224,241,1,240,0,24,80,34,141,34,117,23,226,24,158,35,30,24,162,35,30,96,0,242,1,76,255,25,234,98,0,34,44,52,255,38,56,162,70,242,30,240,85,114,1,50,5,24,172,98,0,34,44,68,255,24,216,162,60,242,30,240,101,64,0,24,216,162,70,242,30,96,255,240,85,114,1,50,5,24,192,98,0,34,44,52,255,39,50,114,1,50,5,24,224,107,0,98,0,34,44,68,255,25,62,75,0,25,0,123,255,39,122,123,1,39,122,162,50,242,30,83,51,67,0,25,32,240,0,36,215,251,30,251,30,251,30,251,30,251,30,251,30,251,30,208,23,162,55,242,30,83,51,67,0,25,62,113,250,129,181,129,181,240,0,36,204,59,0,208,22,113,254,59,3,208,22,114,1,50,5,24,240,34,75,75,3,34,87,123,1,59,4,24,238,123,255,242,1,98,0,34,44,52,255,39,122,114,1,50,5,25,86,107,0,98,0,34,44,68,255,25,226,162,70,242,30,94,227,78,255,25,172,96,255,94,226,78,0,103,28,78,4,103,28,78,1,103,0,78,5,103,0,111,4,143,231,79,0,38,42,50,0,25,172,111,4,143,231,63,0,25,166,240,0,16,0,34,133,25,172,240,0,16,16,34,133,162,50,242,30,96,0,240,85,162,55,242,30,96,0,240,85,162,60,242,30,80,3,64,0,25,206,96,0,80,2,100,255,25,208,39,50,66,0,25,224,36,158,63,0,25,224,162,2,111,2,95,242,34,38,114,1,50,5,25,102,26,18,141,176,125,1,77,8,109,0,98,0,34,44,68,255,26,10,39,50,143,176,139,208,141,240,39,50,143,176,139,208,141,240,114,1,50,5,25,244,139,208,111,1,239,158,26,30,162,2,111,2,95,242,111,2,239,158,26,42,162,2,111,4,95,242,34,87,255,7,63,0,26,42,111,5,255,21,23,250,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,33,0,8,102,0,216,1,176,32,16,16,0,0,0,0,252,15,192,252,15,192,248,31,129,248,31,129,240,63,3,240,227,142,56,227,142,56,199,28,113,199,28,113,206,56,227,142,165,223,113,220,80,29,56,151,90,125,223,181,229,244,151,213,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,254,31,254,31,246,28,26,28,28,28,14,28,2,28,0,28,0,28,254,29,30,29,78,28,142,28,14,28,14,28,14,31,254,31,254,15,252,0,0,0,0,0,127,0,128,0,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,199,127,231,127,231,112,231,112,231,112,231,112,231,112,231,112,231,127,231,127,231,127,231,112,231,112,231,112,231,112,231,112,231,112,231,249,247,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,1,0,0,255,0,0,0,0,252,126,254,121,254,114,14,112,14,112,14,112,14,112,14,112,30,112,252,112,248,112,252,112,30,112,14,112,14,112,14,112,14,127,14,127,159,127,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,165,222,180,146,172,146,164,146,164,146,164,158,0,0,0,0,31,63,14,127,14,127,14,112,14,114,14,113,14,112,14,112,14,112,14,112,14,112,14,112,14,113,142,114,78,112,206,112,206,127,206,127,223,63,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,58,94,18,80,19,216,18,80,18,80,18,95,0,0,0,0,199,248,239,253,239,253,238,29,238,29,238,29,14,93,14,61,14,1,15,249,15,253,7,253,224,29,231,221,238,93,238,157,238,29,239,253,199,248,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,128,0,128,255,0,0,0,0,0,255,15,255,159,255,159,195,156,203,156,199,156,192,28,192,28,192,28,192,31,192,31,192,31,199,156,203,156,195,156,195,156,255,156,255,156,255,62,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,240,255,249,255,249,255,57,231,57,195,57,195,57,203,57,211,57,211,249,223,249,223,249,207,57,192,57,192,57,192,57,192,57,192,57,192,125,224,0,0,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,248,159,248,159,216,156,104,156,48,156,24,156,8,156,192,156,64,159,192,159,192,31,192,28,64,28,16,28,8,28,24,31,248,31,248,63,248,0,0,0,0,254,0,1,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,128,0,255,32,0,63,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,63,255,32,0,0,255,0,128,0,192,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,3,243,0,192,0,97,0,51,0,30,0,12,0,12,0,12,0,12,0,12,0,12,0,12,0,12,0,63,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,241,199,195,97,134,49,6,49,12,25,12,25,12,25,12,25,12,25,12,25,6,48,6,48,3,96,1,192,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,231,224,129,128,129,128,129,128,129,128,129,128,129,128,129,128,129,128,129,128,195,0,195,0,102,0,60,0,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,63,135,12,97,12,49,12,49,12,25,12,25,12,25,12,25,12,25,12,25,12,49,12,49,12,97,63,135,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,239,249,131,24,131,12,131,4,131,0,131,16,131,240,131,16,131,0,131,0,131,4,131,12,131,24,239,249,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,252,0,99,0,97,128,97,128,96,192,96,192,96,192,96,192,96,192,96,192,97,128,97,128,99,0,252,0,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,1,0,255,0,0,4,255,252,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,252,0,4,255,0,1,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,26,0,80,0,31,255,64,0,127,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,255,64,0,31,255,80,0,26,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,13,0,19,0,8,0,4,0,2,0,2,0,1,0,1,0,1,0,2,0,2,0,4,0,25,0,35,0,71,0,158,1,61,2,121,255,255,0,0,255,255,0,0,125,247,16,67,16,67,24,195,8,131,13,131,13,131,13,131,7,3,7,3,15,135,0,0,255,255,0,0,255,255,69,159,75,191,143,191,159,191,159,223,159,223,159,223,151,239,159,255,139,251,79,255,38,255,35,63,17,143,12,96,2,0,1,128,0,127,0,0,0,0,0,0,0,0,0,0,198,0,170,0,146,0,18,0,2,0,73,0,41,0,45,0,84,128,22,192,26,56,43,7,53,192,87,112,87,255,223,253,191,255,127,255,255,255,255,255,255,255,255,255,255,255,0,0,255,255,0,0,135,159,24,211,24,67,48,3,48,3,48,3,48,3,48,3,24,67,24,195,135,135,0,0,255,255,0,0,255,255,255,223,255,223,255,239,255,239,255,239,255,247,255,251,255,255,255,255,255,255,255,255,126,255,159,63,192,7,0,0,1,192,6,73,248,172,0,166,0,91,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,192,0,63,192,0,56,192,6,255,193,191,240,239,252,243,255,252,255,254,126,255,63,255,255,0,0,255,255,0,0,227,135,44,99,12,99,24,51,24,51,24,51,24,51,24,51,12,99,12,99,131,135,0,0,255,255,0,0,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,254,255,252,255,192,0,0,0,2,34,83,173,77,215,106,182,149,75,8,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,64,0,32,0,16,0,136,0,196,0,98,0,255,255,0,0,255,255,0,0,249,206,12,132,12,72,12,72,248,48,48,48,24,48,24,48,12,48,12,48,158,120,0,0,255,255,0,0,255,255,153,242,220,249,220,249,220,250,184,234,185,244,113,192,225,129,192,2,128,28,31,224,48,0,40,0,16,0,200,0,112,0,40,0,208,0,64,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,0,0,255,255,64,0,32,0,32,0,32,0,32,0,64,0,64,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,88,0,10,255,248,0,2,255,254,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,254,0,2,255,248,0,10,0,88,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,2,0,6,0,7,0,7,0,3,0,3,0,2,0,16,0,9,0,13,0,22,0,106,1,109,2,110,2,117,3,127,2,199,1,56,0,128,0,112,0,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,0,96,0,224,0,96,3,240,1,248,1,126,1,255,35,193,39,62,238,113,201,239,195,223,223,223,190,223,189,255,163,191,159,159,191,175,191,179,190,24,142,212,49,35,142,0,0,240,0,95,255,52,1,12,169,10,250,10,170,10,34,10,250,14,35,10,250,10,250,10,34,10,250,14,171,10,34,9,252,18,34,20,249,52,33,200,168,144,168,240,248,14,35,1,252,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,128,0,192,0,224,128,227,0,245,0,235,128,91,192,91,192,53,224,181,240,182,112,187,176,189,212,30,218,47,250,96,246,199,26,88,228,32,8,0,112,127,128,208,0,96,0,128,0,128,0,128,0,128,0,128,0,128,0,128,0,128,0,128,0,128,0,128,0,128,0,128,0,64,0,64,0,96,0,152,0,78,0,120,0,128,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,252,4,188,16,252,180,0,0,0,0,0,0,0,0,0,0,0,0,120,252,116,244,124,252,0,0,0,0,0,0,252,132,196,212,212,252,192,208,20,196,240,252,0,0,0,0,0,0,0,0,0,0,0,0,56,80,168,180,180,104,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,24,24,24,24,24,0,0,0,0,0,0,0,0,24,255,12,12,12,12,48,24,0,0,0,0,0,0,0,0,24,24,24,24,24,24,24,24,0,0,0,0,0,0,0,72,72,0,0,0,0,12,0,0,72,0,72,0,0,0,72,0,0,72,0,12,0,0,0,72,72,0,0,0,0,253,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,24,24,24,24,24,24,24,24,24,24,0,12,0,0,12,0,24,255,12,12,12,12,12,12,48,24,249,0,0,0,0,0,24,24,24,24,24,24,24,24,24,24,0,0,0,0,72,0,0,0,0,12,72,72,0,0,0,0,12,72,72,0,12,72,72,0,0,0,0,0,0,253,0,0,72,72,72,0,0,72,72,0,12,0,0,0,0,0,72,0,0,72,72,0,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,24,24,24,24,24,24,24,0,0,24,48,24,24,24,24,24,24,253,12,12,12,12,24,24,24,24,12,24,24,12,12,12,24,12,12,24,12,12,12,12,12,24,12,24,24,12,255,12,24,12,12,12,12,12,12,12,12,12,12,24,24,12,60,12,12,12,12,24,24,24,24,12,253,24,24,24,24,254,12,12,24,12,12,24,0,0,24,24,24,24,0,0,24,24,24,24,24,72,72,24,0,0,0,0,0,0,0,0,0,0,0,0,24,24,24,24,0,0,0,0,0,0,0,0,0,0,72,0,12,0,0,72,72,0,24,0,0,0,0,0,0,12,0,72,24,24,24,24,24,24,24,0,0,0,0,0,72,0,72,72,24,12,12,12,12,12,12,0,0,0,0,0,0,24,24,24,24,12,24,12,12,12,0,0,0,0,0,0,0,24,60,255,12,12,12,12,12,12,12,0,0,0,0,0,0,24,24,24,24,12,24,12,12,12,0,0,0,0,0,0,0,0,72,72,24,12,12,12,12,12,12,0,0,0,0,0,0,12,0,72,24,24,24,24,24,12,12,12,12,72,12,0,0,0,72,0,0,12,72,72,24,24,24,24,24,24,0,0,33,52,33,196,34,84,34,228,255,0,255,0,1,0,1,0,0,255,0,1,0,0,0,0,249,250,252,253,253,253,253,254,2,0,3,1,3,1,2,0,1,2,0,3,0,3,1,2,0,40,56,104,116,188,40,40,56,104,116,124,120,48,0,40,56,104,116,124,40,40,56,40,116,124,120,24,0,40,56,44,92,122,40,40,56,44,92,124,60,24,0,40,56,44,92,124,40,40,56,40,92,124,60,48,104,208,240,50,62,62,36,96,216,240,50,62,62,36,0,96,216,242,62,62,20,96,216,240,50,62,62,36,44,22,30,152,248,248,72,12,54,30,152,248,248,72,0,12,54,158,248,248,80,12,54,30,152,248,248,72,0,0,80,32,0,0,0,0,0,0,48,0,0,0,0,20,8,0,0,0,0,0,0,0,16,0,0,0,0,0,20,8,0,0,0,0,0,0,24,0,0,0,0,80,32,0,0,0,0,0,0,0,16,0,0,0,0,10,14,250,254,124,84,10,14,10,62,252,252,52,0,10,14,250,254,124,84,0,128,234,254,122,126,104,0,160,224,190,254,124,84,160,224,160,248,126,126,88,0,160,224,190,254,124,84,0,2,174,254,188,252,44,35,164,35,220,36,20,36,76,255,0,253,0,251,0,249,0,1,0,3,0,5,0,7,0,0,255,0,253,0,251,0,249,0,1,0,3,0,5,0,7,255,0,254,0,255,0,0,0,1,0,2,0,1,0,0,0,0,255,0,254,0,255,0,0,0,1,0,2,0,1,0,0,108,254,254,124,56,16,80,232,248,112,32,0,16,112,56,32,0,0,18,120,216,124,120,36,128,18,120,216,124,120,36,128,0,16,112,56,32,0,0]}</script>
<script>"use strict";

function invertKeymap(k) {
	return Object.keys(k).reduce((a,b) => {
		Object.keys(k[b]).forEach(x => a[x]=+b)
		return a
	}, {})
}

function getPref(key) {
	try { return JSON.parse(localStorage.getItem(key)) }
	catch(e) { console.log(e); return null }
}
function setPref(key, value) {
	try { localStorage.setItem(key, JSON.stringify(value)) }
	catch(e) { console.log(e); }
}

var keymap = (this.STATIC_KEYMAP) || getPref('octoKeymap') || {
	0x0: { x:1 },
	0x1: { 1:1 },
	0x2: { 2:1 },
	0x3: { 3:1 },
	0x4: { q:1 },
	0x5: { w:1, ArrowUp:1 },
	0x6: { e:1, ' ':1 },
	0x7: { a:1, ArrowLeft:1 },
	0x8: { s:1, ArrowDown:1 },
	0x9: { d:1, ArrowRight:1 },
	0xA: { z:1 },
	0xB: { c:1 },
	0xC: { 4:1 },
	0xD: { r:1 },
	0xE: { f:1 },
	0xF: { v:1 },
}

var keymapInverse = invertKeymap(keymap)

var smallfonts = {
	octo: [
		0xF0, 0x90, 0x90, 0x90, 0xF0, // 0
		0x20, 0x60, 0x20, 0x20, 0x70, // 1
		0xF0, 0x10, 0xF0, 0x80, 0xF0, // 2
		0xF0, 0x10, 0xF0, 0x10, 0xF0, // 3
		0x90, 0x90, 0xF0, 0x10, 0x10, // 4
		0xF0, 0x80, 0xF0, 0x10, 0xF0, // 5
		0xF0, 0x80, 0xF0, 0x90, 0xF0, // 6
		0xF0, 0x10, 0x20, 0x40, 0x40, // 7
		0xF0, 0x90, 0xF0, 0x90, 0xF0, // 8
		0xF0, 0x90, 0xF0, 0x10, 0xF0, // 9
		0xF0, 0x90, 0xF0, 0x90, 0x90, // A
		0xE0, 0x90, 0xE0, 0x90, 0xE0, // B
		0xF0, 0x80, 0x80, 0x80, 0xF0, // C
		0xE0, 0x90, 0x90, 0x90, 0xE0, // D
		0xF0, 0x80, 0xF0, 0x80, 0xF0, // E
		0xF0, 0x80, 0xF0, 0x80, 0x80, // F
	],
	vip: [
		0xF0, 0x90, 0x90, 0x90, 0xF0,
		0x60, 0x20, 0x20, 0x20, 0x70,
		0xF0, 0x10, 0xF0, 0x80, 0xF0,
		0xF0, 0x10, 0xF0, 0x10, 0xF0,
		0xA0, 0xA0, 0xF0, 0x20, 0x20,
		0xF0, 0x80, 0xF0, 0x10, 0xF0,
		0xF0, 0x80, 0xF0, 0x90, 0xF0,
		0xF0, 0x10, 0x10, 0x10, 0x10,
		0xF0, 0x90, 0xF0, 0x90, 0xF0,
		0xF0, 0x90, 0xF0, 0x10, 0xF0,
		0xF0, 0x90, 0xF0, 0x90, 0x90,
		0xF0, 0x50, 0x70, 0x50, 0xF0,
		0xF0, 0x80, 0x80, 0x80, 0xF0,
		0xF0, 0x50, 0x50, 0x50, 0xF0,
		0xF0, 0x80, 0xF0, 0x80, 0xF0,
		0xF0, 0x80, 0xF0, 0x80, 0x80,
	],
	dream6800: [
		0xE0, 0xA0, 0xA0, 0xA0, 0xE0,
		0x40, 0x40, 0x40, 0x40, 0x40,
		0xE0, 0x20, 0xE0, 0x80, 0xE0,
		0xE0, 0x20, 0xE0, 0x20, 0xE0,
		0x80, 0xA0, 0xA0, 0xE0, 0x20,
		0xE0, 0x80, 0xE0, 0x20, 0xE0,
		0xE0, 0x80, 0xE0, 0xA0, 0xE0,
		0xE0, 0x20, 0x20, 0x20, 0x20,
		0xE0, 0xA0, 0xE0, 0xA0, 0xE0,
		0xE0, 0xA0, 0xE0, 0x20, 0xE0,
		0xE0, 0xA0, 0xE0, 0xA0, 0xA0,
		0xC0, 0xA0, 0xE0, 0xA0, 0xC0,
		0xE0, 0x80, 0x80, 0x80, 0xE0,
		0xC0, 0xA0, 0xA0, 0xA0, 0xC0,
		0xE0, 0x80, 0xE0, 0x80, 0xE0,
		0xE0, 0x80, 0xC0, 0x80, 0x80,
	],
	eti660: [
		0xE0, 0xA0, 0xA0, 0xA0, 0xE0,
		0x20, 0x20, 0x20, 0x20, 0x20,
		0xE0, 0x20, 0xE0, 0x80, 0xE0,
		0xE0, 0x20, 0xE0, 0x20, 0xE0,
		0xA0, 0xA0, 0xE0, 0x20, 0x20,
		0xE0, 0x80, 0xE0, 0x20, 0xE0,
		0xE0, 0x80, 0xE0, 0xA0, 0xE0,
		0xE0, 0x20, 0x20, 0x20, 0x20,
		0xE0, 0xA0, 0xE0, 0xA0, 0xE0,
		0xE0, 0xA0, 0xE0, 0x20, 0xE0,
		0xE0, 0xA0, 0xE0, 0xA0, 0xA0,
		0x80, 0x80, 0xE0, 0xA0, 0xE0,
		0xE0, 0x80, 0x80, 0x80, 0xE0,
		0x20, 0x20, 0xE0, 0xA0, 0xE0,
		0xE0, 0x80, 0xE0, 0x80, 0xE0,
		0xE0, 0x80, 0xC0, 0x80, 0x80,
	],
	fish: [
		0x60, 0xA0, 0xA0, 0xA0, 0xC0,
		0x40, 0xC0, 0x40, 0x40, 0xE0,
		0xC0, 0x20, 0x40, 0x80, 0xE0,
		0xC0, 0x20, 0x40, 0x20, 0xC0,
		0x20, 0xA0, 0xE0, 0x20, 0x20,
		0xE0, 0x80, 0xC0, 0x20, 0xC0,
		0x40, 0x80, 0xC0, 0xA0, 0x40,
		0xE0, 0x20, 0x60, 0x40, 0x40,
		0x40, 0xA0, 0x40, 0xA0, 0x40,
		0x40, 0xA0, 0x60, 0x20, 0x40,
		0x40, 0xA0, 0xE0, 0xA0, 0xA0,
		0xC0, 0xA0, 0xC0, 0xA0, 0xC0,
		0x60, 0x80, 0x80, 0x80, 0x60,
		0xC0, 0xA0, 0xA0, 0xA0, 0xC0,
		0xE0, 0x80, 0xC0, 0x80, 0xE0,
		0xE0, 0x80, 0xC0, 0x80, 0x80,
	],
}
var bigfonts = {
	octo: [
		0xFF, 0xFF, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xFF, 0xFF, // 0
		0x18, 0x78, 0x78, 0x18, 0x18, 0x18, 0x18, 0x18, 0xFF, 0xFF, // 1
		0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, // 2
		0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, // 3
		0xC3, 0xC3, 0xC3, 0xC3, 0xFF, 0xFF, 0x03, 0x03, 0x03, 0x03, // 4
		0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, // 5
		0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, 0xC3, 0xC3, 0xFF, 0xFF, // 6
		0xFF, 0xFF, 0x03, 0x03, 0x06, 0x0C, 0x18, 0x18, 0x18, 0x18, // 7
		0xFF, 0xFF, 0xC3, 0xC3, 0xFF, 0xFF, 0xC3, 0xC3, 0xFF, 0xFF, // 8
		0xFF, 0xFF, 0xC3, 0xC3, 0xFF, 0xFF, 0x03, 0x03, 0xFF, 0xFF, // 9
		0x7E, 0xFF, 0xC3, 0xC3, 0xC3, 0xFF, 0xFF, 0xC3, 0xC3, 0xC3, // A
		0xFC, 0xFC, 0xC3, 0xC3, 0xFC, 0xFC, 0xC3, 0xC3, 0xFC, 0xFC, // B
		0x3C, 0xFF, 0xC3, 0xC0, 0xC0, 0xC0, 0xC0, 0xC3, 0xFF, 0x3C, // C
		0xFC, 0xFE, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xC3, 0xFE, 0xFC, // D
		0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, // E
		0xFF, 0xFF, 0xC0, 0xC0, 0xFF, 0xFF, 0xC0, 0xC0, 0xC0, 0xC0  // F
	],
	schip: [
		0x3C, 0x7E, 0xE7, 0xC3, 0xC3, 0xC3, 0xC3, 0xE7, 0x7E, 0x3C,
		0x18, 0x38, 0x58, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x3C,
		0x3E, 0x7F, 0xC3, 0x06, 0x0C, 0x18, 0x30, 0x60, 0xFF, 0xFF,
		0x3C, 0x7E, 0xC3, 0x03, 0x0E, 0x0E, 0x03, 0xC3, 0x7E, 0x3C,
		0x06, 0x0E, 0x1E, 0x36, 0x66, 0xC6, 0xFF, 0xFF, 0x06, 0x06,
		0xFF, 0xFF, 0xC0, 0xC0, 0xFC, 0xFE, 0x03, 0xC3, 0x7E, 0x3C,
		0x3E, 0x7C, 0xE0, 0xC0, 0xFC, 0xFE, 0xC3, 0xC3, 0x7E, 0x3C,
		0xFF, 0xFF, 0x03, 0x06, 0x0C, 0x18, 0x30, 0x60, 0x60, 0x60,
		0x3C, 0x7E, 0xC3, 0xC3, 0x7E, 0x7E, 0xC3, 0xC3, 0x7E, 0x3C,
		0x3C, 0x7E, 0xC3, 0xC3, 0x7F, 0x3F, 0x03, 0x03, 0x3E, 0x7C,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, // no hex chars!
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
	],
	fish: [
		0x7C, 0xC6, 0xCE, 0xDE, 0xD6, 0xF6, 0xE6, 0xC6, 0x7C, 0x00, // at most 7x9 pixels!
		0x10, 0x30, 0xF0, 0x30, 0x30, 0x30, 0x30, 0x30, 0xFC, 0x00,
		0x78, 0xCC, 0xCC, 0x0C, 0x18, 0x30, 0x60, 0xCC, 0xFC, 0x00,
		0x78, 0xCC, 0x0C, 0x0C, 0x38, 0x0C, 0x0C, 0xCC, 0x78, 0x00,
		0x0C, 0x1C, 0x3C, 0x6C, 0xCC, 0xFE, 0x0C, 0x0C, 0x1E, 0x00,
		0xFC, 0xC0, 0xC0, 0xC0, 0xF8, 0x0C, 0x0C, 0xCC, 0x78, 0x00,
		0x38, 0x60, 0xC0, 0xC0, 0xF8, 0xCC, 0xCC, 0xCC, 0x78, 0x00,
		0xFE, 0xC6, 0xC6, 0x06, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00,
		0x78, 0xCC, 0xCC, 0xEC, 0x78, 0xDC, 0xCC, 0xCC, 0x78, 0x00,
		0x7C, 0xC6, 0xC6, 0xC6, 0x7C, 0x18, 0x18, 0x30, 0x70, 0x00,
		0x30, 0x78, 0xCC, 0xCC, 0xCC, 0xFC, 0xCC, 0xCC, 0xCC, 0x00,
		0xFC, 0x66, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x66, 0xFC, 0x00,
		0x3C, 0x66, 0xC6, 0xC0, 0xC0, 0xC0, 0xC6, 0x66, 0x3C, 0x00,
		0xF8, 0x6C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x6C, 0xF8, 0x00,
		0xFE, 0x62, 0x60, 0x64, 0x7C, 0x64, 0x60, 0x62, 0xFE, 0x00,
		0xFE, 0x66, 0x62, 0x64, 0x7C, 0x64, 0x60, 0x60, 0xF0, 0x00,
	],
	none: new Array(16*10).fill(0x00),
}
var fontsets = {
	octo     : { small: smallfonts.octo,      big: bigfonts.octo  },
	vip      : { small: smallfonts.vip,       big: bigfonts.none  },
	dream6800: { small: smallfonts.dream6800, big: bigfonts.none  },
	eti660   : { small: smallfonts.eti660,    big: bigfonts.none  },
	schip    : { small: smallfonts.octo,      big: bigfonts.schip },
	fish     : { small: smallfonts.fish,      big: bigfonts.fish  },
}

////////////////////////////////////
//
//   The Chip8 Interpreter:
//
////////////////////////////////////

function Emulator() {

	// persistent configuration settings
	this.tickrate           = 20;
	this.fillColor          = "#FFCC00";
	this.fillColor2         = "#FF6600";
	this.blendColor         = "#662200";
	this.backgroundColor    = "#996600";
	this.buzzColor          = "#FFAA00";
	this.quietColor         = "#000000";
	this.shiftQuirks        = false;
	this.loadStoreQuirks    = false;
	this.vfOrderQuirks      = false;
	this.clipQuirks         = false;
	this.jumpQuirks         = false;
	this.logicQuirks        = false;
	this.vBlankQuirks       = false;
	this.enableXO           = true;
	this.screenRotation     = 0;//must be 0, 90, 180, or 270
	this.maxSize            = 3584;
	this.touchInputMode     = 'none';
	this.maskFormatOverride = true;
	this.numericFormatStr   = "default";
	this.fontStyle          = 'octo';

	// interpreter state
	this.p  = [[],[]];  // pixels
	this.m  = [];       // memory (bytes)
	this.r  = [];       // return stack
	this.v  = [];       // registers
	this.pc = 0;        // program counter
	this.i  = 0;        // index register
	this.dt = 0;        // delay timer
	this.st = 0;        // sound timer
	this.hires = false; // are we in SuperChip high res mode?
	this.flags = [];    // semi-persistent hp48 flag vars
	this.pattern = [];  // audio pattern buffer
	this.plane = 1;     // graphics plane
	this.profile_data = {};

	// control/debug state
	this.keys = {};       // track keys which are pressed
	this.waiting = false; // are we waiting for a keypress?
	this.waitReg = -1;    // destination register of an awaited key
	this.halted = true;
	this.breakpoint = false;
	this.metadata = {};
	this.tickCounter = 0;
	this.linted = false;

	// external interface stubs
	this.exitVector  = function() {}                                   // fired by 'exit'
	this.importFlags = function() { return [0, 0, 0, 0, 0, 0, 0, 0]; } // load persistent flags
	this.exportFlags = function(flags) {}                              // save persistent flags
	this.buzzTrigger = function(ticks, remainingTicks) {}                              // fired when buzzer played

	this.init = function(rom) {
		// initialise memory with a new array to ensure that it is of the right size and is initiliased to 0
		this.m = this.enableXO ? new Uint8Array(0x10000) : new Uint8Array(0x1000);

		this.p = [[], []];
		if (this.enableXO)
			for(var z = 0; z < 64*128; z++) { this.p[0][z] = 0; this.p[1][z] = 0; }
		else
			for(var z = 0; z < 32*64; z++) { this.p[0][z] = 0; this.p[1][z] = 0; }

		// initialize memory
		var font = fontsets[this.fontStyle];
		for(var z = 0; z < 32*64;            z++) { this.p[0][z] = 0; this.p[1][z] = 0; }
		for(var z = 0; z < font.small.length;z++) { this.m[z] = font.small[z]; }
		for(var z = 0; z < font.big.length;  z++) { this.m[z + font.small.length] = font.big[z]; }
		for(var z = 0; z < rom.rom.length;   z++) { this.m[0x200+z] = rom.rom[z]; }
		for(var z = 0; z < 16;               z++) { this.v[z] = 0; }
		for(var z = 0; z < 16;               z++) { this.pattern[z] = 0; }

		// initialize interpreter state
		this.r = [];
		this.pc = 0x200;
		this.i  = 0;
		this.dt = 0;
		this.st = 0;
		this.hires = false;
		this.plane = 1;

		// initialize control/debug state
		this.keys = {};
		this.waiting = false;
		this.waitReg = -1;
		this.halted = false;
		this.breakpoint = false;
		this.stack_breakpoint = -1;
		this.metadata = rom;
		this.tickCounter = 0;
		this.profile_data = {};
	}

	this.writeCarry = function(dest, value, flag) {
		this.v[dest] = (value & 0xFF);
		this.v[0xF] = flag ? 1 : 0;
		if (this.vfOrderQuirks) {
			this.v[dest] = (value & 0xFF);
		}
	}

	this.math = function(x, y, op) {
		// basic arithmetic opcodes
		switch(op) {
			case 0x0: this.v[x]  = this.v[y]; break;
			case 0x1: this.v[x] |= this.v[y]; if (this.logicQuirks) this.v[0xF]=0; break;
			case 0x2: this.v[x] &= this.v[y]; if (this.logicQuirks) this.v[0xF]=0; break;
			case 0x3: this.v[x] ^= this.v[y]; if (this.logicQuirks) this.v[0xF]=0; break;
			case 0x4:
				var t = this.v[x]+this.v[y];
				this.writeCarry(x, t, (t > 0xFF));
				break;
			case 0x5:
				var t = this.v[x]-this.v[y];
				this.writeCarry(x, t, (this.v[x] >= this.v[y]));
				break;
			case 0x7:
				var t = this.v[y]-this.v[x];
				this.writeCarry(x, t, (this.v[y] >= this.v[x]));
				break;
			case 0x6:
				if (this.shiftQuirks) { y = x; }
				var t = this.v[y] >> 1;
				this.writeCarry(x, t, (this.v[y] & 0x1));
				break;
			case 0xE:
				if (this.shiftQuirks) { y = x; }
				var t = this.v[y] << 1;
				this.writeCarry(x, t, ((this.v[y] >> 7) & 0x1));
				break;
			default:
				haltBreakpoint("unknown math opcode "+op);
		}
	}

	this.misc = function(x, rest) {
		// miscellaneous opcodes
		switch(rest) {
			case 0x01:
				this.plane = (x & 0x3);
				break;
			case 0x02:
				for(var z = 0; z < 16; z++) {
					this.pattern[z] = this.m[this.i+z];
				}
				break;
			case 0x07: this.v[x] = this.dt; break;
			case 0x0A: this.waiting = true; this.waitReg = x; break;
			case 0x15: this.dt = this.v[x]; break;
			case 0x18: this.buzzTrigger(this.v[x], this.st); this.st = this.v[x]; break;
			case 0x1E: this.i = (this.i + this.v[x])&0xFFFF; break;
			case 0x29: this.i = ((this.v[x] & 0xF) * 5); break;
			case 0x30: this.i = ((this.v[x] & 0xF) * 10 + fontsets[this.fontStyle].small.length); break;
			case 0x33:
				this.m[this.i]   = Math.floor(this.v[x]/100)%10;
				this.m[this.i+1] = Math.floor(this.v[x]/10)%10;
				this.m[this.i+2] = this.v[x]%10;
				break;
			case 0x55:
				for(var z = 0; z <= x; z++) { this.m[this.i+z] = this.v[z]; }
				if (!this.loadStoreQuirks) { this.i = (this.i+x+1)&0xFFFF; }
				break;
			case 0x65:
				for(var z = 0; z <= x; z++) { this.v[z] = this.m[this.i+z]; }
				if (!this.loadStoreQuirks) { this.i = (this.i+x+1)&0xFFFF; }
				break;
			case 0x75:
				for(var z = 0; z <= x; z++) { this.flags[z] = this.v[z]; }
				this.exportFlags(this.flags);
				break;
			case 0x85:
				this.flags = this.importFlags();
				if (typeof this.flags == "undefined" || this.flags == null) {
					this.flags = [0, 0, 0, 0, 0, 0, 0, 0];
				}
				for(var z = 0; z <= x; z++) { this.v[z] = this.flags[z]; }
				break;
			default:
				haltBreakpoint("unknown misc opcode "+rest);
		}
	}

	this.sprite = function sprite(x, y, len) {
		this.v[0xF] = 0x0;
		var rowSize = this.hires ? 128 : 64;
		var colSize = this.hires ?  64 : 32;
		var i = this.i;
		for(var layer = 0; layer < 2; layer++) {
			if ((this.plane & (layer+1)) == 0) { continue; }
			if (len == 0) {
				// draw a SuperChip 16x16 sprite
				for(var a = 0; a < 16; a++) {
					for(var b = 0; b < 16; b++) {
						var target = ((x+b) % rowSize) + ((y+a) % colSize)*rowSize;
						var source = ((this.m[i+(a*2)+(b > 7 ? 1:0)] >> (7-(b%8))) & 0x1) != 0;
						if (this.clipQuirks) {
							if ((x%rowSize)+b>=rowSize || (y%colSize)+a>=colSize) { source = 0; }
						}
						if (!source) { continue; }
						if (this.p[layer][target]) { this.p[layer][target] = 0; this.v[0xF] = 0x1; }
						else { this.p[layer][target] = 1; }
					}
				}
				i += 32;
			}
			else {
				// draw a Chip8 8xN sprite
				for(var a = 0; a < len; a++) {
					for(var b = 0; b < 8; b++) {
						var target = ((x+b) % rowSize) + ((y+a) % colSize)*rowSize;
						var source = ((this.m[i+a] >> (7-b)) & 0x1) != 0;
						if (this.clipQuirks) {
							if ((x%rowSize)+b>=rowSize || (y%colSize)+a>=colSize) { source = 0; }
						}
						if (!source) { continue; }
						if (this.p[layer][target]) { this.p[layer][target] = 0; this.v[0xF] = 0x1; }
						else { this.p[layer][target] = 1; }
					}
				}
				i += len;
			}
		}
	}

	this.call = function(nnn) {
		if (this.r.length >= 12) {
			haltBreakpoint("call stack overflow.");
		}
		this.r.push(this.pc);
		this.pc = nnn
	}

	this.jump0 = function(nnn) {
		if (this.jumpQuirks) { this.pc = nnn + this.v[(nnn >> 8)&0xF];  }
		else                 { this.pc = nnn + this.v[0]; }
	}

	this.machine = function(nnn) {
		if (nnn == 0x000) { this.halted = true; return; }
		haltBreakpoint("machine code is not supported.");
	}

	this.skip = function() {
		var op = (this.m[this.pc  ] << 8) | this.m[this.pc+1];
		this.pc += (op == 0xF000) ? 4 : 2;
	}

	this.opcode = function() {
		// Increment profilining data
		this.profile_data[this.pc] = (this.profile_data[this.pc] || 0) + 1;

		// decode the current opcode
		var op  = (this.m[this.pc  ] << 8) | this.m[this.pc+1];
		var o   = (this.m[this.pc  ] >> 4) & 0x00F;
		var x   = (this.m[this.pc  ]     ) & 0x00F;
		var y   = (this.m[this.pc+1] >> 4) & 0x00F;
		var n   = (this.m[this.pc+1]     ) & 0x00F;
		var nn  = (this.m[this.pc+1]     ) & 0x0FF;
		var nnn = op & 0xFFF;
		this.pc += 2;

		// execute a simple opcode
		if (op == 0x00E0) {
			// clear
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var z = 0; z < this.p[layer].length; z++) {
					this.p[layer][z] = 0;
				}
			}
			return;
		}
		if (op == 0x00EE) {
			// return
			this.pc = this.r.pop();
			return;
		}
		if ((op & 0xF0FF) == 0xE09E) {
			// if -key
			if (Object.keys(keymap[this.v[x]]).some(x => x in this.keys)) { this.skip(); }
			return;
		}
		if ((op & 0xF0FF) == 0xE0A1) {
			// if key
			if (!Object.keys(keymap[this.v[x]]).some(x => x in this.keys)) { this.skip(); }
			return;
		}
		if ((op & 0xFFF0) == 0x00C0) {
			// scroll down n pixels
			var rowSize = this.hires ? 128 : 64;
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var z = this.p[layer].length - 1; z >= 0; z--) {
					this.p[layer][z] = (z >= rowSize * n) ? this.p[layer][z - (rowSize * n)] : 0;
				}
			}
			return;
		}
		if ((op & 0xFFF0) == 0x00D0) {
			// scroll up n pixels
			var rowSize = this.hires ? 128 : 64;
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var z = 0; z < this.p[layer].length; z++) {
					this.p[layer][z] = (z < (this.p[layer].length - rowSize * n)) ? this.p[layer][z + (rowSize * n)] : 0;
				}
			}
			return;
		}
		if (op == 0x00FB) {
			// scroll right 4 pixels
			var rowSize = this.hires ? 128 : 64;
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var a = 0; a < this.p[layer].length; a += rowSize) {
					for(var b = rowSize-1; b >= 0; b--) {
						this.p[layer][a + b] = (b > 3) ? this.p[layer][a + b - 4] : 0;
					}
				}
			}
			return;
		}
		if (op == 0x00FC) {
			// scroll left 4 pixels
			var rowSize = this.hires ? 128 : 64;
			for(var layer = 0; layer < 2; layer++) {
				if ((this.plane & (layer+1)) == 0) { continue; }
				for(var a = 0; a < this.p[layer].length; a += rowSize) {
					for(var b = 0; b < rowSize; b++) {
						this.p[layer][a + b] = (b < rowSize - 4) ? this.p[layer][a + b + 4] : 0;
					}
				}
			}
			return;
		}
		if (op == 0x00FD) {
			// exit
			this.halted = true;
			this.exitVector();
			return;
		}
		if (op == 0x00FE) {
			// lores
			this.hires = false;
			this.p = [[], []];
			for(var z = 0; z < 32*64; z++) { this.p[0][z] = 0; this.p[1][z] = 0; }
			return;
		}
		if (op == 0x00FF) {
			// hires
			this.hires = true;
			this.p = [[], []];
			for(var z = 0; z < 64*128; z++) { this.p[0][z] = 0; this.p[1][z] = 0; }
			return;
		}
		if (op == 0xF000) {
			// long memory reference
			this.i = ((this.m[this.pc] << 8) | (this.m[this.pc+1])) & 0xFFFF;
			this.pc += 2;
			return;
		}

		if (o == 0x5 && n != 0) {
			if (n == 2) {
				// save range
				var dist = Math.abs(x - y);
				if (x < y) { for(var z = 0; z <= dist; z++) { this.m[this.i+z] = this.v[x+z]; }}
				else       { for(var z = 0; z <= dist; z++) { this.m[this.i+z] = this.v[x-z]; }}
				return;
			}
			else if (n == 3) {
				// load range
				var dist = Math.abs(x - y);
				if (x < y) { for(var z = 0; z <= dist; z++) { this.v[x+z] = this.m[this.i+z]; }}
				else       { for(var z = 0; z <= dist; z++) { this.v[x-z] = this.m[this.i+z]; }}
				return;
			}
			else {
				haltBreakpoint("unknown opcode "+op);
			}
		}
		if (o == 0x9 && n != 0) {
			haltBreakpoint("unknown opcode "+op);
		}

		// dispatch complex opcodes
		switch(o) {
			case 0x0: this.machine(nnn);                            break;
			case 0x1: this.pc = nnn;                                break;
			case 0x2: this.call(nnn);                               break;
			case 0x3: if (this.v[x] == nn)        { this.skip(); }  break;
			case 0x4: if (this.v[x] != nn)        { this.skip(); }  break;
			case 0x5: if (this.v[x] == this.v[y]) { this.skip(); }  break;
			case 0x6: this.v[x] = nn;                               break;
			case 0x7: this.v[x] = (this.v[x] + nn) & 0xFF;          break;
			case 0x8: this.math(x, y, n);                           break;
			case 0x9: if (this.v[x] != this.v[y]) { this.skip(); }  break;
			case 0xA: this.i = nnn;                                 break;
			case 0xB: this.jump0(nnn);                              break;
			case 0xC: this.v[x] = (Math.random()*256)&nn;           break;
			case 0xD: this.sprite(this.v[x], this.v[y], n);         break;
			case 0xF: this.misc(x, nn);                             break;
			default: haltBreakpoint("unknown opcode "+o);
		}
	}

	this.tick = function() {
		if (this.halted) { return; }
		this.tickCounter++;
		try {
			this.opcode();
		}
		catch(err) {
			console.log("halted: " + err);
			this.halted = true;
		}
	}
}
</script>
<script>"use strict";

////////////////////////////////////
//
//   Emulator Execution
//
////////////////////////////////////

//must be set > 0
var scaleFactor = 5;
//dom id for canvas element
var renderTarget = "target";

const optionFlags = [
	"tickrate",
	"fillColor",
	"fillColor2",
	"blendColor",
	"backgroundColor",
	"buzzColor",
	"quietColor",
	"shiftQuirks",
	"loadStoreQuirks",
	"vfOrderQuirks",
	"clipQuirks",
	"vBlankQuirks",
	"jumpQuirks",
	"screenRotation",
	"maxSize",
	"touchInputMode",
	"logicQuirks",
	"fontStyle",
]
function unpackOptions(emulator, options) {
	optionFlags.forEach(x => { if (x in options) emulator[x] = options[x] })
	if (options["enableXO"]) emulator.maxSize = 65024 // legacy option
}
function packOptions(emulator) {
	const r = {}
	optionFlags.forEach(x => r[x] = emulator[x])
	return r
}

function setRenderTarget(scale, canvas) {
	scaleFactor = scale;
	renderTarget = canvas;
	var c = document.getElementById(canvas);

	// Remove any existing previous delta frame so first frame is always drawn:
	c.last = undefined;

	var w  = scaleFactor * 128;
	var h  = scaleFactor *  64;

	if (emulator.screenRotation == 90 || emulator.screenRotation == 270) {
		c.width  = h;
		c.height = w;
	}
	else {
		c.width  = w;
		c.height = h;
	}
}

function setTransform(emulator, g) {
	g.setTransform(1, 0, 0, 1, 0, 0);
	var x = scaleFactor * 128;
	var y = scaleFactor *  64;
	switch(emulator.screenRotation) {
		case 90:
			g.rotate(0.5 * Math.PI);
			g.translate(0, -y);
			break;
		case 180:
			g.rotate(1.0 * Math.PI);
			g.translate(-x, -y);
			break;
		case 270:
			g.rotate(1.5 * Math.PI);
			g.translate(-x, 0);
			break;
		default:
			console.assert(emulator.screenRotation === 0, 'Screen rotation not set to 0, 90, 180, or 270. Treating as 0.')
	}
}


function arrayEqual(a, b) {
	var length = a.length;
	if (length !== b.length) { return false; }
	for (var i = 0; i < length; i++) {
		if (a[i] !== b[i]) { return false; }
	}
	return true;
}

function getColor(id) {
	switch(id) {
		case 0: return emulator.backgroundColor;
		case 1: return emulator.fillColor;
		case 2: return emulator.fillColor2;
		case 3: return emulator.blendColor;
	}
	throw "invalid color: " + id;
}

function renderDisplay(emulator) {
	var c = document.getElementById(renderTarget);

	// Canvas rendering can be expensive. Exit out early if nothing has changed.
	var colors = [emulator.backgroundColor, emulator.fillColor, emulator.fillColor2, emulator.blendColor];
	if (c.last !== undefined) {
		if (arrayEqual(c.last.p[0], emulator.p[0]) && arrayEqual(c.last.p[1], emulator.p[1])
				&& arrayEqual(c.last.colors, colors)) {
			return;
		}
		if (c.last.hires !== emulator.hires)
			c.last = undefined;  // full redraw when switching resolution
	}
	var g = c.getContext("2d");
	setTransform(emulator, g);
	var w      = emulator.hires ? 128         : 64;
	var h      = emulator.hires ? 64          : 32;
	var size   = emulator.hires ? scaleFactor : scaleFactor*2;
	var lastPixels = c.last !== undefined? c.last.p: [[], []]

	g.scale(size, size)
	var z = 0;
	for(var y = 0; y < h; ++y) {
		for(var x = 0; x < w; ++x, ++z) {
			var oldColorIdx = lastPixels[0][z] + (lastPixels[1][z] << 1);
			var colorIdx = emulator.p[0][z] + (emulator.p[1][z] << 1);
			if (oldColorIdx !== colorIdx) {
				g.fillStyle = getColor(colorIdx);
				g.fillRect(x, y, 1, 1);
			}
		}
	}
	g.scale(1, 1) //restore scale to 1,1 just in case

	c.last = {
		colors: colors,
		p: [emulator.p[0].slice(), emulator.p[1].slice()],
		hires: emulator.hires,
	};
}

////////////////////////////////////
//
//   Audio Playback
//
////////////////////////////////////

var audio;
var audioNode;
var audioSource;
var audioData;

var AudioBuffer = function(buffer, duration) {
	if (!(this instanceof AudioBuffer)) {
		return new AudioBuffer(buffer, duration);
	}

	this.pointer = 0;
	this.buffer = buffer;
	this.duration = duration;
}

AudioBuffer.prototype.write = function(buffer, index, size) {
	size = Math.max(0, Math.min(size, this.duration))
	if (!size) { return size; }

	this.duration -= size;
	var bufferSize = this.buffer.length;
	var end = index + size;

	for(var i = index; i < end; ++i) {
		buffer[i] = this.buffer[this.pointer++];
		this.pointer %= bufferSize;
	}

	return size;
}

AudioBuffer.prototype.dequeue = function(duration) {
	this.duration -= duration;
}

var FREQ = 4000;
var TIMER_FREQ = 60;
var SAMPLES = 16;
var BUFFER_SIZE = SAMPLES * 8

function audioSetup() {
	if (!audio) {
		if (typeof AudioContext !== 'undefined') {
			audio = new AudioContext();
		}
		else if (typeof webkitAudioContext !== 'undefined') {
			audio = new webkitAudioContext();
		}
	}
	if (audio && !audioNode) {
		audioNode = audio.createScriptProcessor(4096, 1, 1);
		audioNode.onaudioprocess = function(audioProcessingEvent) {
			var outputBuffer = audioProcessingEvent.outputBuffer;
			var outputData = outputBuffer.getChannelData(0);
			var samples_n = outputBuffer.length;

			var index = 0;
			while(audioData.length && index < samples_n) {
				var size = samples_n - index;
				var written = audioData[0].write(outputData, index, size);
				index += written;
				if (written < size) {
					audioData.shift();
				}
			}

			while(index < samples_n) {
				outputData[index++] = 0;
			}
			//the last one can be long sound with high value of buzzer, so always keep it
			if (audioData.length > 1) {
				var audioDataSize = 0;
				var audioBufferSize = audioNode.bufferSize;
				audioData.forEach(function(buffer) { audioDataSize += buffer.duration; })
				while(audioDataSize > audioBufferSize && audioData.length > 1) {
					audioDataSize -= audioData.shift().duration;
				}
			}
		}
		audioData = [];
		audioNode.connect(audio.destination);
		return true;
	}
	if (audio && audioNode) { return true; }
	return false;
}

function stopAudio() {
	if (!audio) { return; }
	if (audioNode) {
		audioNode.disconnect();
		audioNode = null;
	}
	audioData = [];
}

var VOLUME = 0.25;

function playPattern(soundLength, buffer, remainingTicks) {
	if (!audio) { return; }

	var samples = Math.floor(BUFFER_SIZE * audio.sampleRate / FREQ);
	var audioBuffer = new Array(samples);
	if (remainingTicks && audioData.length > 0) {
		audioData[audioData.length - 1].dequeue(Math.floor(remainingTicks * audio.sampleRate / TIMER_FREQ));
	}

	for(var i = 0; i < samples; ++i) {
		var srcIndex = Math.floor(i * FREQ / audio.sampleRate);
		var cell = srcIndex >> 3;
		var bit = srcIndex & 7;
		audioBuffer[i] = (buffer[srcIndex >> 3] & (0x80 >> bit)) ? VOLUME: 0;
	}
	audioData.push(new AudioBuffer(audioBuffer, Math.floor(soundLength * audio.sampleRate / TIMER_FREQ)));
}

function escapeHtml(str) {
    var div = document.createElement('div');
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
}
</script>
<script>/**
* Adaptive Input
**/

const ael = (element, event, listener) => element.addEventListener   (event, listener, { passive:false })
const rel = (element, event, listener) => element.removeEventListener(event, listener, { passive:false })
const pd  = event => (event.preventDefault(),event.stopPropagation())

const VIP_HEX  = '123c456d789ea0bf'.split('')
const VIP_KEYS = VIP_HEX.map(x => parseInt(x,16))

const GAMEPAD_STYLES = `
.gamepad{
  position:absolute;
  top:10%;
  left:0px;
  width:100%;
  height:90%;
  opacity:0.3;
  user-select: none;
  -webkit-user-select: none;
}
.gamepad .dpad{
  position:absolute;
  bottom: 50px;
  left:   50px;
  width:  250px;
  height: 250px;
  background: gray;
  border-radius: 50%;
  overflow:hidden;
}
.gamepad .stick{
  display:none;
  position:absolute;
  border-radius: 50%;
  width:100px;
  height:100px;
  margin-left:-50px;
  margin-top:-50px;
}
.gamepad .buttons{
  position:absolute;
  bottom: 50px;
  right:  50px;
  width:  250px;
  height: 250px;
}
.gamepad .gamebutton{
  position:absolute;
  width:  125px;
  height: 125px;
  background:gray;
  border-radius:50%;
  overflow:hidden;
  line-height: 125px;
  font-size:50px;
  font-weight:bold;
  color:darkgray;
  text-align:center;
}
.gamepad .dpad.active .stick {display:block;background:#444}
.gamepad .gamebutton.active{background:#444;}
.gamepad .gamebutton.b{left:0;bottom:0;}
.gamepad .gamebutton.a{right:0;top:0;}
`
const VIP_STYLES = `
.vip-pad {display:flex;flex-direction:column;align-items:center;z-index:2000;}
.vip-pad .keypad {display:flex;flex-direction:column;margin-top:10px;}
.vip-pad .keypad>div {display:flex;flex-direction:row;}
.vip-pad .keypad>div>div {
  -webkit-user-select: none;
  user-select: none;
  background:gray;
  width: 100px;
  height: 51px;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 1px;
}
.vip-pad .keypad>div>div:active,
.vip-pad .keypad>div>div.active {background:black; border:1px solid white;margin:0px;}
`

const INPUT_MODULES = {
  /**
  * An invisible set of gesture recognizers,
  * giving directional input and an action for taps.
  **/
  swipe: {
    install: (screen,up,down,options) => {

      let vdirs      = []
      let direction  = { i:null, sx:0, sy:0, lx:0, ly:0 }
      let action1    = {}
      let taptimeout = null

      const updateStick = _ => {
        // find the relative position of the stick to its starting point
        const cx = direction.lx - direction.sx
        const cy = direction.ly - direction.sy

        // update the virtual direction buttons
        let t = []
        const DEAD_ZONE = 30
        if (Math.abs(cx) > DEAD_ZONE) t.push(cx < 0 ? options.left : options.right)
        if (Math.abs(cy) > DEAD_ZONE) t.push(cy < 0 ? options.up   : options.down)
        vdirs.forEach(x => (t    .indexOf(x)<0) && up  (x)) // clear keys no longer held
        t    .forEach(x => (vdirs.indexOf(x)<0) && down(x)) // push keys that were not held before
        vdirs = t
      }
      const tapDown= i => {
        if (Object.keys(action1).length == 0) down(options.action1)
        action1[i] = true
        if (i == direction.i) { direction = { i:null, sx:0, sy:0, lx:0, ly:0 } }
        taptimeout = null
      }
      const start = e => {
        const t = e.touches[0]
        const i = t.identifier
        // a single-touch is either directional or a tap...
        if (direction.i != null) {
          tapDown(i)
        }
        else {
          direction.i  = i
          direction.sx = t.clientX
          direction.sy = t.clientY
          direction.lx = t.clientX
          direction.ly = t.clientY
          taptimeout = setTimeout(_ => tapDown(i), 100)
        }
        updateStick(),pd(e)
      }
      const move = e => {
        for(let z = 0; z < e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (i == direction.i) {
            if (taptimeout != null) { clearTimeout(taptimeout); taptimeout = null }
            direction.lx = t.clientX
            direction.ly = t.clientY
          }
        }
        updateStick(),pd(e)
      }
      const end = e => {
        let r1 = false
        for(let z = 0; z < e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (i == direction.i) {
            if (taptimeout != null) {
              // cancel a short tap
              clearTimeout(taptimeout); taptimeout = null
              down(options.action1)
              setTimeout(_ => up(options.action1), 50)
            }
            direction = { i:null, sx:0, sy:0, lx:0, ly:0 }
          }
          if (i in action1) {
            delete action1[i]
            r1=true
          }
        }
        if (r1 && Object.keys(action1).length == 0) up(options.action1)
        updateStick(),pd(e)
      }
      ael(screen, 'touchstart', start)
      ael(screen, 'touchmove',  move)
      ael(screen, 'touchend',   end)
      screen.uninstallSwipe = _ => {
        rel(screen, 'touchstart', start)
        rel(screen, 'touchmove',  move)
        rel(screen, 'touchend',   end)
      }
    },
    remove: (screen) => {
      screen.uninstallSwipe()
      delete screen.uninstallSwipe
    }
  },

  /**
  * A virtual gamepad overlay with two remappable action keys.
  **/
  gamepad: {
    install: (screen,up,down,options) => {
      // build the UI
      if (document.querySelector('.gamepad')) return
      const root = document.createElement('div')
      root.classList.add('gamepad')
      root.innerHTML = `
      <div class='dpad'><div class='stick'></div></div>
      <div class='buttons'><div class='gamebutton b'>B</div><div class='gamebutton a'>A</div></div>
      <style>${GAMEPAD_STYLES}</style>`
      screen.parentElement.append(root)

      let vdirs      = []
      let directions = {}
      let buttons    = {}
      const pad   = document.querySelector('.gamepad .dpad')
      const stick = document.querySelector('.gamepad .dpad .stick')
      const a     = document.querySelector('.gamepad .gamebutton.a')
      const b     = document.querySelector('.gamepad .gamebutton.b')

      const updateStick = _ => {
        // find centroid of d-pad touchpoints ({0,0} if no touchpoints)
        const touches = Object.values(directions)
        let cx = 0, cy = 0, r = pad.getBoundingClientRect(), sr = stick.getBoundingClientRect()
        touches.forEach(t => (cx+=t.x, cy+=t.y))
        cx /= touches.length,         cy /= touches.length
        cx -= (r.left + (r.width/2)), cy -= (r.top + (r.height/2))

        // position the virtual stick, clamped within dpad
        const ca = Math.atan2(cy, cx)
        const cd = Math.min(Math.sqrt(cx*cx + cy*cy), (r.width/2)-(sr.width/2))
        stick.style.left = ((Math.cos(ca)*cd)+(r.width /2)|0)+'px'
        stick.style.top  = ((Math.sin(ca)*cd)+(r.height/2)|0)+'px'

        // update the virtual direction buttons
        let t = []
        const DEAD_ZONE = 30
        if (Math.abs(cx) > DEAD_ZONE) t.push(cx < 0 ? options.left : options.right)
        if (Math.abs(cy) > DEAD_ZONE) t.push(cy < 0 ? options.up   : options.down)
        vdirs.forEach(x => (t    .indexOf(x)<0) && up  (x)) // clear keys no longer held
        t    .forEach(x => (vdirs.indexOf(x)<0) && down(x)) // push keys that were not held before
        vdirs = t
      }

      const start = e => {
        for(let z = 0; z<e.touches.length; z++) {
          const t = e.touches[z]
          const i = t.identifier
          if (t.target == a) {
            t.target.classList.add('active')
            buttons[i]=options.action1
            down(options.action1)
          }
          if (t.target == b) {
            t.target.classList.add('active')
            buttons[i]=options.action2
            down(options.action2)
          }
          if (t.target == pad) {
            t.target.classList.add('active')
            directions[i]={x:t.clientX, y:t.clientY}
          }
        }
        updateStick(),pd(e)
      }
      const move = e => {
        for(let z = 0; z<e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (i in directions) directions[i]={x:t.clientX, y:t.clientY}
        }
        updateStick(),pd(e)
      }
      const end = e => {
        for(let z = 0; z<e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (i in buttons) {
            t.target.classList.remove('active')
            up(buttons[i])
            delete buttons[i]
          }
          if (i in directions) {
            t.target.classList.remove('active')
            delete directions[i]
          }
        }
        updateStick(),pd(e)
      }

      ael(a,   'touchstart', start)
      ael(a,   'touchend',   end  )
      ael(b,   'touchstart', start)
      ael(b,   'touchend',   end  )
      ael(pad, 'touchstart', start)
      ael(pad, 'touchmove',  move )
      ael(pad, 'touchend',   end  )
    },
    remove: (screen) => {
      document.querySelector('.gamepad').remove()
    },
  },

  /**
  * Treat the entire screen, or a centered square region, as invisible buttons,
  * mapped out in the order of the VIP hex keypad.
  **/
  seg16: {
    install: (screen,up,down,options) => {
      const tmap = {}
      const pointToKey = touch => {
        // poll this for each point, as it may vary over time,
        // and experimentally it's never right initially...
        const r = screen.getBoundingClientRect()
        if (options.mode == 'center') {
          if (r.width > r.height) { r.x += (r.width - r.height)/2; r.width = r.height }
          else                    { r.y += (r.height - r.width)/2; r.height = r.width }
        }
        const x = touch.clientX - r.x
        const y = touch.clientY - r.y
        if (x < 0 || x > r.width || y < 0 || y > r.height) return null
        const tx = Math.floor(x / (r.width /4))
        const ty = Math.floor(y / (r.height/4))
        return VIP_KEYS[tx + (4 * ty)]
      }
      const start = e => {
        for(let z=0; z<e.touches.length; z++) {
          const i = e.touches[z].identifier
          const k = pointToKey(e.touches[z])
          if (k != null) down(k)
          tmap[i]=k
        }
        pd(e)
      }
      const move = e => {
        for(let z=0; z<e.touches.length; z++) {
          const i = e.touches[z].identifier
          const k = pointToKey(e.touches[z])
          if (tmap[i] == k) continue       // same cell, nothing to do.
          if (tmap[i] != null) up(tmap[i]) // release old key, if any
          if (k != null)       down(k)     // press new key, if any
          tmap[i]=k
        }
        pd(e)
      }
      const end = e => {
        for(let z=0; z<e.changedTouches.length; z++) {
          const i = e.changedTouches[z].identifier
          const k = pointToKey(e.changedTouches[z])
          if (tmap[i] != null) up(tmap[i])
          tmap[i]=null
        }
        pd(e)
      }
      ael(screen, 'touchstart', start)
      ael(screen, 'touchmove',  move )
      ael(screen, 'touchend',   end  )
      screen.uninstallSeg16 = _ => {
        rel(screen, 'touchstart', start)
        rel(screen, 'touchmove',  move )
        rel(screen, 'touchend',   end  )
      }
    },
    remove:  (screen) => {
      screen.uninstallSeg16()
      delete screen.uninstallSeg16
    },
  },

  /**
  * Provide a visible 4x4 representation of the VIP hex keypad.
  **/
  vip: {
    install: (screen,up,down,options) => {
      if (document.querySelector('.vip-pad')) return
      const root = document.createElement('div')
      root.classList.add('vip-pad')
      root.innerHTML = `<div class='keypad'>
        ${[0,1,2,3].map(r=>`<div>${[0,1,2,3].map(c=>`<div>${VIP_HEX[c+(r*4)].toUpperCase()}</div>`).join('')}</div>`).join('')}
      </div>
      <style>${VIP_STYLES}</style>`
      if (screen.parentElement == document.body) { screen.parentElement.append(root) }
      else { screen.parentElement.parentElement.append(root) }
      const buttons = []
      document.querySelectorAll('.vip-pad .keypad>div>div').forEach(x=>buttons.push(x)) // make an actual Array
      const held = {}
      const start = e => {
        for(let z=0; z<e.touches.length; z++) {
          const t = e.touches[z]
          const i = t.identifier
          const k = VIP_KEYS[buttons.indexOf(t.target)]
          t.target.classList.add('active')
          down(k)
          held[i]=k
        }
        pd(e)
      }
      const end = e => {
        for(let z = 0; z<e.changedTouches.length; z++) {
          const t = e.changedTouches[z]
          const i = t.identifier
          if (held[i]) { up(held[i]); delete held[i] }
          t.target.classList.remove('active')
        }
        pd(e)
      }
      buttons.forEach(b => {
        ael(b, 'touchstart', start)
        ael(b, 'touchend',   end  )
      })
    },
    remove:  (screen) => {
      document.querySelector('.vip-pad').remove()
    },
  },
}

let adaptiveControlsInstalled = null

function injectAdaptiveControls(type, screen, keyup, keydown) {
  let options = {
    up:      5,
    down:    8,
    left:    7,
    right:   9,
    action1: 6,
    action2: 4,
    mode:    'center', // or 'fill', used by seg16
  }
  const lookup = vk => Object.keys(keymap[vk])[0]
  const install = _ => {
    rel(screen, 'touchstart', install)
    adaptiveControlsInstalled = type
    INPUT_MODULES[type].install(
      screen,
      key => keyup  ({ key:lookup(key), preventDefault:_=>_ }),
      key => keydown({ key:lookup(key), preventDefault:_=>_ }),
      options
    )
  }
  // uninstall anything that's already there:
  rel(screen, 'touchstart', install)
  if (adaptiveControlsInstalled) INPUT_MODULES[adaptiveControlsInstalled].remove(screen)

  if (type == 'none') return
  if (type == 'seg16fill') { type='seg16'; options.mode='fill' }
  // defer installing adaptive input until we actually see
  // an input event from the user:
  ael(screen, 'touchstart', install)
}
</script>
<body><canvas id='target' width=512 height=256></canvas></body>
<style>body{margin:0px;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;}</style>
<script>
const emulator = new Emulator()
unpackOptions(emulator, data.options)
setRenderTarget(data.options.displayScale || 4, 'target')
emulator.init({rom:data.rom})
emulator.importFlags = _ => getPref('octoFlagRegisters')
emulator.exportFlags = f => setPref('octoFlagRegisters',f)
emulator.buzzTrigger = (ticks,rest)=> playPattern(ticks, emulator.pattern, rest)
const kd = e=>{
	if (!audio) audioSetup()
	if (!(e.key in emulator.keys)) emulator.keys[e.key]=true
	e.preventDefault()
}
const ku = e=>{
	if (e.key in emulator.keys) delete emulator.keys[e.key]
	if (!emulator.waiting) return
	const kindex = keymapInverse[e.key]
	if (kindex != undefined) {
		emulator.waiting = false
		emulator.v[emulator.waitReg] = kindex
	}
	e.preventDefault()
}
window.addEventListener('keydown',kd,false)
window.addEventListener('keyup',ku,false)
intervalHandle = setInterval(_=>{
	if (emulator.halted) return
	for(var z = 0; (z<emulator.tickrate) && (!emulator.waiting); z++) emulator.tick()
	if (emulator.dt > 0) emulator.dt--
	if (emulator.st > 0) emulator.st--
	renderDisplay(emulator)
	document.body.style.backgroundColor = emulator.st?emulator.buzzColor:emulator.quietColor
}, 1000/60)

injectAdaptiveControls(emulator.touchInputMode,document.getElementById('target'),ku,kd)
</script>
