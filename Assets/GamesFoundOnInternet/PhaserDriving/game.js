!function(e){function t(t){for(var i,n,o=t[0],h=t[1],l=t[2],d=0,p=[];d<o.length;d++)n=o[d],r[n]&&p.push(r[n][0]),r[n]=0;for(i in h)Object.prototype.hasOwnProperty.call(h,i)&&(e[i]=h[i]);for(c&&c(t);p.length;)p.shift()();return a.push.apply(a,l||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],i=!0,o=1;o<s.length;o++){var h=s[o];0!==r[h]&&(i=!1)}i&&(a.splice(t--,1),e=n(n.s=s[0]))}return e}var i={},r={0:0},a=[];function n(t){if(i[t])return i[t].exports;var s=i[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=i,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var o=this.webpackJsonp=this.webpackJsonp||[],h=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var c=h;a.push([3,1]),s()}([,,function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return i}));class i extends Phaser.Events.EventEmitter{constructor(t,{fov:s=75,aspect:i=null,near:r=.1,far:a=1e3,x:n=0,y:o=0,z:h=0,anisotropy:l=1,antialias:c=!1}={}){super(),this.root=t,this.view=t.add.extern(),this.scene=new e.Scene,this.textureAnisotropy=l,i||(i=t.scale.gameSize.aspectRatio),this.camera=new e.PerspectiveCamera(s,i,r,a),this.camera.position.set(n,o,h),this.renderer=new e.WebGLRenderer({canvas:t.sys.game.canvas,context:t.sys.game.context,antialias:c}),this.renderer.autoClear=!1,this.view.render=()=>{this.renderer.state.reset(),this.renderer.render(this.scene,this.camera)},this.add={ambientLight:e=>this.addAmbientLight(e),directionalLight:e=>this.addDirectionalLight(e),hemisphereLight:e=>this.addHemisphereLight(e),pointLight:e=>this.addPointLight(e),spotLight:e=>this.addSpotLight(e),mesh:e=>this.addMesh(e),group:(...e)=>this.addGroup(e),ground:e=>this.addGround(e),box:e=>this.addBox(e),cone:e=>this.addCone(e),circle:e=>this.addCircle(e),cylinder:e=>this.addCylinder(e),dodecahedron:e=>this.addDodecahedron(e),extrude:e=>this.addExtrude(e),lathe:e=>this.addLathe(e),icosahedron:e=>this.addIcosahedron(e),plane:e=>this.addPlane(e),parametric:e=>this.addParametric(e),ring:e=>this.addRing(e),sphere:e=>this.addSphere(e),text:e=>this.addText(e),tube:e=>this.addTube(e),octahedron:e=>this.addOctahedron(e),polyhedron:e=>this.addPolyhedron(e),shape:e=>this.addShape(e),tetrahedron:e=>this.addTetrahedron(e),torus:e=>this.addTorus(e),torusKnot:e=>this.addTorusKnot(e)},this.make={box:e=>this.makeBox(e),cone:e=>this.makeCone(e),circle:e=>this.makeCircle(e),cylinder:e=>this.makeCylinder(e),dodecahedron:e=>this.makeDodecahedron(e),extrude:e=>this.makeExtrude(e),icosahedron:e=>this.makeIcosahedron(e),lathe:e=>this.makeLathe(e),plane:e=>this.makePlane(e),parametric:e=>this.makeParametric(e),ring:e=>this.makeRing(e),sphere:e=>this.makeSphere(e),shape:e=>this.makeShape(e),text:e=>this.makeText(e),tube:e=>this.makeTube(e),octahedron:e=>this.makeOctahedron(e),polyhedron:e=>this.makePolyhedron(e),tetrahedron:e=>this.makeTetrahedron(e),torus:e=>this.makeTorus(e),torusKnot:e=>this.makeTorusKnot(e)}}enableFog(t=0,s=1,i=1e3){return this.scene.fog=new e.Fog(t,s,i),this}enableFogExp2(t=0,s=25e-5){return this.scene.fog=new e.FogExp2(t,s),this}enableGamma(e=!0,t=!0){return this.renderer.gammaInput=e,this.renderer.gammaOutput=t,this}enableShadows(t=e.PCFShadowMap){return this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=t,this}setCubeBackground(...e){return this.scene.background=this.createCubeTexture(...e),this}createCubeTexture(t,s="px.png",i="nx.png",r="py.png",a="ny.png",n="pz.png",o="nz.png"){return"/"!==t.substr(-1)&&(t=t.concat("/")),(new e.CubeTextureLoader).setPath(t).load([s,i,r,a,n,o])}castShadow(...e){for(const t of e.values())t.castShadow=!0;return this}receiveShadow(...e){for(const t of e.values())t.receiveShadow=!0;return this}setShadow(e,t=512,s=512,i=1,r=1e3){return e.castShadow=!0,e.shadow.mapSize.width=t,e.shadow.mapSize.height=s,e.shadow.camera.near=i,e.shadow.camera.far=r,e}addGLTFModel(t,s,i){const r=this.root.cache.binary.get(t);(new e.GLTFLoader).parse(r,s,t=>{const s=new e.Group;for(let e=t.scene.children.length-1;e>-1;e--)s.add(t.scene.children[e]);this.scene.add(s),this.emit("loadgltf",t,s),i&&i(t,s)})}parseGLTFModel(t,s,i){const r=this.root.cache.binary.get(t);(new e.GLTFLoader).parse(r,s,e=>{this.emit("loadgltf",e),i&&i(e)})}getTexture(t){let s=new e.Texture;return s.image=this.root.textures.get(t).getSourceImage(),s.format=e.RGBAFormat,s.needsUpdate=!0,s.anisotropy=this.textureAnisotropy,s}addHemisphereLight({skyColor:t=16777215,groundColor:s=0,intensity:i=1}={}){const r=new e.HemisphereLight(t,s,i);return this.scene.add(r),r}addAmbientLight({color:t=16777215,intensity:s=1}={}){const i=new e.AmbientLight(t,s);return this.scene.add(i),i}addDirectionalLight({color:t=16777215,intensity:s=1,x:i=0,y:r=0,z:a=0}={}){const n=new e.DirectionalLight(t,s);return n.position.set(i,r,a),this.scene.add(n),n}addPointLight({color:t=16777215,intensity:s=1,distance:i=0,decay:r=1,x:a=0,y:n=0,z:o=0}={}){const h=new e.PointLight(t,s,i,r);return h.position.set(a,n,o),this.scene.add(h),h}addSpotLight({color:t=16777215,intensity:s=1,distance:i=0,angle:r=Math.PI/4,penumbra:a=.05,decay:n=1,x:o=0,y:h=0,z:l=0}={}){const c=new e.SpotLight(t,s,i,r,a,n);return c.position.set(o,h,l),this.scene.add(c),c}addGroup(t){const s=new e.Group;if(Array.isArray(t))for(let e=0;e<t.length;e++)s.add(t[e]);return this.scene.add(s),s}addMesh(e){if(Array.isArray(e))for(let t=0;t<e.length;t++)this.scene.add(e[t]);else this.scene.add(e);return this}createTexture({key:t,wrap:s,wrapS:i=e.ClampToEdgeWrapping,wrapT:r=e.ClampToEdgeWrapping,repeatX:a=2,repeatY:n=2}={}){const o=this.getTexture(t);return s&&(i=s,r=s),o.wrapS=i,o.wrapT=r,o.repeat.set(a,n),o.premultiplyAlpha=!0,o}createMaterial(t,s,i){if(i&&!Phaser.Utils.Objects.IsPlainObject(i))return i;{null===i&&(i={});let r={...i};t&&(r.map="string"==typeof t?this.getTexture(t):t),s&&(r.color=s);const a=r.basic,n=r.phong,o=r.line;return delete r.basic,delete r.phong,delete r.line,a?new e.MeshBasicMaterial(r):n?new e.MeshPhongMaterial(r):o?new e.LineBasicMaterial(r):new e.MeshStandardMaterial(r)}}createMesh(t,s,i=0,r=0,a=0){let n=new e.Mesh(t,s);return n.position.set(i,r,a),n}makeText({text:t="",font:s="",size:i=100,height:r=50,curveSegments:a=12,bevelEnabled:n=!1,bevelThickness:o=10,bevelSize:h=8,bevelSegments:l=3,texture:c=null,color:d=16777215,material:p=null,x:u=0,y:m=0,z:g=0}={}){s=new e.Font(this.root.sys.cache.json.get(s));const f=new e.TextBufferGeometry(t,{font:s,size:i,height:r,curveSegments:a,bevelEnabled:n,bevelThickness:o,bevelSize:h,bevelSegments:l});return this.createMesh(f,this.createMaterial(c,d,p),u,m,g)}addText(e){const t=this.makeText(e);return this.scene.add(t),t}makeCircle({radius:t=1,segments:s=8,thetaStart:i=0,thetaLength:r=2*Math.PI,texture:a=null,color:n=16777215,material:o=null,x:h=0,y:l=0,z:c=0}={}){const d=new e.CircleBufferGeometry(t,s,i,r);return this.createMesh(d,this.createMaterial(a,n,o),h,l,c)}addCircle(e){const t=this.makeCircle(e);return this.scene.add(t),t}makeRing({innerRadius:t=.5,outerRadius:s=1,thetaSegments:i=8,phiSegments:r=1,thetaStart:a=0,thetaLength:n=2*Math.PI,texture:o=null,color:h=16777215,material:l=null,x:c=0,y:d=0,z:p=0}={}){const u=new e.RingBufferGeometry(t,s,i,r,a,n);return this.createMesh(u,this.createMaterial(o,h,l),c,d,p)}addRing(e){const t=this.makeRing(e);return this.scene.add(t),t}makeExtrude({shapes:t,options:s,texture:i=null,color:r=16777215,material:a=null,x:n=0,y:o=0,z:h=0}={}){const l=new e.ExtrudeBufferGeometry(t,s);return this.createMesh(l,this.createMaterial(i,r,a),n,o,h)}addExtrude(e){const t=this.makeExtrude(e);return this.scene.add(t),t}makeShape({shapes:t,curveSegments:s=12,texture:i=null,color:r=16777215,material:a=null,x:n=0,y:o=0,z:h=0}={}){const l=new e.ShapeBufferGeometry(t,s);return this.createMesh(l,this.createMaterial(i,r,a),n,o,h)}addShape(e){const t=this.makeShape(e);return this.scene.add(t),t}makeLathe({points:t,texture:s=null,color:i=16777215,material:r=null,x:a=0,y:n=0,z:o=0}={}){const h=new e.LatheBufferGeometry(t);return this.createMesh(h,this.createMaterial(s,i,r),a,n,o)}addLathe(e){const t=this.makeLathe(e);return this.scene.add(t),t}makeTube({path:t,tubularSegments:s=64,radius:i=1,radialSegments:r=8,closed:a=!1,texture:n=null,color:o=16777215,material:h=null,x:l=0,y:c=0,z:d=0}={}){const p=new e.TubeBufferGeometry(t,s,i,r,a);return this.createMesh(p,this.createMaterial(n,o,h),l,c,d)}addTube(e){const t=this.makeTube(e);return this.scene.add(t),t}makeParametric({func:t,slices:s,stacks:i,texture:r=null,color:a=16777215,material:n=null,x:o=0,y:h=0,z:l=0}={}){const c=new e.ParametricBufferGeometry(t,s,i);return this.createMesh(c,this.createMaterial(r,a,n),o,h,l)}addParametric(e){const t=this.makeParametric(e);return this.scene.add(t),t}makeTorus({radius:t=1,tube:s=.4,radialSegments:i=8,tubularSegments:r=6,arc:a=2*Math.PI,texture:n=null,color:o=16777215,material:h=null,x:l=0,y:c=0,z:d=0}={}){const p=new e.TorusBufferGeometry(t,s,i,r,a);return this.createMesh(p,this.createMaterial(n,o,h),l,c,d)}addTorus(e){const t=this.makeTorus(e);return this.scene.add(t),t}makePolyhedron({vertices:t=[],indices:s=[],radius:i=6,detail:r=2,texture:a=null,color:n=16777215,material:o=null,x:h=0,y:l=0,z:c=0}={}){const d=new e.PolyhedronBufferGeometry(t,s,i,r);return this.createMesh(d,this.createMaterial(a,n,o),h,l,c)}addPolyhedron(e){const t=this.makePolyhedron(e);return this.scene.add(t),t}makeOctahedron({radius:t=1,detail:s=0,texture:i=null,color:r=16777215,material:a=null,x:n=0,y:o=0,z:h=0}={}){const l=new e.OctahedronBufferGeometry(t,s);return this.createMesh(l,this.createMaterial(i,r,a),n,o,h)}addOctahedron(e){const t=this.makeOctahedron(e);return this.scene.add(t),t}makeIcosahedron({radius:t=1,detail:s=0,texture:i=null,color:r=16777215,material:a=null,x:n=0,y:o=0,z:h=0}={}){const l=new e.IcosahedronBufferGeometry(t,s);return this.createMesh(l,this.createMaterial(i,r,a),n,o,h)}addIcosahedron(e){const t=this.makeIcosahedron(e);return this.scene.add(t),t}makeTetrahedron({radius:t=1,detail:s=0,texture:i=null,color:r=16777215,material:a=null,x:n=0,y:o=0,z:h=0}={}){const l=new e.TetrahedronBufferGeometry(t,s);return this.createMesh(l,this.createMaterial(i,r,a),n,o,h)}addTetrahedron(e){const t=this.makeTetrahedron(e);return this.scene.add(t),t}makeTorusKnot({radius:t=1,tube:s=.4,tubularSegments:i=64,radialSegments:r=8,p:a=2,q:n=3,texture:o=null,color:h=16777215,material:l=null,x:c=0,y:d=0,z:p=0}={}){const u=new e.TorusKnotBufferGeometry(t,s,i,r,a,n);return this.createMesh(u,this.createMaterial(o,h,l),c,d,p)}addTorusKnot(e){const t=this.makeTorusKnot(e);return this.scene.add(t),t}makePlane({width:t=1,height:s=1,widthSegments:i=1,heightSegments:r=1,texture:a=null,color:n=16777215,material:o=null,x:h=0,y:l=0,z:c=0}={}){const d=new e.PlaneBufferGeometry(t,s,i,r);return this.createMesh(d,this.createMaterial(a,n,o),h,l,c)}addPlane(e){const t=this.makePlane(e);return this.scene.add(t),t}addGround({receiveShadow:e=!1,texture:t=null,color:s=16777215,material:i=null}={}){const r=this.makePlane({width:2e3,height:2e3,texture:t,color:s,material:i});return r.rotation.x=.5*-Math.PI,r.receiveShadow=e,this.scene.add(r),r}makeSphere({radius:t=1,widthSegments:s=8,heightSegments:i=6,texture:r=null,color:a=16777215,material:n=null,x:o=0,y:h=0,z:l=0}={}){const c=new e.SphereBufferGeometry(t,s,i);return this.createMesh(c,this.createMaterial(r,a,n),o,h,l)}addSphere(e){const t=this.makeSphere(e);return this.scene.add(t),t}makeCone({radius:t=1,height:s=1,radialSegments:i=8,heightSegments:r=1,openEnded:a=!1,thetaStart:n=0,thetaLength:o=2*Math.PI,texture:h=null,color:l=16777215,material:c=null,x:d=0,y:p=0,z:u=0}={}){const m=new e.ConeBufferGeometry(t,s,i,r,a,n,o);return this.createMesh(m,this.createMaterial(h,l,c),d,p,u)}addCone(e){const t=this.makeCone(e);return this.scene.add(t),t}makeCylinder({radiusTop:t=1,radiusBottom:s=1,height:i=1,radialSegments:r=8,heightSegments:a=1,openEnded:n=!1,thetaStart:o=0,thetaLength:h=2*Math.PI,texture:l=null,color:c=16777215,material:d=null,x:p=0,y:u=0,z:m=0}={}){const g=new e.CylinderBufferGeometry(t,s,i,r,a,n,o,h);return this.createMesh(g,this.createMaterial(l,c,d),p,u,m)}addCylinder(e){const t=this.makeCylinder(e);return this.scene.add(t),t}makeDodecahedron({radius:t=1,detail:s=0,texture:i=null,color:r=16777215,material:a=null,x:n=0,y:o=0,z:h=0}={}){const l=new e.DodecahedronBufferGeometry(t,s);return this.createMesh(l,this.createMaterial(i,r,a),n,o,h)}addDodecahedron(e){const t=this.makeDodecahedron(e);return this.scene.add(t),t}makeBox({size:t=null,width:s=1,height:i=1,depth:r=1,texture:a=null,color:n=16777215,material:o=null,x:h=0,y:l=0,z:c=0}={}){t&&(s=t,i=t,r=t);const d=new e.BoxBufferGeometry(s,i,r);return this.createMesh(d,this.createMaterial(a,n,o),h,l,c)}addBox(e){const t=this.makeBox(e);return this.scene.add(t),t}}}).call(this,s(0))},function(e,t,s){e.exports=s(11)},function(e,t,s){(function(e){e.GLTFLoader=function(){function t(t){this.manager=void 0!==t?t:e.DefaultLoadingManager,this.dracoLoader=null}function s(){var e={};return{get:function(t){return e[t]},add:function(t,s){e[t]=s},remove:function(t){delete e[t]},removeAll:function(){e={}}}}t.prototype={constructor:t,crossOrigin:"anonymous",load:function(t,s,i,r){var a,n=this;a=void 0!==this.resourcePath?this.resourcePath:void 0!==this.path?this.path:e.LoaderUtils.extractUrlBase(t),n.manager.itemStart(t);var o=function(e){r?r(e):console.error(e),n.manager.itemError(t),n.manager.itemEnd(t)},h=new e.FileLoader(n.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.load(t,(function(e){try{n.parse(e,a,(function(e){s(e),n.manager.itemEnd(t)}),o)}catch(e){o(e)}}),i,o)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setDRACOLoader:function(e){return this.dracoLoader=e,this},parse:function(t,s,h,l){var m,g={};if("string"==typeof t)m=t;else if(e.LoaderUtils.decodeText(new Uint8Array(t,0,4))===o){try{g[i.KHR_BINARY_GLTF]=new c(t)}catch(e){return void(l&&l(e))}m=g[i.KHR_BINARY_GLTF].content}else m=e.LoaderUtils.decodeText(new Uint8Array(t));var f=JSON.parse(m);if(void 0===f.asset||f.asset.version[0]<2)l&&l(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));else{if(f.extensionsUsed)for(var v=0;v<f.extensionsUsed.length;++v){var y=f.extensionsUsed[v],M=f.extensionsRequired||[];switch(y){case i.KHR_LIGHTS_PUNCTUAL:g[y]=new a(f);break;case i.KHR_MATERIALS_UNLIT:g[y]=new n(f);break;case i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:g[y]=new u(f);break;case i.KHR_DRACO_MESH_COMPRESSION:g[y]=new d(f,this.dracoLoader);break;case i.MSFT_TEXTURE_DDS:g[i.MSFT_TEXTURE_DDS]=new r;break;case i.KHR_TEXTURE_TRANSFORM:g[i.KHR_TEXTURE_TRANSFORM]=new p(f);break;default:M.indexOf(y)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}new H(f,g,{path:s||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager}).parse(h,l)}}};var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function r(){if(!e.DDSLoader)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing THREE.DDSLoader");this.name=i.MSFT_TEXTURE_DDS,this.ddsLoader=new e.DDSLoader}function a(e){this.name=i.KHR_LIGHTS_PUNCTUAL;var t=e.extensions&&e.extensions[i.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=t.lights||[]}function n(e){this.name=i.KHR_MATERIALS_UNLIT}a.prototype.loadLight=function(t){var s,i=this.lightDefs[t],r=new e.Color(16777215);void 0!==i.color&&r.fromArray(i.color);var a=void 0!==i.range?i.range:0;switch(i.type){case"directional":(s=new e.DirectionalLight(r)).target.position.set(0,0,-1),s.add(s.target);break;case"point":(s=new e.PointLight(r)).distance=a;break;case"spot":(s=new e.SpotLight(r)).distance=a,i.spot=i.spot||{},i.spot.innerConeAngle=void 0!==i.spot.innerConeAngle?i.spot.innerConeAngle:0,i.spot.outerConeAngle=void 0!==i.spot.outerConeAngle?i.spot.outerConeAngle:Math.PI/4,s.angle=i.spot.outerConeAngle,s.penumbra=1-i.spot.innerConeAngle/i.spot.outerConeAngle,s.target.position.set(0,0,-1),s.add(s.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+i.type+'".')}return s.position.set(0,0,0),s.decay=2,void 0!==i.intensity&&(s.intensity=i.intensity),s.name=i.name||"light_"+t,Promise.resolve(s)},n.prototype.getMaterialType=function(t){return e.MeshBasicMaterial},n.prototype.extendParams=function(t,s,i){var r=[];t.color=new e.Color(1,1,1),t.opacity=1;var a=s.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var n=a.baseColorFactor;t.color.fromArray(n),t.opacity=n[3]}void 0!==a.baseColorTexture&&r.push(i.assignTexture(t,"map",a.baseColorTexture))}return Promise.all(r)};var o="glTF",h=1313821514,l=5130562;function c(t){this.name=i.KHR_BINARY_GLTF,this.content=null,this.body=null;var s=new DataView(t,0,12);if(this.header={magic:e.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:s.getUint32(4,!0),length:s.getUint32(8,!0)},this.header.magic!==o)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.");for(var r=new DataView(t,12),a=0;a<r.byteLength;){var n=r.getUint32(a,!0);a+=4;var c=r.getUint32(a,!0);if(a+=4,c===h){var d=new Uint8Array(t,12+a,n);this.content=e.LoaderUtils.decodeText(d)}else if(c===l){var p=12+a;this.body=t.slice(p,p+n)}a+=n}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function d(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=i.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t}function p(e){this.name=i.KHR_TEXTURE_TRANSFORM}function u(){return{name:i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return e.ShaderMaterial},extendParams:function(t,s,i){var r=s.extensions[this.name],a=e.ShaderLib.standard,n=e.UniformsUtils.clone(a.uniforms),o=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),h=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),l=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),d=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),p=a.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",o).replace("#include <metalnessmap_pars_fragment>",h).replace("#include <roughnessmap_fragment>",l).replace("#include <metalnessmap_fragment>",c).replace("#include <lights_physical_fragment>",d);delete n.roughness,delete n.metalness,delete n.roughnessMap,delete n.metalnessMap,n.specular={value:(new e.Color).setHex(1118481)},n.glossiness={value:.5},n.specularMap={value:null},n.glossinessMap={value:null},t.vertexShader=a.vertexShader,t.fragmentShader=p,t.uniforms=n,t.defines={STANDARD:""},t.color=new e.Color(1,1,1),t.opacity=1;var u=[];if(Array.isArray(r.diffuseFactor)){var m=r.diffuseFactor;t.color.fromArray(m),t.opacity=m[3]}if(void 0!==r.diffuseTexture&&u.push(i.assignTexture(t,"map",r.diffuseTexture)),t.emissive=new e.Color(0,0,0),t.glossiness=void 0!==r.glossinessFactor?r.glossinessFactor:1,t.specular=new e.Color(1,1,1),Array.isArray(r.specularFactor)&&t.specular.fromArray(r.specularFactor),void 0!==r.specularGlossinessTexture){var g=r.specularGlossinessTexture;u.push(i.assignTexture(t,"glossinessMap",g)),u.push(i.assignTexture(t,"specularMap",g))}return Promise.all(u)},createMaterial:function(t){var s=new e.ShaderMaterial({defines:t.defines,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,fog:!0,lights:!0,opacity:t.opacity,transparent:t.transparent});return s.isGLTFSpecularGlossinessMaterial=!0,s.color=t.color,s.map=void 0===t.map?null:t.map,s.lightMap=null,s.lightMapIntensity=1,s.aoMap=void 0===t.aoMap?null:t.aoMap,s.aoMapIntensity=1,s.emissive=t.emissive,s.emissiveIntensity=1,s.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,s.bumpMap=void 0===t.bumpMap?null:t.bumpMap,s.bumpScale=1,s.normalMap=void 0===t.normalMap?null:t.normalMap,t.normalScale&&(s.normalScale=t.normalScale),s.displacementMap=null,s.displacementScale=1,s.displacementBias=0,s.specularMap=void 0===t.specularMap?null:t.specularMap,s.specular=t.specular,s.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,s.glossiness=t.glossiness,s.alphaMap=null,s.envMap=void 0===t.envMap?null:t.envMap,s.envMapIntensity=1,s.refractionRatio=.98,s.extensions.derivatives=!0,s},cloneMaterial:function(e){var t=e.clone();t.isGLTFSpecularGlossinessMaterial=!0;for(var s=this.specularGlossinessParams,i=0,r=s.length;i<r;i++)t[s[i]]=e[s[i]];return t},refreshUniforms:function(e,t,s,i,r,a){if(!0===r.isGLTFSpecularGlossinessMaterial){var n,o=r.uniforms,h=r.defines;o.opacity.value=r.opacity,o.diffuse.value.copy(r.color),o.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),o.map.value=r.map,o.specularMap.value=r.specularMap,o.alphaMap.value=r.alphaMap,o.lightMap.value=r.lightMap,o.lightMapIntensity.value=r.lightMapIntensity,o.aoMap.value=r.aoMap,o.aoMapIntensity.value=r.aoMapIntensity,r.map?n=r.map:r.specularMap?n=r.specularMap:r.displacementMap?n=r.displacementMap:r.normalMap?n=r.normalMap:r.bumpMap?n=r.bumpMap:r.glossinessMap?n=r.glossinessMap:r.alphaMap?n=r.alphaMap:r.emissiveMap&&(n=r.emissiveMap),void 0!==n&&(n.isWebGLRenderTarget&&(n=n.texture),!0===n.matrixAutoUpdate&&n.updateMatrix(),o.uvTransform.value.copy(n.matrix)),r.envMap&&(o.envMap.value=r.envMap,o.envMapIntensity.value=r.envMapIntensity,o.flipEnvMap.value=r.envMap.isCubeTexture?-1:1,o.reflectivity.value=r.reflectivity,o.refractionRatio.value=r.refractionRatio,o.maxMipLevel.value=e.properties.get(r.envMap).__maxMipLevel),o.specular.value.copy(r.specular),o.glossiness.value=r.glossiness,o.glossinessMap.value=r.glossinessMap,o.emissiveMap.value=r.emissiveMap,o.bumpMap.value=r.bumpMap,o.normalMap.value=r.normalMap,o.displacementMap.value=r.displacementMap,o.displacementScale.value=r.displacementScale,o.displacementBias.value=r.displacementBias,null!==o.glossinessMap.value&&void 0===h.USE_GLOSSINESSMAP&&(h.USE_GLOSSINESSMAP="",h.USE_ROUGHNESSMAP=""),null===o.glossinessMap.value&&void 0!==h.USE_GLOSSINESSMAP&&(delete h.USE_GLOSSINESSMAP,delete h.USE_ROUGHNESSMAP)}}}}function m(t,s,i,r){e.Interpolant.call(this,t,s,i,r)}d.prototype.decodePrimitive=function(e,t){var s=this.json,i=this.dracoLoader,r=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,n={},o={},h={};for(var l in a){var c=P[l]||l.toLowerCase();n[c]=a[l]}for(l in e.attributes){c=P[l]||l.toLowerCase();if(void 0!==a[l]){var d=s.accessors[e.attributes[l]],p=T[d.componentType];h[c]=p,o[c]=!0===d.normalized}}return t.getDependency("bufferView",r).then((function(e){return new Promise((function(t){i.decodeDracoFile(e,(function(e){for(var s in e.attributes){var i=e.attributes[s],r=o[s];void 0!==r&&(i.normalized=r)}t(e)}),n,h)}))}))},p.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},m.prototype=Object.create(e.Interpolant.prototype),m.prototype.constructor=m,m.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,s=this.sampleValues,i=this.valueSize,r=e*i*3+i,a=0;a!==i;a++)t[a]=s[r+a];return t},m.prototype.beforeStart_=m.prototype.copySampleValue_,m.prototype.afterEnd_=m.prototype.copySampleValue_,m.prototype.interpolate_=function(e,t,s,i){for(var r=this.resultBuffer,a=this.sampleValues,n=this.valueSize,o=2*n,h=3*n,l=i-t,c=(s-t)/l,d=c*c,p=d*c,u=e*h,m=u-h,g=-2*p+3*d,f=p-d,v=1-g,y=f-d+c,M=0;M!==n;M++){var S=a[m+M+n],x=a[m+M+o]*l,w=a[u+M+n],T=a[u+M]*l;r[M]=v*S+y*x+g*w+f*T}return r};var g,f=0,v=1,y=2,M=3,S=4,x=5,w=6,T=(e.Matrix3,e.Matrix4,e.Vector2,e.Vector3,e.Vector4,e.Texture,{5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array}),b={9728:e.NearestFilter,9729:e.LinearFilter,9984:e.NearestMipMapNearestFilter,9985:e.LinearMipMapNearestFilter,9986:e.NearestMipMapLinearFilter,9987:e.LinearMipMapLinearFilter},L={33071:e.ClampToEdgeWrapping,33648:e.MirroredRepeatWrapping,10497:e.RepeatWrapping},R=(e.BackSide,e.FrontSide,e.NeverDepth,e.LessDepth,e.EqualDepth,e.LessEqualDepth,e.GreaterEqualDepth,e.NotEqualDepth,e.GreaterEqualDepth,e.AlwaysDepth,e.AddEquation,e.SubtractEquation,e.ReverseSubtractEquation,e.ZeroFactor,e.OneFactor,e.SrcColorFactor,e.OneMinusSrcColorFactor,e.SrcAlphaFactor,e.OneMinusSrcAlphaFactor,e.DstAlphaFactor,e.OneMinusDstAlphaFactor,e.DstColorFactor,e.OneMinusDstColorFactor,e.SrcAlphaSaturateFactor,{SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16}),P={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},E={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},A={CUBICSPLINE:void 0,LINEAR:e.InterpolateLinear,STEP:e.InterpolateDiscrete},k="OPAQUE",O="MASK",_="BLEND",D={"image/png":e.RGBAFormat,"image/jpeg":e.RGBFormat};function C(e,t){return"string"!=typeof e||""===e?"":/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e}function I(e,t,s){for(var i in s.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=s.extensions[i])}function G(e,t){void 0!==t.extras&&("object"==typeof t.extras?e.userData=t.extras:console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function F(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var s=0,i=t.weights.length;s<i;s++)e.morphTargetInfluences[s]=t.weights[s];if(t.extras&&Array.isArray(t.extras.targetNames)){var r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(s=0,i=r.length;s<i;s++)e.morphTargetDictionary[r[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function U(e){for(var t="",s=Object.keys(e).sort(),i=0,r=s.length;i<r;i++)t+=s[i]+":"+e[s[i]]+";";return t}function B(t){if(t.isInterleavedBufferAttribute){for(var s=t.count,i=t.itemSize,r=t.array.slice(0,s*i),a=0,n=0;a<s;++a)r[n++]=t.getX(a),i>=2&&(r[n++]=t.getY(a)),i>=3&&(r[n++]=t.getZ(a)),i>=4&&(r[n++]=t.getW(a));return new e.BufferAttribute(r,i,t.normalized)}return t.clone()}function H(t,i,r){this.json=t||{},this.extensions=i||{},this.options=r||{},this.cache=new s,this.primitiveCache={},this.textureLoader=new e.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new e.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer")}function N(e,t,s){var i=t.attributes,r=[];function a(t,i){return s.getDependency("accessor",t).then((function(t){e.addAttribute(i,t)}))}for(var n in i){var o=P[n]||n.toLowerCase();o in e.attributes||r.push(a(i[n],o))}if(void 0!==t.indices&&!e.index){var h=s.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));r.push(h)}return G(e,t),Promise.all(r).then((function(){return void 0!==t.targets?function(e,t,s){for(var i=!1,r=!1,a=0,n=t.length;a<n;a++){if(void 0!==(l=t[a]).POSITION&&(i=!0),void 0!==l.NORMAL&&(r=!0),i&&r)break}if(!i&&!r)return Promise.resolve(e);var o=[],h=[];for(a=0,n=t.length;a<n;a++){var l=t[a];if(i){var c=void 0!==l.POSITION?s.getDependency("accessor",l.POSITION):e.attributes.position;o.push(c)}if(r){c=void 0!==l.NORMAL?s.getDependency("accessor",l.NORMAL):e.attributes.normal;h.push(c)}}return Promise.all([Promise.all(o),Promise.all(h)]).then((function(s){for(var a=s[0],n=s[1],o=0,h=a.length;o<h;o++)e.attributes.position!==a[o]&&(a[o]=B(a[o]));for(o=0,h=n.length;o<h;o++)e.attributes.normal!==n[o]&&(n[o]=B(n[o]));for(o=0,h=t.length;o<h;o++){var l=t[o],c="morphTarget"+o;if(i&&void 0!==l.POSITION){var d=a[o];d.name=c;for(var p=e.attributes.position,u=0,m=d.count;u<m;u++)d.setXYZ(u,d.getX(u)+p.getX(u),d.getY(u)+p.getY(u),d.getZ(u)+p.getZ(u))}if(r&&void 0!==l.NORMAL){var g=n[o];g.name=c;var f=e.attributes.normal;for(u=0,m=g.count;u<m;u++)g.setXYZ(u,g.getX(u)+f.getX(u),g.getY(u)+f.getY(u),g.getZ(u)+f.getZ(u))}}return i&&(e.morphAttributes.position=a),r&&(e.morphAttributes.normal=n),e}))}(e,t.targets,s):e}))}return H.prototype.parse=function(e,t){var s=this,i=this.json,r=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:s,userData:{}};I(r,a,i),e(a)})).catch(t)},H.prototype.markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[],i={},r={},a=0,n=t.length;a<n;a++)for(var o=t[a].joints,h=0,l=o.length;h<l;h++)e[o[h]].isBone=!0;for(var c=0,d=e.length;c<d;c++){var p=e[c];void 0!==p.mesh&&(void 0===i[p.mesh]&&(i[p.mesh]=r[p.mesh]=0),i[p.mesh]++,void 0!==p.skin&&(s[p.mesh].isSkinnedMesh=!0))}this.json.meshReferences=i,this.json.meshUses=r},H.prototype.getDependency=function(e,t){var s=e+":"+t,r=this.cache.get(s);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this.loadMesh(t);break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this.loadBufferView(t);break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this.loadMaterial(t);break;case"texture":r=this.loadTexture(t);break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;case"light":r=this.extensions[i.KHR_LIGHTS_PUNCTUAL].loadLight(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,r)}return r},H.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var s=this,i=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(i.map((function(t,i){return s.getDependency(e,i)}))),this.cache.add(e,t)}return t},H.prototype.loadBuffer=function(e){var t=this.json.buffers[e],s=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[i.KHR_BINARY_GLTF].body);var r=this.options;return new Promise((function(e,i){s.load(C(t.uri,r.path),e,void 0,(function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},H.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var s=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+s)}))},H.prototype.loadAccessor=function(t){var s=this,i=this.json,r=this.json.accessors[t];if(void 0===r.bufferView&&void 0===r.sparse)return Promise.resolve(null);var a=[];return void 0!==r.bufferView?a.push(this.getDependency("bufferView",r.bufferView)):a.push(null),void 0!==r.sparse&&(a.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(a).then((function(t){var a,n,o=t[0],h=R[r.type],l=T[r.componentType],c=l.BYTES_PER_ELEMENT,d=c*h,p=r.byteOffset||0,u=void 0!==r.bufferView?i.bufferViews[r.bufferView].byteStride:void 0,m=!0===r.normalized;if(u&&u!==d){var g="InterleavedBuffer:"+r.bufferView+":"+r.componentType,f=s.cache.get(g);f||(a=new l(o),f=new e.InterleavedBuffer(a,u/c),s.cache.add(g,f)),n=new e.InterleavedBufferAttribute(f,h,p/c,m)}else a=null===o?new l(r.count*h):new l(o,p,r.count*h),n=new e.BufferAttribute(a,h,m);if(void 0!==r.sparse){var v=R.SCALAR,y=T[r.sparse.indices.componentType],M=r.sparse.indices.byteOffset||0,S=r.sparse.values.byteOffset||0,x=new y(t[1],M,r.sparse.count*v),w=new l(t[2],S,r.sparse.count*h);null!==o&&n.setArray(n.array.slice());for(var b=0,L=x.length;b<L;b++){var P=x[b];if(n.setX(P,w[b*h]),h>=2&&n.setY(P,w[b*h+1]),h>=3&&n.setZ(P,w[b*h+2]),h>=4&&n.setW(P,w[b*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return n}))},H.prototype.loadTexture=function(t){var s,r=this,a=this.json,n=this.options,o=this.textureLoader,h=window.URL||window.webkitURL,l=a.textures[t],c=l.extensions||{},d=(s=c[i.MSFT_TEXTURE_DDS]?a.images[c[i.MSFT_TEXTURE_DDS].source]:a.images[l.source]).uri,p=!1;return void 0!==s.bufferView&&(d=r.getDependency("bufferView",s.bufferView).then((function(e){p=!0;var t=new Blob([e],{type:s.mimeType});return d=h.createObjectURL(t)}))),Promise.resolve(d).then((function(t){var s=e.Loader.Handlers.get(t);return s||(s=c[i.MSFT_TEXTURE_DDS]?r.extensions[i.MSFT_TEXTURE_DDS].ddsLoader:o),new Promise((function(e,i){s.load(C(t,n.path),e,void 0,i)}))})).then((function(t){!0===p&&h.revokeObjectURL(d),t.flipY=!1,void 0!==l.name&&(t.name=l.name),s.mimeType in D&&(t.format=D[s.mimeType]);var i=(a.samplers||{})[l.sampler]||{};return t.magFilter=b[i.magFilter]||e.LinearFilter,t.minFilter=b[i.minFilter]||e.LinearMipMapLinearFilter,t.wrapS=L[i.wrapS]||e.RepeatWrapping,t.wrapT=L[i.wrapT]||e.RepeatWrapping,t}))},H.prototype.assignTexture=function(t,s,r){var a=this;return this.getDependency("texture",r.index).then((function(n){switch(s){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":n.format=e.RGBFormat}if(a.extensions[i.KHR_TEXTURE_TRANSFORM]){var o=void 0!==r.extensions?r.extensions[i.KHR_TEXTURE_TRANSFORM]:void 0;o&&(n=a.extensions[i.KHR_TEXTURE_TRANSFORM].extendTexture(n,o))}t[s]=n}))},H.prototype.assignFinalMaterial=function(t){var s=t.geometry,r=t.material,a=this.extensions,n=void 0!==s.attributes.tangent,o=void 0!==s.attributes.color,h=void 0===s.attributes.normal,l=!0===t.isSkinnedMesh,c=Object.keys(s.morphAttributes).length>0,d=c&&void 0!==s.morphAttributes.normal;if(t.isPoints){var p="PointsMaterial:"+r.uuid,u=this.cache.get(p);u||(u=new e.PointsMaterial,e.Material.prototype.copy.call(u,r),u.color.copy(r.color),u.map=r.map,u.lights=!1,this.cache.add(p,u)),r=u}else if(t.isLine){p="LineBasicMaterial:"+r.uuid;var m=this.cache.get(p);m||(m=new e.LineBasicMaterial,e.Material.prototype.copy.call(m,r),m.color.copy(r.color),m.lights=!1,this.cache.add(p,m)),r=m}if(n||o||h||l||c){p="ClonedMaterial:"+r.uuid+":";r.isGLTFSpecularGlossinessMaterial&&(p+="specular-glossiness:"),l&&(p+="skinning:"),n&&(p+="vertex-tangents:"),o&&(p+="vertex-colors:"),h&&(p+="flat-shading:"),c&&(p+="morph-targets:"),d&&(p+="morph-normals:");var g=this.cache.get(p);g||(g=r.isGLTFSpecularGlossinessMaterial?a[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].cloneMaterial(r):r.clone(),l&&(g.skinning=!0),n&&(g.vertexTangents=!0),o&&(g.vertexColors=e.VertexColors),h&&(g.flatShading=!0),c&&(g.morphTargets=!0),d&&(g.morphNormals=!0),this.cache.add(p,g)),r=g}r.aoMap&&void 0===s.attributes.uv2&&void 0!==s.attributes.uv&&(console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap."),s.addAttribute("uv2",new e.BufferAttribute(s.attributes.uv.array,2))),r.isGLTFSpecularGlossinessMaterial&&(t.onBeforeRender=a[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms),t.material=r},H.prototype.loadMaterial=function(t){var s,r=this.json,a=this.extensions,n=r.materials[t],o={},h=n.extensions||{},l=[];if(h[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var c=a[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];s=c.getMaterialType(n),l.push(c.extendParams(o,n,this))}else if(h[i.KHR_MATERIALS_UNLIT]){var d=a[i.KHR_MATERIALS_UNLIT];s=d.getMaterialType(n),l.push(d.extendParams(o,n,this))}else{s=e.MeshStandardMaterial;var p=n.pbrMetallicRoughness||{};if(o.color=new e.Color(1,1,1),o.opacity=1,Array.isArray(p.baseColorFactor)){var u=p.baseColorFactor;o.color.fromArray(u),o.opacity=u[3]}void 0!==p.baseColorTexture&&l.push(this.assignTexture(o,"map",p.baseColorTexture)),o.metalness=void 0!==p.metallicFactor?p.metallicFactor:1,o.roughness=void 0!==p.roughnessFactor?p.roughnessFactor:1,void 0!==p.metallicRoughnessTexture&&(l.push(this.assignTexture(o,"metalnessMap",p.metallicRoughnessTexture)),l.push(this.assignTexture(o,"roughnessMap",p.metallicRoughnessTexture)))}!0===n.doubleSided&&(o.side=e.DoubleSide);var m=n.alphaMode||k;return m===_?o.transparent=!0:(o.transparent=!1,m===O&&(o.alphaTest=void 0!==n.alphaCutoff?n.alphaCutoff:.5)),void 0!==n.normalTexture&&s!==e.MeshBasicMaterial&&(l.push(this.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new e.Vector2(1,1),void 0!==n.normalTexture.scale&&o.normalScale.set(n.normalTexture.scale,n.normalTexture.scale)),void 0!==n.occlusionTexture&&s!==e.MeshBasicMaterial&&(l.push(this.assignTexture(o,"aoMap",n.occlusionTexture)),void 0!==n.occlusionTexture.strength&&(o.aoMapIntensity=n.occlusionTexture.strength)),void 0!==n.emissiveFactor&&s!==e.MeshBasicMaterial&&(o.emissive=(new e.Color).fromArray(n.emissiveFactor)),void 0!==n.emissiveTexture&&s!==e.MeshBasicMaterial&&l.push(this.assignTexture(o,"emissiveMap",n.emissiveTexture)),Promise.all(l).then((function(){var t;return t=s===e.ShaderMaterial?a[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(o):new s(o),void 0!==n.name&&(t.name=n.name),t.map&&(t.map.encoding=e.sRGBEncoding),t.emissiveMap&&(t.emissiveMap.encoding=e.sRGBEncoding),t.specularMap&&(t.specularMap.encoding=e.sRGBEncoding),G(t,n),n.extensions&&I(a,t,n),t}))},H.prototype.loadGeometries=function(t){var s=this,r=this.extensions,a=this.primitiveCache;function n(e){return r[i.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,s).then((function(t){return N(t,e,s)}))}for(var o,h,l=[],c=0,d=t.length;c<d;c++){var p,u=t[c],m=(h=void 0,(h=(o=u).extensions&&o.extensions[i.KHR_DRACO_MESH_COMPRESSION])?"draco:"+h.bufferView+":"+h.indices+":"+U(h.attributes):o.indices+":"+U(o.attributes)+":"+o.mode),g=a[m];if(g)l.push(g.promise);else p=u.extensions&&u.extensions[i.KHR_DRACO_MESH_COMPRESSION]?n(u):N(new e.BufferGeometry,u,s),a[m]={primitive:u,promise:p},l.push(p)}return Promise.all(l)},H.prototype.loadMesh=function(t){for(var s=this,i=this.json,r=(this.extensions,i.meshes[t]),a=r.primitives,n=[],o=0,h=a.length;o<h;o++){var l=void 0===a[o].material?g=g||new e.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:e.FrontSide}):this.getDependency("material",a[o].material);n.push(l)}return Promise.all(n).then((function(i){return s.loadGeometries(a).then((function(n){for(var o=[],h=0,l=n.length;h<l;h++){var c,d=n[h],p=a[h],u=i[h];if(p.mode===S||p.mode===x||p.mode===w||void 0===p.mode)!0===(c=!0===r.isSkinnedMesh?new e.SkinnedMesh(d,u):new e.Mesh(d,u)).isSkinnedMesh&&c.normalizeSkinWeights(),p.mode===x?c.drawMode=e.TriangleStripDrawMode:p.mode===w&&(c.drawMode=e.TriangleFanDrawMode);else if(p.mode===v)c=new e.LineSegments(d,u);else if(p.mode===M)c=new e.Line(d,u);else if(p.mode===y)c=new e.LineLoop(d,u);else{if(p.mode!==f)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);c=new e.Points(d,u)}Object.keys(c.geometry.morphAttributes).length>0&&F(c,r),c.name=r.name||"mesh_"+t,n.length>1&&(c.name+="_"+h),G(c,r),s.assignFinalMaterial(c),o.push(c)}if(1===o.length)return o[0];var m=new e.Group;for(h=0,l=o.length;h<l;h++)m.add(o[h]);return m}))}))},H.prototype.loadCamera=function(t){var s,i=this.json.cameras[t],r=i[i.type];if(r)return"perspective"===i.type?s=new e.PerspectiveCamera(e.Math.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):"orthographic"===i.type&&(s=new e.OrthographicCamera(r.xmag/-2,r.xmag/2,r.ymag/2,r.ymag/-2,r.znear,r.zfar)),void 0!==i.name&&(s.name=i.name),G(s,i),Promise.resolve(s);console.warn("THREE.GLTFLoader: Missing camera parameters.")},H.prototype.loadSkin=function(e){var t=this.json.skins[e],s={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return s.inverseBindMatrices=e,s}))},H.prototype.loadAnimation=function(t){for(var s=this.json.animations[t],i=[],r=[],a=[],n=[],o=[],h=0,l=s.channels.length;h<l;h++){var c=s.channels[h],d=s.samplers[c.sampler],p=c.target,u=void 0!==p.node?p.node:p.id,g=void 0!==s.parameters?s.parameters[d.input]:d.input,f=void 0!==s.parameters?s.parameters[d.output]:d.output;i.push(this.getDependency("node",u)),r.push(this.getDependency("accessor",g)),a.push(this.getDependency("accessor",f)),n.push(d),o.push(p)}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(a),Promise.all(n),Promise.all(o)]).then((function(i){for(var r=i[0],a=i[1],n=i[2],o=i[3],h=i[4],l=[],c=0,d=r.length;c<d;c++){var p=r[c],u=a[c],g=n[c],f=o[c],v=h[c];if(void 0!==p){var y;switch(p.updateMatrix(),p.matrixAutoUpdate=!0,E[v.path]){case E.weights:y=e.NumberKeyframeTrack;break;case E.rotation:y=e.QuaternionKeyframeTrack;break;case E.position:case E.scale:default:y=e.VectorKeyframeTrack}var M=p.name?p.name:p.uuid,S=void 0!==f.interpolation?A[f.interpolation]:e.InterpolateLinear,x=[];E[v.path]===E.weights?p.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&x.push(e.name?e.name:e.uuid)})):x.push(M);for(var w=0,T=x.length;w<T;w++){var b=new y(x[w]+"."+E[v.path],u.array,g.array,S);"CUBICSPLINE"===f.interpolation&&(b.createInterpolant=function(e){return new m(this.times,this.values,this.getValueSize()/3,e)},b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(b)}}}var L=void 0!==s.name?s.name:"animation_"+t;return new e.AnimationClip(L,void 0,l)}))},H.prototype.loadNode=function(t){var s=this.json,r=this.extensions,a=this,n=s.meshReferences,o=s.meshUses,h=s.nodes[t];return(!0===h.isBone?Promise.resolve(new e.Bone):void 0!==h.mesh?a.getDependency("mesh",h.mesh).then((function(e){var t;if(n[h.mesh]>1){var s=o[h.mesh]++;(t=e.clone()).name+="_instance_"+s,t.onBeforeRender=e.onBeforeRender;for(var i=0,r=t.children.length;i<r;i++)t.children[i].name+="_instance_"+s,t.children[i].onBeforeRender=e.children[i].onBeforeRender}else t=e;return void 0!==h.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,s=h.weights.length;t<s;t++)e.morphTargetInfluences[t]=h.weights[t]})),t})):void 0!==h.camera?a.getDependency("camera",h.camera):h.extensions&&h.extensions[i.KHR_LIGHTS_PUNCTUAL]&&void 0!==h.extensions[i.KHR_LIGHTS_PUNCTUAL].light?a.getDependency("light",h.extensions[i.KHR_LIGHTS_PUNCTUAL].light):Promise.resolve(new e.Object3D)).then((function(t){if(void 0!==h.name&&(t.name=e.PropertyBinding.sanitizeNodeName(h.name)),G(t,h),h.extensions&&I(r,t,h),void 0!==h.matrix){var s=new e.Matrix4;s.fromArray(h.matrix),t.applyMatrix(s)}else void 0!==h.translation&&t.position.fromArray(h.translation),void 0!==h.rotation&&t.quaternion.fromArray(h.rotation),void 0!==h.scale&&t.scale.fromArray(h.scale);return t}))},H.prototype.loadScene=function(){function t(s,i,r,a){var n=r.nodes[s];return a.getDependency("node",s).then((function(t){return void 0===n.skin?t:a.getDependency("skin",n.skin).then((function(e){for(var t=[],i=0,r=(s=e).joints.length;i<r;i++)t.push(a.getDependency("node",s.joints[i]));return Promise.all(t)})).then((function(i){for(var r=!0===t.isGroup?t.children:[t],a=0,n=r.length;a<n;a++){for(var o=r[a],h=[],l=[],c=0,d=i.length;c<d;c++){var p=i[c];if(p){h.push(p);var u=new e.Matrix4;void 0!==s.inverseBindMatrices&&u.fromArray(s.inverseBindMatrices.array,16*c),l.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',s.joints[c])}o.bind(new e.Skeleton(h,l),o.matrixWorld)}return t}));var s})).then((function(e){i.add(e);var s=[];if(n.children)for(var o=n.children,h=0,l=o.length;h<l;h++){var c=o[h];s.push(t(c,e,r,a))}return Promise.all(s)}))}return function(s){var i=this.json,r=this.extensions,a=this.json.scenes[s],n=new e.Scene;void 0!==a.name&&(n.name=a.name),G(n,a),a.extensions&&I(r,n,a);for(var o=a.nodes||[],h=[],l=0,c=o.length;l<c;l++)h.push(t(o[l],n,i,this));return Promise.all(h).then((function(){return n}))}}(),t}()}).call(this,s(0))},,,,,function(e,t,s){},,function(e,t,s){"use strict";s.r(t);s(4),s(5),s(8),s(9);function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r extends Phaser.Scene{constructor(e,t){super(e),i(this,"game",void 0),i(this,"pasuuna",void 0)}setTimerEvent(e,t,s,i){return this.time.delayedCall(Phaser.Math.Between(e,t),s,i||[],this)}}class a extends r{constructor(e,t){super("BootScene")}preload(){this.load.bitmapFont("retro","./assets/fonts/cosmicavenger.png","./assets/fonts/cosmicavenger.xml")}create(){this.registry.set("speed",0),this.registry.set("racetime",0),this.registry.set("trackposition",0),this.registry.set("raceposition",0),this.registry.set("playerx",0),this.scene.start("LoadScene",{})}}var n=s(1);const o={type:Phaser.AUTO,scale:{parent:"game-container",mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH,width:320,height:180},render:{pixelArt:!0},plugins:{global:[{key:"PasuunaPlayerPlugin",plugin:n.PasuunaPlugin,start:!0,mapping:"pasuuna"}]}};class h extends r{constructor(e,t){super("LoadScene")}preload(){const e=this.add.graphics();this.load.on("progress",t=>{e.clear(),e.fillStyle(16777215,1),e.fillRect(0,this.scale.gameSize.height/2,this.scale.gameSize.width*t,60)}),this.load.on("complete",()=>{e.destroy()}),this.load.image("clouds1","./assets/clouds.png"),this.load.image("clouds2","./assets/clouds2.png"),this.load.image("mountain","./assets/mountain.png"),this.load.image("hills","./assets/hills.png"),this.load.image("boulder1","./assets/boulder.png"),this.load.image("boulder2","./assets/boulder2.png"),this.load.image("tree1","./assets/tree.png"),this.load.image("tree2","./assets/tree2.png"),this.load.image("tree3","./assets/tree3.png"),this.load.image("turnsign","./assets/turn-sign.png"),this.load.spritesheet("particles","./assets/smoke-particle.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("car-green","./assets/car-green.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("car-army","./assets/car-army.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("car-red","./assets/car-red.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("car-yellow","./assets/car-yellow.png",{frameWidth:64,frameHeight:64}),this.load.spritesheet("car-blue","./assets/car-blue.png",{frameWidth:64,frameHeight:64}),this.load.binary("playercar","./assets/3d/car.glb"),this.load.audio("engine",["./assets/sound/engine-loop.wav"]),this.load.audio("tire-squeal",["./assets/sound/tire-squeal.wav"]),this.load.audio("collision",["./assets/sound/car-collision.wav"]),this.load.audio("confirm",["./assets/sound/confirm.wav"]),this.load.audio("explosion",["./assets/sound/explosion.wav"]),this.load.audio("select",["./assets/sound/select.wav"]),this.load.audio("time-extended",["./assets/sound/time-extended.wav"]),this.load.binary("dream-candy","./assets/sound/drozerix_-_dream_candy.xm"),this.load.bitmapFont("numbers","./assets/fonts/number-font.png","./assets/fonts/number-font.xml"),this.load.bitmapFont("impact","./assets/fonts/impact-24-outline.png","./assets/fonts/impact-24-outline.xml")}create(){this.scene.start("GameScene",{})}}const l={ROAD_LIGHT:new Phaser.Display.Color(127,127,127,1),ROAD_DARK:new Phaser.Display.Color(123,123,123,1),GRASS_LIGHT:new Phaser.Display.Color(118,197,120,1),GRASS_DARK:new Phaser.Display.Color(130,211,34,1),LANE_MARKER:new Phaser.Display.Color(220,220,220,1),RUMBLE_LIGHT:new Phaser.Display.Color(200,200,200,1),RUMBLE_DARK:new Phaser.Display.Color(177,64,64,1),SKY:new Phaser.Display.Color(127,127,255,1)},c={ROAD:l.ROAD_DARK.color,GRASS:l.GRASS_DARK.color,RUMBLE:l.RUMBLE_LIGHT.color},d={ROAD:l.ROAD_LIGHT.color,GRASS:l.GRASS_LIGHT.color,RUMBLE:l.RUMBLE_DARK.color,LANE:l.LANE_MARKER.color};function p(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const u=new class{constructor(){p(this,"roadWidth",2200),p(this,"roadWidthClamp",3),p(this,"segmentLength",200),p(this,"rumbleLength",6),p(this,"lanes",3),p(this,"fieldOfView",110),p(this,"cameraHeight",2e3),p(this,"cameraDepth",1/Math.tan(this.fieldOfView/2*Math.PI/180)),p(this,"projectYCompensation",30),p(this,"drawDistance",500),p(this,"fogDensity",5),p(this,"maxSpeed",9*this.segmentLength),p(this,"accel",this.maxSpeed/50),p(this,"decel",-this.maxSpeed/70),p(this,"screechDecel",-this.maxSpeed/100),p(this,"breaking",-this.maxSpeed/20),p(this,"offRoadDecel",-this.maxSpeed/10),p(this,"offRoadLimit",this.maxSpeed/4),p(this,"centrifugal",.2),p(this,"steerCompensation",.5),p(this,"maxTurn",1),p(this,"turnResetMultiplier",.1),p(this,"cameraAngleResetMultiplier",.07),p(this,"totalCars",30)}};class m{static rumbleWidth(e,t){return e/Math.max(6,2*t)}static laneMarkerWidth(e,t){return e/Math.max(32,8*t)}static increase(e,t,s){let i=e+t;for(;i>=s;)i-=s;for(;i<0;)i+=s;return i}static accelerate(e,t,s){return e+t*s}static interpolate(e,t,s){return e+(t-e)*s}static easeIn(e,t,s){return e+(t-e)*Math.pow(s,2)}static easeOut(e,t,s){return e+(t-e)*(1-Math.pow(1-s,2))}static easeInOut(e,t,s){return e+(t-e)*(-Math.cos(s*Math.PI)/2+.5)}static percentRemaining(e,t){return e%t/t}static toInt(e,t){if(null!==e){const t=parseInt(e,10);if(!isNaN(t))return t}return m.toInt(t,0)}static overlapPlayer(e,t){const s=e.scene.scale.gameSize.width/2,i=new Phaser.Geom.Rectangle;return t.sprite.getBounds(i).contains(s-e.collisionRadius,150)||t.sprite.getBounds(i).contains(s+e.collisionRadius,150)}static overlapSprite(e,t){const s=e.getBounds(),i=t.getBounds();return Phaser.Geom.Rectangle.Overlaps(s,i)}}var g=s(2);function f(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const v=Math.PI/2;class y{constructor(e,t,s,i,r){f(this,"position",void 0),f(this,"sprite",void 0),f(this,"scene",void 0),f(this,"p3d",void 0),f(this,"model",void 0),f(this,"smokeParticles",void 0),f(this,"smokeEmitterLeft",void 0),f(this,"smokeEmitterRight",void 0),f(this,"engineSound",void 0),f(this,"tireScreechSound",void 0),f(this,"explosionSound",void 0),f(this,"collideSound",void 0),f(this,"turn",void 0),f(this,"pitch",void 0),f(this,"speed",void 0),f(this,"trackPosition",void 0),f(this,"accelerating",!1),f(this,"screeching",!1),f(this,"collisionRadius",20),f(this,"turnVector",void 0),this.position=new Phaser.Math.Vector3(t,s,i),this.scene=e,this.turn=0,this.pitch=0,this.speed=0,this.trackPosition=0,this.turnVector=new Phaser.Math.Vector3(0,0,0),this.smokeParticles=this.scene.add.particles("particles").setDepth(21);const a={x:-100,y:-100,lifespan:500,frequency:66,frame:0,blendMode:"NORMAL",gravityY:-100,speed:0,rotate:{onEmit:()=>359*Math.random()},scale:{start:.3,end:2}};this.engineSound=this.scene.sound.add("engine",{volume:.7,loop:!0}),this.engineSound.play(),this.tireScreechSound=this.scene.sound.add("tire-squeal",{volume:.5,loop:!0}),this.explosionSound=this.scene.sound.add("explosion",{volume:.75}),this.collideSound=this.scene.sound.add("collision",{volume:.75}),this.smokeEmitterLeft=this.smokeParticles.createEmitter(a),this.smokeEmitterRight=this.smokeParticles.createEmitter(a),this.p3d=new g.a(this.scene,{fov:35,x:0,y:7,z:-20,antialias:!1}),this.p3d.view.setDepth(20),this.p3d.addGLTFModel(r),this.p3d.camera.lookAt(0,5.1,0),this.p3d.add.hemisphereLight({skyColor:15724543,groundColor:1118481,intensity:2}),this.p3d.on("loadgltf",(e,t)=>{t.rotateY(v),t.position.set(0,0,0),t.scale.set(1,1,1),this.model=t})}get x(){return this.position.x}set x(e){this.position.x=e,this.scene.registry.set("playerx",e)}get y(){return this.position.y}set y(e){this.position.y=e}get z(){return this.position.z}set z(e){this.position.z=e}get isOnGravel(){return Math.abs(this.x)>1}update(e,t){this.position.x+=.08*this.turn*(this.speed/u.maxSpeed),this.model&&(this.turnVector.y=v+-this.turn,this.turnVector.x=Phaser.Math.Clamp(this.pitch,-.3,.3),this.model.rotation.setFromVector3(this.turnVector),this.p3d.camera.rotation.z=Math.PI+Phaser.Math.DegToRad(this.scene.cameraAngle),this.pitch>0&&(this.model.position.y=m.interpolate(this.model.position.y,3*-this.pitch,.33)),this.speed>20&&(this.model.position.y=m.interpolate(this.model.position.y+Phaser.Math.Between(-1,1)*(this.isOnGravel?.05:.01),0,.2)),this.updateParticles(),this.playEngineSound(),this.tireScreech(this.screeching))}playEngineSound(){this.speed>0&&this.engineSound.isPlaying&&(this.engineSound.setDetune(1.25*this.speed),this.engineSound.setVolume(.7+Phaser.Math.Clamp(1e-4*this.speed,0,.2)))}tireScreech(e=!1){e&&!this.tireScreechSound.isPlaying?this.tireScreechSound.play():this.tireScreechSound.stop()}collide(e){switch(e){case"car":this.collideSound.isPlaying||this.collideSound.play();break;case"prop":!this.explosionSound.isPlaying&&this.speed>700?this.explosionSound.play():!this.collideSound.isPlaying&&this.speed>200&&this.collideSound.play()}}updateParticles(){const e=100*-this.turn,t=this.turn<0?{min:-30,max:0}:{min:180,max:210},s=this.scene.scale.gameSize.width/2+20*-this.turn;this.smokeEmitterLeft.setPosition(s-13,this.scene.scale.gameSize.height-5-15*this.pitch-(this.turn>0?7*this.turn:0)),this.smokeEmitterRight.setPosition(s+13,this.scene.scale.gameSize.height-5-15*this.pitch+(this.turn<0?7*this.turn:0)),this.smokeEmitterLeft.setSpeed(e),this.smokeEmitterRight.setSpeed(e),this.smokeEmitterLeft.setAngle(t),this.smokeEmitterRight.setAngle(t),this.isOnGravel?(this.smokeEmitterLeft.setFrame(1),this.smokeEmitterRight.setFrame(1)):(this.smokeEmitterLeft.setFrame(0),this.smokeEmitterRight.setFrame(0)),this.speed>300&&Math.abs(this.turn)>.66&&!this.smokeEmitterLeft.on?(this.smokeEmitterLeft.on=!0,this.smokeEmitterRight.on=!0,this.screeching=!0):this.speed>100&&this.isOnGravel?(this.smokeEmitterLeft.on=!0,this.smokeEmitterRight.on=!0,this.screeching=!1):this.speed<400&&this.accelerating?(this.smokeEmitterLeft.on=!0,this.smokeEmitterRight.on=!0,this.screeching=!0):(this.smokeEmitterLeft.stop(),this.smokeEmitterRight.stop(),this.screeching=!1)}}function M(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class S{constructor(e=0,t=0,s=0){M(this,"world",void 0),M(this,"camera",void 0),M(this,"screen",void 0),this.world=new Phaser.Math.Vector3(e,t,s),this.camera=new Phaser.Math.Vector3(0,0,0),this.screen={x:0,y:0,w:0,scale:0}}}function x(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class w{constructor(e,t,s,i){x(this,"index",void 0),x(this,"p1",void 0),x(this,"p2",void 0),x(this,"looped",!1),x(this,"fog",0),x(this,"curve",void 0),x(this,"colors",void 0),x(this,"props",void 0),x(this,"cars",void 0),x(this,"clip",void 0),this.index=e,this.p1=new S(0,i,e*u.segmentLength),this.p2=new S(0,s,(e+1)*u.segmentLength),this.colors=Math.floor(e/u.rumbleLength)%2?c:d,this.curve=t,this.clip=0,this.props=new Set,this.cars=new Set}}const T={NONE:0,SHORT:25,MEDIUM:50,LONG:100,VERYLONG:200},b={NONE:0,MINIMAL:1,EASY:2,MEDIUM:4,HARD:6},L={NONE:0,LOW:20,MEDIUM:40,HIGH:60};function R(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class P{constructor(e,t,s,i,r=3e3,a=!1,n=!1){R(this,"scene",void 0),R(this,"sprite",void 0),R(this,"offset",void 0),R(this,"height",void 0),R(this,"collides",void 0),R(this,"scale",1),this.scene=e,this.sprite=e.add.sprite(-999,-999,t).setOrigin(.5,1).setVisible(!1),this.offset=s,this.height=i,this.collides=n,this.scale=r,this.sprite.flipX=a}update(e=0,t=0,s=1,i=0){if(this.sprite.setPosition(e,t+this.height),this.sprite.setScale(this.scale*s),this.sprite.setDepth(10+s),this.sprite.visible||this.sprite.setVisible(!0),t>i){const e=(t-i)/this.sprite.scaleY,s=this.sprite.height-e;this.sprite.setCrop(0,0,this.sprite.width,s)}else this.sprite.setCrop()}destroy(){this.sprite.destroy(),this.scene=void 0}}function E(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class A{constructor(e){E(this,"scene",void 0),E(this,"segments",void 0),E(this,"trackLength",void 0),this.scene=e,this.segments=[],this.trackLength=0}addRoadSegment(e,t){this.segments.push(new w(this.segments.length,e,t,this.getLastSegmentYPos()))}addStraight(e=T.MEDIUM){this.addRoad(e,e,e,0,0)}addCurve(e=T.MEDIUM,t=b.MEDIUM,s=L.NONE){this.addRoad(e,e,e,t,s)}addHill(e=T.MEDIUM,t=L.NONE){this.addRoad(e,e,e,0,t)}addRoad(e,t,s,i,r){const a=this.getLastSegmentYPos(),n=a+m.toInt(r,0)*u.segmentLength,o=e+t+s;for(let t=0;t<e;t++)this.addRoadSegment(m.easeIn(0,i,t/e),m.easeInOut(a,n,t/o));for(let s=0;s<t;s++)this.addRoadSegment(i,m.easeInOut(a,n,(e+s)/o));for(let r=0;r<s;r++)this.addRoadSegment(m.easeInOut(i,0,r/s),m.easeInOut(a,n,(e+t+r)/o))}getLastSegmentYPos(){const e=this.getLastSegment();return e?e.p2.world.y:0}getLastSegment(){return this.segments.length>0?this.segments[this.segments.length-1]:null}findSegmentByZ(e){const t=Math.floor(e/u.segmentLength)%this.segments.length;return this.segments[t]}resetRoad(){this.segments=[],this.addStraight(T.MEDIUM),this.addCurve(T.MEDIUM,b.MEDIUM,L.LOW),this.addHill(T.SHORT,-L.LOW),this.addHill(T.SHORT,L.LOW),this.addHill(T.SHORT,-L.LOW),this.addCurve(T.LONG,b.MEDIUM,L.MEDIUM),this.addHill(T.SHORT,-L.LOW),this.addCurve(T.LONG,b.MEDIUM,-L.MEDIUM),this.addCurve(T.LONG,-b.MINIMAL,L.HIGH),this.addStraight(T.SHORT),this.addCurve(T.VERYLONG,b.MINIMAL),this.addHill(T.SHORT,-L.MEDIUM),this.addStraight(T.SHORT),this.addHill(T.MEDIUM,L.HIGH),this.addCurve(T.SHORT,b.MEDIUM,L.LOW),this.addHill(T.LONG,-L.HIGH),this.addCurve(T.LONG,-b.MEDIUM),this.addStraight(),this.addCurve(T.LONG,b.MEDIUM),this.addStraight(),this.addCurve(T.LONG,-b.EASY),this.addHill(T.LONG,-L.MEDIUM),this.addCurve(T.LONG,b.MEDIUM,-L.LOW),this.addRoad(200,200,200,b.NONE,Math.round(-this.getLastSegmentYPos()/u.segmentLength)),this.trackLength=this.segments.length*u.segmentLength,this.createRandomProps(),this.createTurnSigns()}addProp(e,t,s,i,r=0,a=3e3,n=!1,o=!1){try{const h=this.segments[t],l=new P(e,s,i,r,a,n,o);return h.props.add(l),!0}catch(e){return!1}}hideAllProps(){this.segments.forEach(e=>{for(const t of e.props)t.sprite.setVisible(!1)})}createRandomProps(){for(let e=0;e<this.segments.length;e+=Phaser.Math.Between(1,5)){const t=Phaser.Math.FloatBetween(1.75,10),s=Math.random()-.5>0;let i,r=3e3;switch(Phaser.Math.Between(1,5)){case 1:i="boulder1",r=1500;break;case 2:i="boulder2",r=2e3;break;case 3:i="tree1",r=5e3;break;case 4:i="tree2",r=5500;break;case 5:i="tree3",r=5e3}this.addProp(this.scene,e,i,s?-t:t,0,r,!1)}}createTurnSigns(){for(let e=0;e<this.segments.length;e++){const t=this.segments[e];Math.abs(t.curve)>1&&(t.curve>.33?(this.removeProps(t,1,-1.75),this.addProp(this.scene,e,"turnsign",-1.75,0,5e3,!0,!1)):(this.removeProps(t,1,1.75),this.addProp(this.scene,e,"turnsign",1.75,0,5e3,!1,!1)),e+=10)}}removeProps(e,t,s){const i=s<0,r=this.segments.slice(e.index-t,e.index+t);for(const e of r)if(e.props.size)for(const t of e.props)(t.offset<0&&i||t.offset>0&&!i)&&e.props.delete(t)}}function k(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class O{static project(e,t,s,i,r,a,n,o){e.camera.x=(e.world.x||0)-t,e.camera.y=(e.world.y||0)-s,e.camera.z=(e.world.z||0)-i,e.screen.scale=r/e.camera.z,e.screen.x=Math.round(a/2+e.screen.scale*e.camera.x*a/2),e.screen.y=Math.round(n/2-e.screen.scale*e.camera.y*n/2),e.screen.w=Math.round(e.screen.scale*o*a/2)}static drawPolygon(e,t,s,i,r,a,n,o,h,l){e.save().fillStyle(l).beginPath().moveTo(t,s).lineTo(i,r).lineTo(a,n).lineTo(o,h).closePath().fillPath().restore()}static drawSegment(e,t,s,i,r,a,n,o,h,l){const c=m.rumbleWidth(a,s),d=m.rumbleWidth(h,s),p=m.laneMarkerWidth(a,s),u=m.laneMarkerWidth(a,s),g=r-o;e.fillStyle(l.GRASS),e.fillRect(-10,o,t,g),O.drawPolygon(e,i-a-c,r,i-a,r,n-h,o,n-h-d,o,l.RUMBLE),O.drawPolygon(e,i+a+c,r,i+a,r,n+h,o,n+h+d,o,l.RUMBLE),O.drawPolygon(e,i-a,r,i+a,r,n+h,o,n-h,o,l.ROAD);const f=2*a/s,v=2*h/s;let y=i-a+f,M=n-h+v;if(l.LANE)for(let t=1;t<s;y+=f,M+=v,t++)O.drawPolygon(e,y-p/2,r,y+p/2,r,M+u/2,o,M-u/2,o,l.LANE)}constructor(e,t=0){k(this,"scene",void 0),k(this,"roadGraphics",void 0),this.scene=e,this.roadGraphics=this.scene.add.graphics().setDepth(t)}update(e,t){this.roadGraphics.clear(),this.drawRoad()}drawRoad(){const e=this.scene.scale.gameSize.width+20,t=this.scene.scale.gameSize.height+20,s=this.scene.road.findSegmentByZ(this.scene.player.trackPosition),i=m.percentRemaining(this.scene.player.trackPosition,u.segmentLength);let r=t,a=0,n=-s.curve*i;for(let i=0;i<u.drawDistance;i++){const o=(s.index+i)%this.scene.road.segments.length,h=this.scene.road.segments[o];h.clip=r,h.looped=h.index<s.index,O.project(h.p1,this.scene.player.x*u.roadWidth-a,this.scene.player.y+u.cameraHeight,this.scene.player.trackPosition-(h.looped?this.scene.road.trackLength:0),u.cameraDepth,e,t-u.projectYCompensation,u.roadWidth),O.project(h.p2,this.scene.player.x*u.roadWidth-a-n,this.scene.player.y+u.cameraHeight,this.scene.player.trackPosition-(h.looped?this.scene.road.trackLength:0),u.cameraDepth,e,t-u.projectYCompensation,u.roadWidth),a+=n,n+=h.curve,h.p1.camera.z<=u.cameraDepth||h.p2.screen.y>=r||h.p2.screen.y>=h.p1.screen.y||(O.drawSegment(this.roadGraphics,e,u.lanes,h.p1.screen.x-10,h.p1.screen.y,h.p1.screen.w,h.p2.screen.x-10,h.p2.screen.y,h.p2.screen.w,h.colors),r=h.p2.screen.y)}for(let t=u.drawDistance;t>0;t--){const i=(s.index+t)%this.scene.road.segments.length,r=this.scene.road.segments[i],a=r.p1.screen.scale;for(const t of r.props){const s=r.p1.screen.x-10+a*t.offset*u.roadWidth*e/2;t.update(s,r.p1.screen.y,a,r.clip)}for(const t of r.cars){const s=m.interpolate(r.p1.screen.scale,r.p2.screen.scale,t.percent),i=m.interpolate(r.p1.screen.x-10,r.p2.screen.x-10,t.percent)+s*t.offset*u.roadWidth*e/2,a=m.interpolate(r.p1.screen.y,r.p2.screen.y,t.percent);t.draw(i,a,s,r.clip)}}}}function _(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class D{constructor(e,t,s,i,r,a){_(this,"scene",void 0),_(this,"road",void 0),_(this,"sprite",void 0),_(this,"offset",0),_(this,"speed",0),_(this,"trackPosition",0),_(this,"percent",0),_(this,"scale",1500),this.scene=e,this.road=t,this.offset=s,this.speed=a,this.trackPosition=i,this.sprite=this.scene.add.sprite(-999,999,r,0).setOrigin(.5,1)}get isOnGravel(){return Math.abs(this.offset)>1}update(e,t,s,i){this.updateOffset(e,t,s),this.updateAngleFrame(t,s,i)}draw(e=0,t=0,s=1,i=0){if(this.sprite.setPosition(e,t),this.sprite.setScale(this.scale*s),this.sprite.setDepth(10+s),this.sprite.visible||this.sprite.setVisible(!0),t>i){const e=(t-i)/this.sprite.scaleY,s=this.sprite.height-e;this.sprite.setCrop(0,0,this.sprite.width,s)}else this.sprite.setCrop()}updateAngleFrame(e,t,s){const i=Math.abs(e.index-t.index),r=Math.abs(s-this.offset),a=s>this.offset;i<20&&r>.3?(this.sprite.setFrame(1),this.sprite.flipX=!a):this.sprite.setFrame(0)}updateOffset(e,t,s){const i=this.scene.player;if(!(t.index-s.index>u.drawDistance)){for(let r=0;r<50;r++){const a=this.road.segments[(t.index+r)%this.road.segments.length];a===s&&this.speed>i.speed&&m.overlapPlayer(i,this)&&(i.x<this.offset?this.offset=m.interpolate(this.offset,1,.1*e):this.offset=m.interpolate(this.offset,-1,.1*e)),a.cars.size&&a.cars.forEach(t=>{t!==this&&this.speed>t.speed&&m.overlapSprite(t.sprite,this.sprite)&&(t.offset<this.offset?this.offset=m.interpolate(this.offset,1,.1*e):this.offset=m.interpolate(this.offset,-1,.1*e))})}Math.abs(this.offset)>.9&&(this.offset=m.interpolate(this.offset,0,e))}}destroy(){this.sprite.destroy()}}function C(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class I{constructor(e,t){C(this,"scene",void 0),C(this,"cars",new Set),C(this,"road",void 0),this.scene=e,this.road=t}resetCars(){this.destroy();for(let e=0;e<u.totalCars;e++){const e=Phaser.Math.FloatBetween(-.8,.8),t=Phaser.Math.Between(0,this.road.trackLength),s=this.getRandomCarType(),i=Phaser.Math.Between(.2*u.maxSpeed,.8*u.maxSpeed),r=new D(this.scene,this.road,e,t,s,i),a=this.road.findSegmentByZ(t);this.cars.add(r),a.cars.add(r)}}update(e,t,s){for(const i of this.cars){const r=this.road.findSegmentByZ(i.trackPosition);i.update(e,r,t,s),i.trackPosition=m.increase(i.trackPosition,e*i.speed,this.road.trackLength),i.percent=m.percentRemaining(i.trackPosition,u.segmentLength);const a=this.road.findSegmentByZ(i.trackPosition);a.index!==r.index&&(r.cars.delete(i),a.cars.add(i))}}hideAll(){this.cars.forEach(e=>{e.sprite.setVisible(!1)})}destroy(){this.cars.forEach(e=>e.destroy()),this.cars.clear()}getRandomCarType(){const e=["car-army","car-yellow","car-red","car-green","car-blue"];return e[Phaser.Math.Between(0,e.length-1)]}}function G(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class F extends r{constructor(e,t){super("GameScene"),G(this,"position",void 0),G(this,"player",void 0),G(this,"road",void 0),G(this,"renderer",void 0),G(this,"carManager",void 0),G(this,"debugText",void 0),G(this,"sky",void 0),G(this,"clouds1",void 0),G(this,"clouds2",void 0),G(this,"clouds3",void 0),G(this,"mountains",void 0),G(this,"camera",void 0),G(this,"cameraAngle",0),G(this,"hills",void 0),G(this,"hillsBaseY",void 0),G(this,"cursors",void 0)}create(){this.scene.launch("RaceUiScene",this);const e=this.scale.gameSize.width,t=this.scale.gameSize.height;this.cursors=this.input.keyboard.createCursorKeys(),this.camera=this.cameras.main,this.road=new A(this),this.carManager=new I(this,this.road),this.sky=this.add.rectangle(-10,-20,e+20,t+30,l.SKY.color).setOrigin(0).setZ(0).setDepth(0),this.clouds2=this.add.tileSprite(-10,10,e+20,64,"clouds1").setOrigin(0).setZ(3).setDepth(1),this.clouds3=this.add.tileSprite(-10,20,e+20,64,"clouds2").setOrigin(0).setZ(4).setDepth(2),this.mountains=this.add.tileSprite(-10,t/2-85,e+20,128,"mountain").setOrigin(0).setZ(3).setDepth(3),this.clouds1=this.add.tileSprite(-10,0,e+20,64,"clouds1").setOrigin(0).setZ(2).setDepth(4),this.hillsBaseY=t/2-40,this.hills=this.add.tileSprite(-10,this.hillsBaseY,e+10,64,"hills").setOrigin(0).setZ(5).setDepth(4),this.renderer=new O(this,5),this.player=new y(this,0,t-5,u.cameraHeight*u.cameraDepth+300,"playercar"),this.debugText=this.add.bitmapText(5,5,"retro","",16).setTint(16711680).setDepth(200),this.road.resetRoad(),this.carManager.resetCars(),this.pasuuna.loadSongFromCache("dream-candy",!0),this.pasuuna.setVolume(.7)}update(e,t){const s=.01*t,i=this.road.findSegmentByZ(this.player.trackPosition+this.player.z),r=m.percentRemaining(this.player.trackPosition+this.player.z,u.segmentLength),a=this.player.speed/u.maxSpeed,n=this.player.speed<=0?0:s*a;if(this.handleInput(t,i),this.player.y=m.interpolate(i.p1.world.y,i.p2.world.y,r),this.player.x=this.player.x-n*a*i.curve*u.centrifugal,this.player.speed=Phaser.Math.Clamp(this.player.speed,0,u.maxSpeed),this.player.x=Phaser.Math.Clamp(this.player.x,-u.roadWidthClamp,u.roadWidthClamp),this.player.turn=Phaser.Math.Clamp(this.player.turn,-u.maxTurn,u.maxTurn),this.player.trackPosition=m.increase(this.player.trackPosition,s*this.player.speed,this.road.trackLength),this.player.pitch=.002*(i.p1.world.y-i.p2.world.y),this.player.isOnGravel&&this.player.speed>u.offRoadLimit&&(this.player.speed=m.accelerate(this.player.speed,u.offRoadDecel,s)),i.props.size&&Math.abs(this.player.x)>1)for(const e of i.props)m.overlapPlayer(this.player,e)&&(this.player.collide("prop"),this.player.trackPosition=m.increase(i.p1.world.z,-this.player.z,this.road.trackLength),this.player.speed=this.player.speed>50?50:this.player.speed);if(i.cars.size&&Math.abs(this.player.x)<1)for(const e of i.cars)m.overlapPlayer(this.player,e)&&(this.player.collide("car"),this.player.trackPosition=m.increase(e.trackPosition,-this.player.z,this.road.trackLength),this.player.speed=this.player.speed/2);this.road.hideAllProps(),this.carManager.hideAll(),this.updateBg(n*i.curve),this.renderer.update(e,t),this.carManager.update(s,i,this.player.x),this.player.update(t,n),this.registry.set("speed",Math.floor(this.player.speed/10)),this.cameraAngle=Phaser.Math.Clamp(this.cameraAngle,-6,6),this.camera.setAngle(this.cameraAngle)}getRadarCars(e){const t=[],s=this.road.findSegmentByZ(this.player.trackPosition);for(let i=0;i<e;i++){const e=(s.index+i)%this.road.segments.length,r=this.road.segments[e];for(const e of r.cars)t.push(e)}return t}updateBg(e){this.clouds1.tilePositionX+=.05+e*this.clouds1.z,this.clouds2.tilePositionX+=.1+e*this.clouds2.z,this.clouds3.tilePositionX+=.125+e*this.clouds3.z,this.mountains.tilePositionX+=e*this.mountains.z,this.hills.tilePositionX+=e*this.hills.z,this.hills.setY(this.hillsBaseY-20*this.player.pitch)}handleInput(e,t){const s=.01*e;this.cursors.up.isDown?(this.player.speed=m.accelerate(this.player.speed,m.interpolate(u.accel,0,m.percentRemaining(this.player.speed,u.maxSpeed)),s),this.player.accelerating=!0):this.cursors.down.isDown?this.player.speed=m.accelerate(this.player.speed,u.breaking,s):(this.player.accelerating=!1,this.player.speed=m.accelerate(this.player.speed,u.decel,s)),this.player.speed>500&&this.player.screeching&&(this.player.speed=m.accelerate(this.player.speed,u.screechDecel,s)),this.cursors.left.isDown?(this.player.turn-=s*(Math.abs(t.curve)>.1?.5:.25),this.cameraAngle+=s):this.cursors.right.isDown?(this.player.turn+=s*(Math.abs(t.curve)>.1?.5:.25),this.cameraAngle-=s):(this.player.turn=Math.abs(this.player.turn)<.01?0:m.interpolate(this.player.turn,0,u.turnResetMultiplier),this.cameraAngle=Math.abs(this.cameraAngle)<.02?0:m.interpolate(this.cameraAngle,0,u.cameraAngleResetMultiplier))}}function U(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class B{constructor(e,t,s,i){U(this,"scene",void 0),U(this,"speedText",void 0),U(this,"graphics",void 0),U(this,"x",void 0),U(this,"y",void 0),U(this,"radius",void 0),U(this,"speedValue",0),this.scene=e,this.x=t,this.y=s,this.radius=i,this.graphics=this.scene.add.graphics(),this.speedText=this.scene.add.bitmapText(t+35,s-15,"numbers",this.speedValue.toString(),48).setOrigin(1,.5),this.scene.add.bitmapText(t-58,s-8,"impact","kmh",12).setTint(16776960),this.update()}get speed(){return this.speedValue}set speed(e){this.speedValue=e,this.update()}update(){this.graphics.clear(),this.drawGauge(),this.speedText.setText(this.speedValue.toString())}destroy(){}drawGauge(){const e=Phaser.Display.Color.HSVToRGB(.3-this.speedValue/600,1,1);this.graphics.lineStyle(17,5592405,1).beginPath().arc(this.x,this.y,this.radius,Phaser.Math.DegToRad(180),Phaser.Math.DegToRad(315),!1).strokePath(),this.graphics.lineStyle(12,e.color).beginPath().arc(this.x,this.y,this.radius,Phaser.Math.DegToRad(183),Phaser.Math.DegToRad(183)+this.speedToAngle(),!1).strokePath()}speedToAngle(){const e=this.speedValue>0?1e3*this.speedValue/u.maxSpeed:0,t=m.interpolate(0,130,.01*e);return Phaser.Math.DegToRad(t)}}function H(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class N{constructor(e,t,s){H(this,"scene",void 0),H(this,"graphics",void 0),H(this,"container",void 0),H(this,"bg",void 0),H(this,"grid",void 0),H(this,"player",void 0),H(this,"cars",void 0),H(this,"x",void 0),H(this,"y",void 0),this.scene=e,this.x=t,this.y=s,this.cars=new Set,this.container=this.scene.add.container(this.x,this.y),this.bg=this.scene.add.rectangle(0,0,33,163,16777215,.75).setOrigin(0,0),this.grid=this.scene.add.grid(2,2,30,160,30/u.lanes,32,3355443,.8).setOrigin(0,0),this.graphics=this.scene.add.graphics(),this.player=this.scene.add.rectangle(17,130,3,5,16776960),this.container.add([this.bg,this.grid,this.player,this.graphics])}update(){this.graphics.clear()}destroy(){}updatePlayerX(e){const t=m.interpolate(2,17,e+1);this.player.x=Phaser.Math.Clamp(t,4,30)}drawCar(e,t){const s=m.interpolate(1,16,e+1),i=Phaser.Math.Clamp(s,4,30),r=m.interpolate(0,156,1/(7e-4*t)),a=Phaser.Math.Clamp(r,2,156);this.graphics.fillStyle(16711680).fillRect(i,a,3,5)}}function z(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class j extends r{constructor(e,t){super("RaceUiScene"),z(this,"timerText",void 0),z(this,"timeLargeText",void 0),z(this,"timeSmallText",void 0),z(this,"speedGauge",void 0),z(this,"trackRadar",void 0),z(this,"gameScene",void 0),z(this,"timer",void 0)}create(e){this.gameScene=e,this.timeLargeText=this.add.bitmapText(this.scale.gameSize.width/2+30,5,"numbers","000",32).setOrigin(1,0).setTint(16764108),this.timeSmallText=this.add.bitmapText(this.scale.gameSize.width/2+33,8,"numbers","000",16).setOrigin(0,0).setTint(16764108),this.timerText=this.add.bitmapText(this.scale.gameSize.width/2+54,8,"impact","time",16).setOrigin(0,0),this.speedGauge=new B(this,60,60,50),this.trackRadar=new N(this,this.scale.gameSize.width-40,10),this.timer=this.tweens.addCounter({from:180,to:0,duration:18e4}),this.setupEvents()}update(){const e=this.timer.getValue().toFixed(2).split(".");this.timeLargeText.setText(e[0]),this.timeSmallText.setText(e[1]),this.trackRadar.update();const t=this.gameScene.getRadarCars(700);for(const e of t)this.trackRadar.drawCar(e.offset,e.trackPosition-this.gameScene.player.trackPosition)}destroy(){this.registry.events.off("changedata")}setupEvents(){this.registry.events.on("changedata",(e,t,s)=>{switch(t){case"speed":this.speedGauge.speed=s;break;case"playerx":this.trackRadar.updatePlayerX(s);break;default:console.warn("unknown registry change")}},this)}}s.d(t,"PoisonVialGame",(function(){return V}));class V extends Phaser.Game{constructor(e){var t,s,i;super(e),i=!1,(s="debug")in(t=this)?Object.defineProperty(t,s,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[s]=i}}window.onload=()=>{const e=new V(o);if("production"!==window.env.buildType){const t=new(s(10));t.setMode(0),t.domElement.style.position="absolute",t.domElement.style.left="0px",t.domElement.style.top="0px",document.body.appendChild(t.domElement),e.events.on("prestep",()=>t.begin()),e.events.on("postrender",()=>t.end())}e.scene.add("BootScene",a,!0),e.scene.add("LoadScene",h,!1),e.scene.add("GameScene",F,!1),e.scene.add("RaceUiScene",j,!1)}}]);